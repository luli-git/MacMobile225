if (self.CavalryLogger) { CavalryLogger.start_js(["3HrtS"]); }

__d("BrowseFacebarHighlighter",["csx","CSS","NodeHighlighter"],(function(a,b,c,d,e,f,g){"use strict";a={};Object.assign(a,b("NodeHighlighter"),{getHighlightCandidates:function(){return["._53ad"]},isDiscardNode:function(a){return b("CSS").hasClass(a,"DefaultText")},createSegmentedRegex:function(a){a=this.escapeAndAddBidirectionalCharsToTokens(a);return"(^|\\s|\\b)("+a.join("|")+")"}});e.exports=a}),null);
__d("FacebarResultStoreUtils",["FacebarGlobalOptions","FacebarJSConstants"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a={getQueryFeatures:function(a){__p&&__p();var c={};if(b("FacebarGlobalOptions").enableBootstrapRanking){a.raw_text&&(c.FEATURE_QUERY_LENGTH=a.raw_text.length);if(a.tokens){c.FEATURE_QUERY_TOKENS=a.tokens.length;c.FEATURE_QUERY_TOKEN_LENGTH_SUM=0;for(var d=0;d<a.tokens.length;d++)c.FEATURE_QUERY_TOKEN_LENGTH_SUM+=a.tokens[d].length}}return c},addFeatures:function(a,b,c,d,e,f){__p&&__p();if(!a.features)return;a.features={FEATURE_QUERY_LENGTH:d.FEATURE_QUERY_LENGTH,FEATURE_QUERY_TOKENS:d.FEATURE_QUERY_TOKENS,FEATURE_QUERY_TOKEN_LENGTH_SUM:d.FEATURE_QUERY_TOKEN_LENGTH_SUM};a.features.FEATURE_IS_EXACT_NAME_MATCH=e;a.features.FEATURE_IS_STOP_WORD_MATCH=f;if(b&&b.length>0){d=b.split(" ").length;e=0;for(var f=0;f<a.termMatches.length;++f)b.search(a.termMatches[f])>=0&&e++;a.features.FEATURE_TITLE_TOKEN_MATCH_FRACTION=e/d}if(c.tokens&&c.tokens.length>0){f=b.search(c.tokens[0]);a.features.FEATURE_FIRST_TERM_MATCH_POSITION=f;a.features.FEATURE_FIRST_TERM_MATCH_TOKEN=b.substring(0,f+c.tokens[0].length).split(" ").length;a.termMatches.some(function(b){if(b.search(c.tokens[0])===0){a.features.FEATURE_FIRST_TERM_MATCH_TOKEN_FRACTION=c.tokens[0].length/b.length;return!0}return!1});a.features.FEATURE_IN_ORDER_MATCH=1;c.tokens.length>1&&(f=b.search(c.tokens[1]),a.features.FEATURE_SECOND_TERM_MATCH_POSITION=f,a.features.FEATURE_SECOND_TERM_MATCH_TOKEN=b.substring(0,f+c.tokens[1].length).split(" ").length,a.termMatches.some(function(b){if(b.search(c.tokens[1])===0){a.features.FEATURE_FIRST_TERM_MATCH_TOKEN_FRACTION=c.tokens[0].length/b.length;return!0}return!1}),a.features.FEATURE_SECOND_TERM_MATCH_TOKEN<a.features.FEATURE_FIRST_TERM_MATCH_POSITION&&(a.features.FEATURE_IN_ORDER_MATCH=0))}return a},processEntityResult:function(a,c,d,e,f,g,h,i,j){a={semantic:c.toString(),structure:[{type:a===b("FacebarJSConstants").keywordType?a:"ent:"+a,text:d,uid:c}],type:a,cost:e,cache_id_length:0,features:[]};a.tuid=JSON.stringify({semantic:a.semantic,structure:a.structure});b("FacebarGlobalOptions").enableBootstrapRanking&&(a.termMatches=h[c.toString()],a=this.addFeatures(a,d.toLowerCase(),f,g,i,j));return a},getRawTextFromStructured:function(a){a=a.map(function(a){return a.getText()});return a.join("")},getTextFromResult:function(a){a=a.structure;var b="";a.forEach(function(a){b+=a.text});return b}};e.exports=a}),null);
__d("HashtagParser",["URLMatcher","getHashtagRegex"],(function(a,b,c,d,e,f){__p&&__p();var g=100,h=30,i=/@\[([0-9]+):([0-9]+):((?:[^\\\]]*(?:\\.)*)*)\]/g;function a(a){var b=u(a),c=0,d=0;return j(a).map(function(a){while(c<b.length){var e=b[c],f=e.offset-d;if(f<a.offset)d+=e.token.length-e.name.length,c++;else break}return{marker:a.marker,tag:a.hashtag,rawOffset:a.offset+d,offset:a.offset}})}function c(a){return k(a,p(a))}function j(a){var b=w(a);return k(b,l(a,b))}function k(a,b){return n(a).slice(0,h).filter(function(a){var c=r(a.offset,a.hashtag.length,b);return!c&&a.hashtag.length<=g})}function l(a,b){return q(o(a),p(b))}var m=b("getHashtagRegex")();function n(a){var b=[];a.replace(m,function(a,c,d,e,f){b.push({marker:d,hashtag:e,offset:f+c.length})});return b}function o(a){return x(a).map(function(a){return[a.offset,a.name.length]})}function p(a){var c=[],d,e=0;while(d=b("URLMatcher").permissiveMatch(a)){var f=a.indexOf(d);c.push([e+f,d.length]);a=a.substring(f+d.length);e+=f+d.length}return c}function q(a,b){var c=[],d=0,e=0,f=0;while(d<a.length&&e<b.length)a[d][0]>b[e][0]?c[f++]=b[e++]:c[f++]=a[d++];return c.concat(a.slice(d),b.slice(e))}function r(a,b,c){if(!c)return!1;var d=t(c,a);return s(a,b,c,d)||s(a,b,c,d+1)}function s(a,b,c,d){if(!c[d])return!1;var e=c[d][0];c=c[d][1];return!(a+b-1<e||a>e+c-1)}function t(a,b){var c=0,d=a.length-1;while(c<=d){var e=Math.floor((c+d)/2),f=a[e][0];if(f==b)return e;else f<b?c=e+1:d=e-1}return d}function u(a){var b=[];a.replace(i,function(a,c,d,e,f){b.push({token:a,id:c,type:d,name:e,offset:f})});return b}function v(a){return a?a.replace(/\\([^\\])/g,"$1").replace(/\\\\/g,"\\"):null}function w(a){return a.replace(i,function(a,b,c,d,e){return v(d)})}function x(a){var b=0,c=0;return u(a).map(function(d){var e=a.indexOf(d.token,c);c=e+1;e-=b;var f=v(d.name);b+=d.token.length-f.length;if(e>=0)return{id:d.id,name:f,type:d.type,offset:e}})}d={};d.parse=a;d.parseWithoutMentions=c;e.exports=d}),null);
__d("HashtagSearchResultUtils",["fbt","FacebarResultStoreUtils","HashtagParser","HashtagSearchResultConfig","URI"],(function(a,b,c,d,e,f,g){__p&&__p();var h;a={getHashtagFromQuery:function(a){a=b("HashtagParser").parse(a);return a&&a.length===1&&a[0].offset===0?a[0].tag:!1},makeTypeaheadResult:function(a){var c=g._("Hashtag");return{category:c,path:new(h||(h=b("URI")))("/hashtag/"+a).toString(),photo:b("HashtagSearchResultConfig").image_url,rankType:null,replace_results:b("HashtagSearchResultConfig").boost_result?!0:!1,scaled_score:1,score:0,text:"#"+a,type:"hashtag_exact",uid:"hashtag:"+a}},makeFacebarEntry:function(a){var c=g._("Hashtag");return{category:c,path:new(h||(h=b("URI")))("/hashtag/"+a).toString(),photo:b("HashtagSearchResultConfig").image_url,replace_results:b("HashtagSearchResultConfig").boost_result?!0:!1,text:"#"+a,type:"hashtag_exact",uid:"hashtag:"+a}},makeFacebarResult:function(a){var c=b("FacebarResultStoreUtils").processEntityResult("hashtag_exact","hashtag:"+a,"#"+a,b("HashtagSearchResultConfig").hashtag_cost);c.parse={display:[{type:"ent:hashtag_exact",uid:"hashtag:"+a}],remTokens:[],suffix:""};c.tags={hashtag:"hashtag"};return c}};e.exports=a}),null);
__d("WIGBackgroundImage.react",["CometBackgroundImage.react","React"],(function(a,b,c,d,e,f){"use strict";function a(a){return b("React").jsx(b("CometBackgroundImage.react"),babelHelpers["extends"]({},a))}e.exports=a}),null);
__d("FacebarInviteCoworkers",["cx","fbt","FacebarGlobalOptions","FacebarStructuredText","XWorkInviteCoworkersDialogController"],(function(a,b,c,d,e,f,g,h){"use strict";__p&&__p();a={insertInto:function(a,b,c){a=this._cleanQuery(a);var d=this._getInsertionIndex(a,b);if(d>-1){a=this._createInviteCoworkersResult(a,c);b.splice(d,0,a)}},_getInsertionIndex:function(a,c){return!a||!b("FacebarGlobalOptions").inviteCoworkers?-1:c.length},_cleanQuery:function(a){return String(a).trim().replace(/\s+/g," ").replace(/[\u200E|\u200F|\u202a|\u202b|\u202c]/g,"")},_createInviteCoworkersResult:function(a,c){var d=h._("Invite \"{query}\" to Workplace",[h._param("query",a)]),e=b("XWorkInviteCoworkersDialogController").getURIBuilder().setEnum("source","search_typeahead").getURI();return{uid:a,icon_class:"_5yiv",isAsync:!1,isInviteCoworkers:!0,structure:b("FacebarStructuredText").fromString(d),semantic:d.toString(),text:d,asyncURI:e,fromCache:c}}};e.exports=a}),null);
__d("FacebarResultStore",["CurrentUser","FacebarGlobalOptions","FacebarJSConstants","FacebarResultStoreUtils","FacebarStructuredText","KeywordsSearchResultConfig","SearchI18nMatch","TokenizeUtil","concatMap","qex"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("CurrentUser").isWorkUser(),h=8,i=function(){__p&&__p();function a(a,c,d,e){__p&&__p();var f=this;this._extractStructure=function(a){__p&&__p();function c(a,b,c,d,e){return{type:a==="ent:extend_string"?"text":a,text:b,uid:c||null,isLocal:d?d:!1,categoryName:e?e:null}}function d(b,d){b.split(" ").forEach(function(b){b!==""&&(d&&a.chunks.push(a.structure.length),a.structure.push(c("text",b))),a.structure.push(c("text"," "))}),a.structure.pop()}function e(c){return a.structure.length!==0||b("FacebarJSConstants").nonGrammarTypes[a.type]?c:c.charAt(0).toUpperCase()+c.substr(1)}a.structure=[];a.chunks=[];a.parse.display.forEach(function(b){__p&&__p();if(typeof b==="string")d(e(b),!0);else if(b.type==="ent:extend_string")d(b.text,!0);else if(b.uid){var f=this.getEntry(b.uid,b.fetchType);a.chunks.push(a.structure.length);if(f==null)throw new Error('No entry found for uid "'+b.uid+'", type "'+b.fetchType+'" and piece text "'+b.text+'"');if(f.grammar_like)d(e(f.text),!1);else{var g=b.type;b.fetchType&&(g+=":"+b.fetchType);a.structure.push(c(g,f.text,b.uid,a.isLocal,a.categoryName))}}else b.type=="blank"&&(a.chunks.push(a.structure.length),a.structure.push(c(b.type,"...")))},f);return a};this._processBackendResult=function(a){__p&&__p();if(a.semantic==null)throw new Error("Facebar can't process empty semantic "+JSON.stringify(a));a.semantic=a.semantic.toString();a.backendCost=a.cost;f._extractStructure(a);a.type.match(/^\{.*\}$/)&&(a.useExtendedIndex=!0);a.alternateSemantic&&(a.alternateSemantic=a.alternateSemantic.toLowerCase().replace(/\[(\d*)\]/g,"$1"));if(a.semantic.match(/\[\d*\]/)){var b=a.parse,c=b.pos;if(c===void 0)a.semantic=a.semantic.replace(/\[(\d*)\]/g,"$1");else{var d=b.remTokens[b.remTokens.length-1];b.remTokens.length&&a.structure[a.chunks[d]]&&a.structure[a.chunks[d]].uid&&(c=b.remTokens[b.remTokens.length-1],a.completed=!0);var e=a.structure[a.chunks[c]].uid;if(e===null)a.semantic=a.semantic.replace(/\[(\d*)\]/g,"$1");else{var g=new RegExp("\\["+e+"\\]","g");a.unsubstituted_semantic=a.semantic;a.semantic=a.semantic.replace(g,e);b&&b.disambiguation&&b.disambiguation.length>0&&(b.disambiguation=b.disambiguation.filter(function(a){return a.indexOf("["+e+"]")!==-1}),b.unsubstituted_disambiguation=b.disambiguation.splice(0),b.disambiguation=b.disambiguation.map(function(a){return a.replace(g,e)}))}}}a.semantic=a.semantic.replace(/\[(.*)\]/g,"$1");a.tuid=JSON.stringify({semantic:a.semantic,structure:a.structure});return a};this.facebarConfig=a;this.facebarConfig.grammar_stop_words_penalty=this.facebarConfig.grammar_stop_words_penalty||2;this.facebarConfig.grammar_stop_words=this.facebarConfig.grammar_stop_words||{};this.facebarConfig.options=e;this.injectedSuggestionCount=0;this.tokenize=c;this.getEntry=d;this.typeaheadTypeMap=this.facebarConfig.mapped_types;this.facebarConfig.typeahead_types.forEach(function(a){this.typeaheadTypeMap[a]=a},this);this.unicodeMatch=new(b("SearchI18nMatch"))({prefix_hangul_conjoining_jamo:!0});this.resetCaches()}var c=a.prototype;c.transformStructured=function(a){__p&&__p();var b=[],c=[],d="",e="";a.forEach(function(a,f){if(a.isType("text"))d+=a.getText(),e=e==null?null:e+a.getText();else{f=d.match(/\"/g);f&&f.length%2&&(d=d.replace(/\s+$/,"")+'"');d.length&&(Array.prototype.push.apply(b,this.tokenize(d)),c.push(d),d="");b.push(a.toStruct());c.push({uid:String(a.getUID()),type:this._getFBObjectType(a.getTypePart(1)),text:a.getText()});e=null}},this);a=!1;var f=d;d.length&&(d[d.length-1]=="'"&&(d=d.substr(0,d.length-1)),d.length>0&&d[0]==="#"?Array.prototype.push.call(b,d):d.length>0&&d[0]==="@"?(a=!0,f=this._convertToAliasKey(d.substring(1)),Array.prototype.push.call(b,f)):(f=this._convertToAliasKey(d),Array.prototype.push.apply(b,this.tokenize(d))),c.push(d),d[d.length-1]==" "&&b.push(""));var g=JSON.stringify(c),h=g.replace(/\]$/,"").replace(/\"$/,"");h=h.replace(/\s{2,}/g," ");return{tokens:b,text_form:g,is_empty:!!g.match(/^\[(\"\s*\")?\]$/),raw_text:e,cache_id:h,is_alias_search:a,potential_alias_term:f}};c.resetCaches=function(){this.resetBootstrapCache(),this.resetQueryCache()};c.resetBootstrapCache=function(){this.bootstrapCache={}};c.resetQueryCache=function(){this.queryCache={"":{tokens:[],results:[]}}};c.setNullState=function(a){this.facebarConfig.null_state=a.map(this._extractStructure,this)};c.clearRecentSearches=function(){if(!this.facebarConfig.null_state)return;this.facebarConfig.null_state=this.facebarConfig.null_state.filter(function(a){return!a.isRecent})};c.setSortFunction=function(a){this._sortFunction=a};c.addBootstrap=function(a){var b=this.bootstrapCache;a.forEach(function(a){var c=this.getEntry(a);c.bootstrapped=!0;var d=this.tokenize(c.textToIndex,!0);c.tokens&&Array.prototype.push.apply(d,c.tokens.split(" "));d.forEach(function(c){Object.prototype.hasOwnProperty.call(b,c)||(b[c]={}),b[c][a]=!0})},this)};c._convertToAliasKey=function(a){return a.replace(/\./g,"").toLowerCase()};c.addNullStateToQueryCache=function(a){this.saveResults(this.facebarConfig.null_state,a,!0)};c.getResults=function(a,c){__p&&__p();var d=this;if(a.tokens.length===0||a.tokens.length==1&&a.tokens[0]==="")return{results:this.facebarConfig.null_state||[],null_state:!0};c=this._getBestQueryCache(a.cache_id);c=c.results.filter(function(a){return!a.isRecent});var e={},f=this._getBootstrapMatchByType(a,e),i=this._addMatchingBootstrapResults(a,f[0]||{},e,[]);b("FacebarGlobalOptions").limitBootstrapResult&&(i=i.slice(0,b("FacebarGlobalOptions").limitBootstrapResultNum));var k=[],m=[],n=a.tokens.map(function(a){return a.text!=null?a.text:a}).join(" ").toLowerCase();b("FacebarGlobalOptions").hasKeywordBootstrap&&(k=i.filter(function(a){return a.type===b("FacebarJSConstants").keywordType&&d.unicodeMatch.prefixMatch(a.structure[0].text.toLowerCase(),n)}),k.sort(this._sortFunction(a.raw_text)),m=i.filter(function(a){return a.type!==b("FacebarJSConstants").keywordType&&d.unicodeMatch.prefixMatch(a.structure[0].text.toLowerCase(),n)}),m.sort(this._sortFunction(a.raw_text)),i=m.concat(k));Array.prototype.push.apply(i,b("concatMap")(this._getResultsFromCache.bind(this,f,a),c));b("FacebarGlobalOptions").hasKeywordBootstrap||i.sort(this._sortFunction(a.raw_text));var o={},p=[],q=!1,r=0;i.forEach(function(a){__p&&__p();var c=b("FacebarStructuredText").fromStruct(a.structure);if(c.hasType("blank")){p.push(a);return}a.semantic=a.semantic.toLowerCase();a.termMatches||(a.termMatches=e[a.semantic]);c=l(a,a.semantic);var d=l(a,a.alternateSemantic);if(!c)return;var f=o[c]||d!=null&&o[d];if(f){a.isJSBootstrapMatch?(f.isJSBootstrapMatch=!0,f.bootstrapCost=a.bootstrapCost):f.isJSBootstrapMatch&&a.backendCost!==void 0&&f.backendCost===void 0&&(f.backendCost=a.backendCost);a.tags!=null&&Object.assign(f.tags||{},a.tags);j(a)&&f.keyword_type==="keyword"&&Object.assign(f,a);return}if(q&&a.blankFilled)return;if(a.type.indexOf("browse_type")>=0){r+=1;if(this.facebarConfig.maxGrammarResults!==void 0&&r>this.facebarConfig.maxGrammarResults)return}q=q||!!a.blankFilled;o[c]=a;d&&(o[d]=a);(!g||a.isJSBootstrapMatch||a.position<h||a.type==="post")&&p.push(a)},this);return{results:p}};c.saveResults=function(a,c,d,e){__p&&__p();a=a.map(this._processBackendResult,this);var f=[],i={},j={};a.forEach(function(a){j[a.semantic]=!0});var k=new Set(),l=this._getBestQueryCache(c.cache_id);l.results.forEach(function(a){__p&&__p();if(a.type==="websuggestion")return;if(a.exactMatchKeyword)return;if(a.isRecent)return;if(a.semantic in i)return;var b=this._getDifferenceArrayTokens(a.tokens,c.tokens),d=this._getNumTokensMatching(b,a);d=this._tryMatchingFinalInsertedEntity(b,d,a);(d>0&&d==b.length||a.type==="shortcut"&&a.termMatches.indexOf(c.tokens[c.tokens.length-1])>=0)&&(a.cacheOnlyResult=!j[a.semantic],(!g||a.position<h||a.type==="post")&&(f.push(a),k.add(a.semantic)))},this);b("FacebarGlobalOptions").limitCacheResult&&(f=f.slice(0,b("FacebarGlobalOptions").limitCacheResultNum));a.forEach(function(a){a.tokens=c.tokens,a.cache_id_length=c.cache_id.length,a.isTypeNamedXBootstrap&&++a.cache_id_length,(!g||!k.has(a.semantic)||a.type==="post")&&f.push(a)},this);f.forEach(function(a,b){a.position=b});this.queryCache[c.cache_id]===void 0&&(this.queryCache[c.cache_id]={});Object.assign(this.queryCache[c.cache_id],{tokens:c.tokens,results:f,incomplete:d},e)};c.alreadyKnown=function(a){return!!this.queryCache[a]&&!this.queryCache[a].incomplete};c.stripBrackets=function(a){return a.replace(/^[\[\{]/,"").replace(/[\]\}]$/,"")};c._getDifferenceArrayTokens=function(a,b){if(!a.length)return[""].concat(b);var c=a.length-1,d=a[c];d===""&&(d=a[--c]);a="";typeof d==="string"&&c<b.length&&(a=b[c].substr(d.length));return[a].concat(b.slice(c+1))};c._sortFunction=function(a){return function(a,b){return(a.cost||0)-(b.cost||0)}};c._getResultsFromCache=function(a,c,d){a=c.tokens;var e=this._getDifferenceArrayTokens(d.tokens,a),f=[],g=this._getNumTokensMatching(e,d);g=this._tryMatchingFinalInsertedEntity(e,g,d);g>0&&g==e.length&&!(d.type===b("KeywordsSearchResultConfig").result_type&&e.length===1&&e[0]==='"')&&f.push(d);d.type==="shortcut"&&d.termMatches.indexOf(c.tokens[a-1])>=0&&f.push(d);return f};c._addMatchingBootstrapResults=function(a,c,d,e){__p&&__p();var f;if((f=b("qex")._("1176023"))!=null?f:!1)return[];var g=a.tokens;return b("concatMap")(function(f){__p&&__p();var h=c[f];if(h===void 0)return[];var i=[],j=b("FacebarResultStoreUtils").getQueryFeatures(a);h.forEach(function(c){__p&&__p();var h=this.getEntry(c,f);if(a.is_alias_search){if(!this._isAliasMatch(a,h,!1))return}else if(!this._isTitleTermMatch(g,h)&&!this._isAliasMatch(a,h,!1)&&!e.includes(c))return;var k=this._isOriginalNameMatch(g,h)||this._isAliasMatch(a,h,!0),l=k?0:this.facebarConfig.non_title_term_match_penalty,m=0;if(this.facebarConfig.enableExactQueryMatchCost){var n=this._isExactNameMatch(a.raw_text,h);m=n?0:this.facebarConfig.non_exact_query_match_penalty}n=this._isNonGrammarTermMatch(g,h);var o=h.grammar_costs?h.grammar_costs["{"+f+"}"]:0,p=f===b("FacebarJSConstants").keywordType?h.cost:0;p=p+o+l+m+this.facebarConfig.entity_cost+this.facebarConfig.grammar_stop_words_penalty*!n;o=b("FacebarResultStoreUtils").processEntityResult(f,c,h.text,p,a,j,d,k,!n);o.bootstrapCost=p;o.isJSBootstrapMatch=!0;o.item_logging_id=h.itemLoggingId;f===b("FacebarJSConstants").keywordType&&(o.iconClass=h.iconClass,o.keywordBootstrapType=h.keywordBootstrapType,o.parse=h.parse,o.subtext=h.subtext,o.boldedSubtext=h.boldedSubtext,o.semantic=h.semantic,o.popularSearchScore=h.popularSearchScore,o.trendingTopicID=h.trendingTopicID,o.photo=h.photo,o.keyword_type=h.keyword_type,o.keywordSource=h.keywordSource);i.push(o)},this);return i}.bind(this),this.facebarConfig.bootstrap_types)};c._isTitleTermMatch=function(a,c){var d=a[0]||{};if(typeof d==="object")return!1;c=c.titleToIndex;return a.length===1?this._isTokenizePrefixMatch(d,c):b("TokenizeUtil").isExactMatch(d,c)};c._isOriginalNameMatch=function(a,c){var d=a[0]||{};if(typeof d==="object")return!1;d=c.text;for(var c=0;c<a.length-1;++c)if(a[c]!==""&&!b("TokenizeUtil").isExactMatch(a[c],d))return!1;return a.length>0&&this._isTokenizePrefixMatch(a[a.length-1],d)};c._getNormalizedName=function(a){return a.split(/\W+/).join(",").toLowerCase()};c._isExactNameMatch=function(a,b){return this._getNormalizedName(b.text)===this._getNormalizedName(a)};c._isAliasMatch=function(a,c,d){if(c.alias==null||a.potential_alias_term==null)return!1;c=this._convertToAliasKey(c.alias);if(d||!a.is_alias_search)return b("TokenizeUtil").isExactMatch(a.potential_alias_term,c);else return b("TokenizeUtil").isPrefixMatch(a.potential_alias_term,c)};c._isNonGrammarTermMatch=function(a,c){__p&&__p();c=b("TokenizeUtil").parse(c.titleToIndex.toLowerCase());c=c.tokens.filter(function(a){return a!==""&&!this.facebarConfig.grammar_stop_words[a]},this);c=c.join(" ");for(var d=0;d<a.length;++d){if(typeof a[d]==="object")return!0;var e=d===a.length-1?this._isTokenizePrefixMatch(a[d],c):b("TokenizeUtil").isQueryMatch(a[d],c);if(e)return!0}return!1};c._getBootstrapMatchByType=function(a,b,c){__p&&__p();c===void 0&&(c=[]);var d=a.tokens.slice();if(d.length===0)return[];var e=d.map(function(){return{}}),f=d[d.length-1]==="",g={},h,i=f?d.length-1:d.length,j=d[i-1];if(i&&j.uid){this._pushBootstrapEntryAtPosition(e,i-1,j.uid,a.is_alias_search);return e}for(var k in this.bootstrapCache)if(i&&this.unicodeMatch.prefixMatch(k,j)&&(!f||k===j))for(h in this.bootstrapCache[k])this._addMatchedTerm(h,k,b),g[h]||(g[h]=1,this._pushBootstrapEntryAtPosition(e,i-1,h,a.is_alias_search));for(var f=i-2;f>=0;f--){if(typeof d[f]==="object")break;if(d[f].length&&d[f][0]=='"')break;for(h in this.bootstrapCache[d[f]])g[h]||(g[h]=0),g[h]+f==i-1&&(++g[h],this._addMatchedTerm(h,d[f],b),this._pushBootstrapEntryAtPosition(e,f,h,a.is_alias_search))}if(!a.is_alias_search&&a.potential_alias_term)for(h in this.bootstrapCache[a.potential_alias_term])this._addMatchedTerm(h,a.potential_alias_term,b),g[h]||(g[h]=1,this._pushBootstrapEntryAtPosition(e,0,h,a.is_alias_search));for(var j=c,f=Array.isArray(j),i=0,j=f?j:j[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){if(f){if(i>=j.length)break;d=j[i++]}else{i=j.next();if(i.done)break;d=i.value}b=d;this.getEntry(b)&&!g[b]&&(g[b]=1,this._pushBootstrapEntryAtPosition(e,0,b,a.is_alias_search))}return e};c._addMatchedTerm=function(a,b,c){(c[a]=c[a]||[]).push(b);return c};c._pushBootstrapEntryAtPosition=function(a,b,c,d){__p&&__p();var e=this.getEntry(c);if(!e)return;var f=[];f=[e.type];for(var e=0;e<f.length;e++){var g=f[e];if(d&&g!=="user"&&g!=="page")continue;a[b][g]===void 0&&(a[b][g]=[]);a[b][g].push(c)}};c._getNumTokensMatching=function(a,b){__p&&__p();var c=0,d=b.parse,e=a.length,f=null,g=null;if(d.pos!==void 0){var h=b.structure[b.chunks[d.pos]];h&&(f=h.uid,g=h.type.split(":")[2])}b.outputTokensUsed=[];b.termMatches=[];if(f){c=this._prefixMatchEntity(a,d,f,b.outputTokensUsed,g,!!b.useExtendedIndex,b.termMatches);if(c===0||c===e)return c}else if(d.suffix&&e==1&&d.suffix.indexOf(a[0])===0)return e;else if(d.suffix==a[0])++c;else return 0;h=[];d.remTokens=d.remTokens||[];for(var f=0;f<d.remTokens.length;f++){if(typeof a[c]!=="string"||b.chunks.length<=d.remTokens[f]||b.structure.length<=b.chunks[d.remTokens[f]]||b.structure[b.chunks[d.remTokens[f]]].uid)break;g=b.structure[b.chunks[d.remTokens[f]]].text;h.push(g.toLowerCase())}c=this._greedyMatchText(h,a,c,d.remTokens,b.outputTokensUsed,b.isNullState);return c==e-1&&a[c]===""?e:c};c._prefixMatchEntity=function(a,b,c,d,e,f,g){__p&&__p();b.entTokens=b.entTokens||[];if(b.entTokens.length===0){if(a[0]!=="")return 0;if(b.possessive&&a.length>1&&a[1]=="'s"){d.push([b.pos+1]);return 2}else return 1}var h=!1;c=this.getEntry(c,e);if(e!==void 0&&e!==c.fetchType)return 0;e=this.tokenize(f?c.textToIndex:c.text,!0);f=[];for(var c=0;c<a.length+b.entTokens.length-1;c++)c<b.entTokens.length-1?f.push(b.entTokens[c]):c==b.entTokens.length-1?f.push(b.entTokens[c]+a[0]):f.push(a[c-b.entTokens.length+1]);c=-b.entTokens.length+1;for(var i=0;i<f.length;++i){var j=f[i];if(typeof j!=="string")break;if(j===""){c++;continue}var k=!1;for(var l=0;l<e.length;l++)if(e[l]==j||i===f.length-1&&e[l].indexOf(j)===0){g&&g.push(e[l]);e[l]="";k=!0;++c;break}if(k)continue;if(!b.possessive||j.length<=2||j.substr(j.length-2)!="'s")break;k=j.substr(0,j.length-2);for(l=0;l<e.length;l++)if(e[l]==k){++c;d&&(h=!0);break}break}if(c>0){h&&d.push([b.pos+1]);return c}if(d===void 0)return 0;j=a[0];l=j;b.possessive&&j.length>=2&&j.substr(j.length-2)=="'s"&&(l=j.substr(0,j.length-2));b.suffix=b.suffix||"";if(a.length==1&&b.suffix.indexOf(j)===0||b.suffix==l||b.suffix==j){l!=j&&b.suffix==l&&d.push([b.pos+1]);return 1}return 0};c._tryMatchingFinalInsertedEntity=function(a,b,c){if(!c.completed||b<0)return b;var d=c.parse;d=d.remTokens[d.remTokens.length-1];c=c.structure[c.chunks[d]];d=this.getEntry(c.uid,c.type);c=this.tokenize(d.text,!0);b=this._greedyMatchText(c,a,b);return b==a.length-1&&a[b]===""?a.length:b};c._greedyMatchText=function(a,b,c,d,e,f){__p&&__p();for(var g=0;g<a.length;g++){var h=a[g];if(h==b[c]){e!==void 0&&e.push(d[g]);++c;continue}if(c===b.length-1&&h.indexOf(b[c])===0){e!==void 0&&(h==b[c]?e.push([d[g]]):e.push([d[g],b[c].length]));return b.length}if(f)break}return c};c._getBestQueryCache=function(a){for(var b=a.length;b>=0;b--){var c=this.queryCache[a.slice(0,b)];if(c)return c}};c._getFBObjectType=function(a){if(this.typeaheadTypeMap[a])return this.typeaheadTypeMap[a];else return"page"};c._isTokenizePrefixMatch=function(a,c){return b("TokenizeUtil").isPrefixMatch(this.unicodeMatch.prefixMatchPrepare(a),this.unicodeMatch.prefixMatchPrepare(c))};c.getBootstrapMatches=function(a,b){b===void 0&&(b=[]);var c={},d=this._getBootstrapMatchByType(a,c,b?b:[]);return this._addMatchingBootstrapResults(a,d[0]||{},c,b?b:[])};return a}();i.EPSILON=1e-5;i.getUniqueSemantic=function(a){__p&&__p();if(!a)return;var b=[],c=[],d=[];a="("+a+")";var e=a,f=!1;a.replace(/[\(\),]/g,function(g,h){__p&&__p();var i;switch(g){case",":var j=d.length-1;i=e.substr(d[j],h-d[j]);b[j].push(i);d[j]=h+1;break;case"(":d.push(h+1);b.push([]);c.push(h+1);break;case")":if(d.length===0)throw new Error(a+" is not a valid semantic string");j=d.pop();i=e.substr(j,h-j);i=decodeURI(i.replace(/%/g,"%25").replace(/\s/g,"+").trim());j=b.pop();j.push(i);i=j.sort();for(var j=1;j<i.length;j++)i[j]==i[j-1]&&(f=!0);j=i.join(",");e=e.substr(0,c.pop())+j+e.substr(h);break}return g});return f?"":e.replace(/\((.*)\)/,"$1")};var j=function(a){return a.keyword_type==="local"&&a.semantic.match(/[0-9]+\/local/)!=null},k=function(a){if(!j(a))return null;a=encodeURIComponent(a.name.replace(/\s+/g,"+"));return"str/"+a+"/keywords_search"},l=function(a,c){if(!b("CurrentUser").isWorkUser())return b("FacebarStructuredText").fromStruct(a.structure).toString().toLowerCase();a=k(a);a=a!=null?a:i.getUniqueSemantic(c);return a!=null?a.toLowerCase():null};e.exports=i}),null);
__d("FacebarSearchAllMessages",["fbt","FacebarGSv2Echo","FacebarStructuredText","URI","WorkGalahadEntityKey","WorkGalahadNavStore","WorkplaceSearchTypeaheadConfigs","WWWBase"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h;a={insertInto:function(a,c,d){a=b("FacebarGSv2Echo").normalizeValue(a);var e=this._getInsertionIndex(a,c);if(e>-1){a=this._createSearchMessagesResult(a,d);c.splice(e,0,a)}},_getInsertionIndex:function(a,c){return a.length>0&&b("WorkplaceSearchTypeaheadConfigs").unifySearchBox&&b("WorkGalahadNavStore").getSelectedAppTabID()==="chats"?0:-1},_createSearchMessagesResult:function(a,c){var d=g._("Search Messages for \"{queryString}\"",[g._param("queryString",a)]),e=b("WorkGalahadNavStore").getActiveEntityKeys();e=b("WorkGalahadEntityKey").getThreadID(e);var f=new(h||(h=b("URI")))(b("WWWBase").uri);e!=null?f.setPath("/chat/t/"+e):f.setPath("/chat");f.addQueryData("qa",a);return{uid:a,isAsync:!1,structure:b("FacebarStructuredText").fromString(d),semantic:a,text:a,uri:f,fromCache:c,type:"keyword",isSeeMessages:!0}}};e.exports=a}),null);
__d("FacebarTokenizer",["TokenizeUtil"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a='[^"]';var g=["\\s's","'s",'"'+a+'*"?'],h=[[/\s+$/,""],[/\"\s+/,'"'],[/\s+\"/,'"'],[/\"\"/,""],[/^\"$/,""],[/\s+/," "]];c={tokenize:function(a,c){__p&&__p();var d=[],e=0;a=a.replace(/\s/g," ").toLowerCase();a.replace(new RegExp(g.join("|"),"g"),function(f,g){__p&&__p();if(g>e){var i=a.substr(e,g-e);Array.prototype.push.apply(d,b("TokenizeUtil").parse(i).tokens.slice(0))}i=f;for(var j=0;j<h.length;j++){var k=h[j];i=i.replace(k[0],k[1])}d.length&&i=="'s"?d[d.length-1]+=i:i!==""&&d.push(i);c&&Array.prototype.push.apply(d,b("TokenizeUtil").parse(f).tokens);e=g+f.length});if(e<a.length){var f=a.substr(e,a.length-e);Array.prototype.push.apply(d,b("TokenizeUtil").parse(f).tokens.slice(0))}return d}};e.exports=c}),null);
__d("ResultsBucketizer",["FacebarGlobalOptions","FacebarJSConstants"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a=function(){__p&&__p();function a(a,b){this.$1=a,this.$2=b}a.trimResults=function(a,b,c){var d=[];a.forEach(function(a,c){a.indexBeforeBuckets>b&&d.push({index:c,originalIndex:a.indexBeforeBuckets})});d.sort(function(a,b){return a.originalIndex-b.originalIndex}).slice(c).sort(function(a,b){return b.index-a.index}).forEach(function(b){a.splice(b.index,1)})};a.mergeBuckets=function(b,c){var d=[];for(var e in c)!c[e].rule.hidden&&(!c[e].rule.xor||!c[c[e].rule.xor])&&d.push(c[e]);d.sort(function(a,b){var c=(a.rule.position||0)-(b.rule.position||0);return c!==0?c:a.results[0].indexBeforeBuckets-b.results[0].indexBeforeBuckets});b.length=0;d.forEach(function(c,e){c.rule.maxPromotions!=null&&e<d.length-1&&a.trimResults(c.results,d[e+1].results[0].indexBeforeBuckets,c.rule.maxPromotions),Array.prototype.push.apply(b,c.results)}.bind(this))};var c=a.prototype;c.$3=function(a,b){if(b.propertyName==null)return b.bucketName||"default";a=this.$2(a,b.propertyName);return a==null||b.propertyValue!=null&&""+a!==b.propertyValue?!1:b.bucketName||b.propertyName+"."+a};c.$4=function(a,c,d){__p&&__p();var e={};d==null&&(d=b("FacebarGlobalOptions").default_num_top_results_to_show);a.forEach(function(a,f){__p&&__p();c.some(function(c){__p&&__p();var f=this.$3(a,c);if(f===!1)return!1;e[f]==null&&(e[f]={results:[],rule:c});if(f===b("FacebarJSConstants").keywordType&&e[f].results.length>=d)return!0;if(!!c.maxResults&&e[f].results.length>=c.maxResults)return!0;a.bucketLineage.push({bucketName:f,bucketIndex:e[f].results.length});e[f].results.push(a);return!0}.bind(this))}.bind(this));return e};c.$5=function(b,c,d){__p&&__p();c=this.$1[c];if(!c)return{};c=this.$4(b,c,d);for(var e in c){var f=c[e].rule.subBucketRules;f&&this.$5(c[e].results,f,d)}a.mergeBuckets(b,c);return c};c.$6=function(a,b,c){if(b.length<=c)return b.slice();a=b.map(function(a){return a.indexBeforeBuckets});var d=a.sort(function(a,b){return a-b})[c];return d==null?b:b.filter(function(a){return a.indexBeforeBuckets<d})};c.bucketize=function(a,b,c,d){a.forEach(function(a,b){a.bucketLineage=[],a.indexBeforeBuckets=b});c=c||{};Object.assign(c,this.$5(a,"main",d));d=this.$6(c,a,b);return d};return a}();e.exports=a}),null);
__d("SearchBootstrapCache",["AsyncRequest","AsyncResponse","CacheStorage","SearchBootstrapCacheConstants"],(function(a,b,c,d,e,f){__p&&__p();var g=1;a={get:function(a,c,d,e,f){__p&&__p();var g=this.getKey(a,c,d),h=this.getStorage(),i=h.get(g);h=b("SearchBootstrapCacheConstants")[c.type]||36e5;if(i==null||Date.now()-i.timestamp>h)f(d,a,c);else{g=new(b("AsyncRequest"))();g.getData=function(){return i.requestData};h=new(b("AsyncResponse"))(g,i.payload);e(h,c)}},set:function(a,b,c){var d=a.getRequest().getData();this.getStorage().set(this.getKey(d,b,c),{timestamp:Date.now(),payload:a.payload,requestData:d})},getKey:function(a,b,c){return JSON.stringify({filter:a.filter,context:a.context,viewer:a.viewer,lazy:a.lazy,token:a.token,type:b.type,bootstrapEndpoint:c})},getStorage:function(){return new(b("CacheStorage"))("localstorage","_SearchBootstrapCache_"+g)}};e.exports=a}),null);
__d("SearchSingleState",["fbt"],(function(a,b,c,d,e,f,g){__p&&__p();function h(a,b,c,d){return{classNames:"grammar",groupIndex:0,indexInGroup:a,path:b,text:c,type:"grammar",uid:d}}a={getSuggestions:function(a,b,c){if(c==="ent:user")return this.getSuggestionsForUser(a,b);else if(c==="ent:page")return this.getSuggestionsForPage(a,b);else if(c==="ent:app")return this.getSuggestionsForApp(a,b);else if(c==="ent:group")return this.getSuggestionsForGroup(a,b)},getSuggestionsForUser:function(a,b){return[h(0,"/search/"+a+"/photos-of",g._("photos of {full name}",[g._param("full name",b)]),"photos_of_user"),h(1,"/search/"+a+"/friends",g._("friends of {full name}",[g._param("full name",b)]),"friends_of_user"),h(2,"/search/"+a+"/pages-liked",g._("favorite pages of {full name}",[g._param("full name",b)]),"pages_liked_user"),h(3,"/search/str/"+b+"/users-named",g._("find all people named \"{full name}\"",[g._param("full name",b)]),"people_named_text")]},getSuggestionsForPage:function(a,b){return[h(0,"/search/"+a+"/photos-of",g._("photos of {name of page}",[g._param("name of page",b)]),"photos_of_page"),h(1,"/search/"+a+"/likers",g._("people who like {name of page}",[g._param("name of page",b)]),"page_likers"),h(2,"/search/str/"+b+"/pages-named",g._("find all pages named \"{name of page}\"",[g._param("name of page",b)]),"pages_named_text")]},getSuggestionsForGroup:function(a,b){return[h(0,"/search/"+a+"/members",g._("{name of group} members",[g._param("name of group",b)]),"members_of_group"),h(1,"/search/"+a+"/photos-in",g._("photos in {name of groups}",[g._param("name of groups",b)]),"photos_in_group"),h(2,"/search/"+a+"/creators",g._("{name of group} creators",[g._param("name of group",b)]),"creators_of_group"),h(3,"/search/"+a+"/admins",g._("{name of group} administrators",[g._param("name of group",b)]),"admins_of_group")]},getSuggestionsForApp:function(a,b){return[h(0,"/search/"+a+"/apps-similar-to",g._("apps similar to {name of app}",[g._param("name of app",b)]),"similar_apps"),h(1,"/search/"+a+"/app-users",g._("people who use {name of app}",[g._param("name of app",b)]),"app_users"),h(2,"/search/str/"+b+"/pages-named",g._("find all apps named \"{name of page}\"",[g._param("name of page",b)]),"apps_named_text")]}};e.exports=a}),null);
__d("SearchDataSource",["Arbiter","AsyncResponse","CSRFGuard","CurrentUserInitialData","DataSource","Event","FacebarJSConstants","HashtagSearchResultUtils","PageTransitionsRegistrar","SearchBootstrapCache","SearchRegion","SearchSingleState","UnicodeCJK","XHRRequest","createArrayFromMixed","debounce"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g,h=100,i="/typeahead/search/facebar/nullstate/";a=function(a){__p&&__p();babelHelpers.inheritsLoose(c,a);function c(b){__p&&__p();var c;b.headerflags=new Map();c=a.call(this,b)||this;c._updateMaxResults=function(){var a=window.innerHeight||document.documentElement.clientHeight;c.setMaxResults(Math.max(c._numResults.min,Math.min(c._numResults.max,Math.ceil(2+(a-370)/56))))};c._token=b.token||"";c._lazyonload=b.lazyonload!==!1;c._extraTypes=b.extraTypes;c._buckets=b.buckets;c._noMultiFetch=b.noMultiFetch||!1;c._nullStateConfig=b.nullStateConfig||{};var d=b.maxResults||8;c._numResults={min:3,max:d};c.recordingRoute=b.recordingRoute||"non_banzai";c._enabledHashtag=b.enabledHashtag||!1;c.logBackendQueriesWindow=b.logBackendQueriesWindow||25;c._genTime=b.genTime;c._bootstrapError=!1;c._hasKeywordBootstrap=b.hasKeywordBootstrap||!1;c._addJoinedTermsMatching=b.addJoinedTermsMatching||!1;c._useBootstrapCache=b.useBootstrapCache||!1;c._useBrowserCache=b.useBrowserCache||!1;c.cacheUnicodeMatch.setConfigs({prefix_hangul_conjoining_jamo:!0,prefix_kana_drop_trailing_latin:b.cjkDropLatinInCjTokens,prefix_kana_hiragana_to_katakana:b.cjkUiCacheHiraganaToKatakana,search_i18n_prefix_arabic_normalization:b.arabicNormalization});c.backendUnicodeMatch.setConfigs({prefix_kana_drop_trailing_latin:b.cjkDropLatinInCjTokens});return c}var d=c.prototype;d.init=function(){__p&&__p();a.prototype.init.call(this);this._leanPayload=null;this._bootstrapRequestsPending=0;this._criticalOnly=!0;this._updateMaxResults();var c=b("debounce")(this._updateMaxResults,h,this,!0);b("Event").listen(window,"resize",c);this._nullStateConfig.prefetchNullState&&this.fetchNullState("");this._nullStateConfig.singleState&&b("Arbiter").subscribe("page_transition",this.handlePageTransition.bind(this));(this._nullStateConfig.prefetchNullState||this._nullStateConfig.singleState)&&b("Arbiter").subscribe("search/updateNullState",this.updateNullState.bind(this));this._nullStateConfig.recent&&b("Arbiter").subscribe("search/refreshRecentSearchesNullstate",this.refreshRecentSearches.bind(this))};d.refreshRecentSearches=function(){this.nullStateData=null};d.handlePageTransition=function(){this.nullStateParams={}};d.updateNullState=function(a,b){this.nullStateParams=b,this.fetchNullState()};d.markResultsAsNullState=function(a){__p&&__p();if(a)for(var a=a,b=Array.isArray(a),c=0,a=b?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var d;if(b){if(c>=a.length)break;d=a[c++]}else{c=a.next();if(c.done)break;d=c.value}d=d;d.isNullState=!0}};d.markResultsAsSingleState=function(a){__p&&__p();if(a)for(var a=a,b=Array.isArray(a),c=0,a=b?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var d;if(b){if(c>=a.length)break;d=a[c++]}else{c=a.next();if(c.done)break;d=c.value}d=d;d.isSingleState=!0}};d.fetchNullState=function(a){this.lastNullOrSingleStateFetchStartTime=Date.now();if(!this._nullStateConfig.hasNullState)return;var b=null;this.nullStateParams&&this.nullStateParams.uid?(this.nullStateParams.query=a||"",b=this._fetchDataForSingleState(),this.markResultsAsNullState(b)):(b=this._fetchDataForNullState(),this.markResultsAsSingleState(b));b&&this.inform("respond",{value:this.nullStateParams?this.nullStateParams.query:"",results:b,isAsync:!1,nullState:!0})};d._fetchDataForSingleState=function(){__p&&__p();if(this.nullStateDataWithProfile&&this.nullStateParams.uid===this.nullStateDataWithProfile.profileID)return this.nullStateDataWithProfile.data;if(this.nullStateParams.type==="ent:app"||this.nullStateParams.type==="ent:group"||this.nullStateParams.type==="ent:page"){this.fetch(i,{profile_id:this.nullStateParams.uid,ent_type:this.nullStateParams.type},{singleState:!0});this.nullStateDataWithProfile={profileID:this.nullStateParams.uid};return}var a=b("SearchSingleState").getSuggestions(this.nullStateParams.uid,this.nullStateParams.text,this.nullStateParams.type);if(!a)return this._fetchDataForNullState();this.nullStateDataWithProfile={data:a,profileID:this.nullStateParams.uid};return a};d._shouldRefreshNullState=function(){if(!this._nullStateConfig.recent)return!1;var a=window.location.href;if(!a)return!1;return a.contains("allactivity")&&a.contains("log_filter=search")?!0:!1};d._fetchDataForNullState=function(){var a=this;if(this.nullStateData&&!this._shouldRefreshNullState()){this.markResultsAsNullState(this.nullStateData);window.setTimeout(function(){a.inform("respond",{value:"",results:a.nullStateData,isAsync:!0,nullState:!0})},0);return}this.fetchingNullState||(this.fetchingNullState=!0,this.fetch(i,{value:""},{nullState:!0,value:""}));return null};d.dirty=function(){a.prototype.dirty.call(this),this._bootstrapError=!1,this._fetchOnUseRequests=[]};d.asyncErrorHandler=function(a,b){b.nullState&&(this.fetchingNullState=!1),b.bootstrap&&(this._bootstrapError=!0),this.inform("fetchError",{response:a,fetch_context:b})};d.fetch=function(c,d,e){e=e||{};e.fetch_start=Date.now();var f=b("PageTransitionsRegistrar").getMostRecentURI().getPath();d=babelHelpers["extends"]({},d,{path:f});a.prototype.fetch.call(this,c,d,e)};d.xhrFetchHandler=function(a,c,d){a=b("CSRFGuard").clean(a);a=JSON.parse(a);return this.fetchHandler(new(b("AsyncResponse"))(null,a.payload),d,c)};d.fetchHandler=function(c,d,e){__p&&__p();e===void 0&&(e=null);if(d.nullState){this.fetchingNullState=!1;this.nullStateData=c.getPayload().entries;this.markResultsAsNullState(this.nullStateData);this.inform("respond",{value:"",results:this.nullStateData,isAsync:!0,nullState:!0});return}if(d.singleState){this.nullStateDataWithProfile.data=c.getPayload().entries;this.markResultsAsSingleState(this.nullStateDataWithProfile.data);this.inform("respond",{results:this.nullStateDataWithProfile.data,isAsync:!0,value:this.nullStateParams?this.nullStateParams.query:"",nullState:!0});return}var f=c.getPayload(),g=babelHelpers["extends"]({fetch_end:Date.now()},d),h=g.value?"event":"persistent";this.inform("beginFetchHandler",{response:c});d.bootstrap&&(this._bootstrapError=!1);var i=e===null?c.getRequest().uri.getPath():e.getURI().getPath();i===this.bootstrapEndpoint&&this._useBootstrapCache&&b("SearchBootstrapCache").set(c,d,this.bootstrapEndpoint);if(d.type=="lean")this._leanPayload=f,this._processLean();else{f.coeff2_ts&&(g.coeff2_ts=f.coeff2_ts);a.prototype.fetchHandler.call(this,c,d);i=e===null?c.getRequest().getData():e.getData();d.bootstrap&&!i.no_cache&&(g.browserCacheHit=f.timestamp<this._genTime);d.bootstrap&&!f.no_data&&this._bootstrapRequestsPending>0&&(d.bootstrap=!1,--this._bootstrapRequestsPending,this._bootstrapRequestsPending||this._bootstrapPostProcess());if(f.no_data||f.stale||f.token!==this._token){e=babelHelpers["extends"]({},i);e.lazy&&(delete e.lazy,e.token=this._token,this._fetchOnUse(e,d))}}this.inform("endpointStats",{info:g,response:c},h);d&&!!d.value&&this.inform("completeFetch",{response:c,stats:g})};d.respond=function(a,b,c){this.inform("respondValidUids",b);this.inform("reorderResults",b);b=this.buildData(b,a);b.forEach(function(a,b){a.origIndex=b,a.fromCache=!c});this.inform("respond",{value:a,results:b,isAsync:!!c});return b};d.buildData=function(a,b){if(!a||a.length===0)return[];b=a.map(this.getEntry,this);b.length=Math.min(b.length,this._maxResults);return b};d.fetchLean=function(){this._fetchLean()};d._isQueryTooShort=function(a){return a.length<this._minQueryLength&&!this._performShortQuery&&!b("UnicodeCJK").hasIdeoOrSyll(a)};d.shouldFetchMoreResults=function(a){return a.length<this._maxResults};d._bootstrapPostProcess=function(){var a=0;for(var b in this._data)Object.prototype.hasOwnProperty.call(this._data,b)&&a++;this.inform("bootstrapped",{time:Date.now(),size:a},"persistent");this._processLean()};d._processLean=function(){if(this._leanPayload){var a,b=this._leanPayload.entries;for(var c in b)a=this.getEntry(c),a&&(a.index=b[c]);this.setExclusions(this._leanPayload.blocked);this._leanPayload=null}};d._bootstrapFetch=function(a,b){b=babelHelpers["extends"]({},b,this.bootstrapData);this._criticalOnly&&this._lazyonload&&(b.lazy=1);a={bootstrap:!0,type:a};this._fetchBootstrapMaybeCache(b,a);++this._bootstrapRequestsPending};d._fetchBootstrapMaybeCache=function(a,c){__p&&__p();var d=this;if(this._useBootstrapCache)b("SearchBootstrapCache").get(a,c,this.bootstrapEndpoint,this.fetchHandler.bind(this),this.fetch.bind(this));else if(this._useBrowserCache){var e=new(b("XHRRequest"))(this.bootstrapEndpoint).setData(babelHelpers["extends"]({},a,{__user:(g||(g=b("CurrentUserInitialData"))).USER_ID,__a:1})).setMethod("GET").setResponseHandler(function(a){return d.xhrFetchHandler(a,e,c||{})}).setErrorHandler(function(a){return d.asyncErrorHandler(a,c)});this.inform("beforeFetch",{request:e,fetch_context:c});e.send()}else this.fetch(this.bootstrapEndpoint,a,c)};d._fetchOnUse=function(a,b){for(var c in this.bootstrapData)Object.prototype.hasOwnProperty.call(a,c)||(a[c]=this.bootstrapData[c]);this._criticalOnly?this._fetchOnUseRequests.push({args:a,ctx:b}):this._fetchBootstrapMaybeCache(a,b)};d._fetchLean=function(){var a={no_cache:1};a.options=b("createArrayFromMixed")(a.options);a.options.push("lean");this._fetchOnUse(a,{type:"lean"})};d.bootstrap=function(a){__p&&__p();a||(this._criticalOnly=!1,this._flushFetchOnUseRequests());if(this._bootstrapped)return;a={filter:["event"]};this._fetchOnUse(a,{type:"event"});a=["app","page","group","friendlist"];a=a.concat(this._extraTypes||[]);var c=[];this._hasKeywordBootstrap&&c.push(b("FacebarJSConstants").keywordType);if(this._noMultiFetch)a.push("user"),a=a.concat(c),this._bootstrapFetch("user",{filter:a});else{this._bootstrapFetch("other",{filter:a});if(this._buckets)for(var a=0;a<this._buckets.length;++a){var d={filter:["user"],buckets:this._buckets[a]};this._bootstrapFetch("user",d)}else this._bootstrapFetch("user",{filter:["user"]});c.length>0&&this._bootstrapFetch("keyword",{filter:c})}this._fetchLean();this._bootstrapped=!0};d.getBootstrapError=function(){return this._bootstrapError};d._flushFetchOnUseRequests=function(){var a=this._fetchOnUseRequests.length;for(var b=0;b<a;++b){var c=this._fetchOnUseRequests[b];this._fetchBootstrapMaybeCache(c.args,c.ctx)}a>0&&this.inform("extra_bootstrap",{time:Date.now()},"persistent");this._fetchOnUseRequests=[]};d.onLoad=function(a,b){this.inform("onload",{time:Date.now()},"persistent"),a&&window.setTimeout(this.bootstrap.bind(this,b),0)};d.mergeUids=function(b,c,d,e){__p&&__p();var f=this.getDynamicHashtagResult(e);e&&f&&c.indexOf(f)<=0&&c.unshift(f);f=d[0]?this.getEntry(d[0]):null;var g=c[0]?this.getEntry(c[0]):null;f=f&&f.replace_results?f:null;f=!f&&g&&g.replace_results?g:f;g=a.prototype.mergeUids.call(this,b,c,d,e);if(f){this.inform("backend_topreplace",{});return this.deduplicateByKey([f.uid].concat(g))}return g};d.getTextToIndexFromFields=function(a,b){var c=[],d=a.tokenVersion==="v2";for(var e=0;e<b.length;++e){if(d&&(b[e]==="text"||b[e]==="alias"))continue;var f=a[b[e]];f&&(f=f.join?f.join(" "):f,c.push(f),b[e]=="text"&&this._addJoinedTermsMatching&&(f=f.toLowerCase(),f=f.replace(/ /g,""),c.push(f)))}return c.join(" ")};d.getDynamicHashtagResult=function(a){if(!a||!this._enabledHashtag)return;var c=b("HashtagSearchResultUtils").getHashtagFromQuery(a);if(!c)return;var d="hashtag:"+c,e=this.getEntry(d);e||this.processEntries([b("HashtagSearchResultUtils").makeTypeaheadResult(c)],a);return d};d.tokenizeCache=function(a,b){a=this.cacheUnicodeMatch.prefixMatchPrepare(a);a=this._tokenize(a,b);b=a.tokens;b.length>0&&a.value.startsWith("@")&&(b[0]="@"+b[0]);return a};return c}(b("DataSource"));e.exports=a}),null);
__d("FacebarDataSource",["invariant","Arbiter","AsyncRequest","CurrentUser","FacebarGlobalOptions","FacebarGSv2Echo","FacebarInviteCoworkers","FacebarJSConstants","FacebarKeywordSearchUtils","FacebarResultStore","FacebarResultStoreUtils","FacebarSearchAllMessages","FacebarStructuredText","FacebarTimerUtils","FacebarTokenizer","FacebarURI","ResultsBucketizer","ResultsBucketizerConfig","SearchDataSource","URI","Vector","ViewportBounds","WorkGalahadNavStore","WorkplaceSearchTypeaheadConfigs","XFacebookWorkChatInboxController","emptyFunction","qex","queryThenMutateDOM","throttle"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h,i=50,j=(a=b("qex")._("1176022"))!=null?a:!1,k=13,l={};c=function(a){__p&&__p();babelHelpers.inheritsLoose(c,a);function c(c){__p&&__p();var d;d=a.call(this,c)||this;d.executeQuery=function(a,c,e){__p&&__p();d._useCustomQueryId!==!0&&d._curQueryId++;e!=null&&(e.queryId=d._curQueryId,e.startCacheQuery=b("FacebarTimerUtils").getTimestamp());var f=d.getMaxResults(),g=b("CurrentUser").isWorkUser()&&b("WorkGalahadNavStore").getSelectedAppTabID()==="chats";d.setQueryData({qid:d._curQueryId,max_results:f,galahad_chat_tab:g});d.inform("beforeQuery",{value:a,queryId:d._curQueryId});d.value=a;f=d.buildUids(a,[]);e!=null&&(e.endCacheQuery=b("FacebarTimerUtils").getTimestamp());c&&f.length===0&&f.push(c);d.inform("query",{value:a,results:f,queryId:d._curQueryId});d.resultStore&&d.respond(a,f,!1,!1,e)};d.sendRemoteQuery=function(a,c,e){__p&&__p();var f=d.getQueryData(a.text_form),g=e!=null?e.queryId:0;f=new(b("AsyncRequest"))().setURI(d.queryEndpoint).setData(f).setMethod("GET").setReadOnly(!0).setAllowCrossPageTransition(!0).setHandler(function(b,d){this.handleQueryResponse(d,b,a,c,e)}.bind(babelHelpers.assertThisInitialized(d),g)).setFinallyHandler(function(){d.activityEnd()});for(var h=d._headerflags,i=Array.isArray(h),j=0,h=i?h:h[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var k;if(i){if(j>=h.length)break;k=h[j++]}else{j=h.next();if(j.done)break;k=j.value}k=k;var l=k[0];k=k[1];f.setRequestHeader(l,k)}d.inform("sending_request",f);d._maxRemoteQueryId=g;e!=null&&(e.waitingQueries=d._waitingQueries,e.inflightRequests=b("AsyncRequest").getInflightCount(),e.startRemoteQuery=b("FacebarTimerUtils").getTimestamp());f.send();d.activityStart()};d.renderResults=function(a,c,e,f,g){g!=null?l[String(a)]=g:g=l[String(a)],b("FacebarGSv2Echo").insertInto(a,c,!e,d._single_state,d._is_local,d._categoryName),!!a&&a instanceof b("FacebarStructuredText")&&!a.isEmptyOrWhitespace()&&!d._bypassBucketizer&&(c=d._bucketizeResults(a,c,g)),c.length=Math.min(c.length,d.getMaxResults()),d.injectExtraResults(a,c),f=e&&c.length===0,d.inform("respond",{value:a,results:c,isAsync:!!e,isEmptyResults:f})};d._fetched_null_state=null;d._initialQueryData=null;d._curQueryId=-1;d._maxRemoteQueryId=-1;d._single_state=!1;d._is_local=!1;d._categoryName=null;d._waitingQueries=0;d.mixGrammarAndEntity=c.mixGrammarAndEntity!==void 0?c.mixGrammarAndEntity:!0;d._isInjectedSuggestionFlow=!1;d._useCustomQueryId=!1;d.grammarVersion=c.grammarVersion||"";c.grammarOptions||(c.grammarOptions={});d._headerflags=c.headerflags||new Map();d.recordingRoute="banzai_vital";d._maxGrammarResults=c.grammarOptions.maxGrammarResults;d.nullStateEndpoint=c.nullStateEndpoint||"/ajax/browse/null_state.php";d.setNullStateData(c.nullStateData||{},!0);d._minQueryLength=c.minQueryLength||-1;d._performShortQuery=c.performShortQuery||!1;d._fixProcessLean=c.grammarOptions.fixProcessLean||!1;d.throttleExecuteQuery();d.throttleSendRemoteQuery();d.throttleRenderResults();d.resultStoreOptions=c.grammarOptions||{};d.resultStoreOptions.useNewExactNameMatch=c.grammarOptions.useNewExactNameMatch==="true";d.defaultQuery=null;d._bypassBucketizer=!1;d._resultsBucketizer=new(b("ResultsBucketizer"))(b("ResultsBucketizerConfig").rules,function(a,b){switch(b){case"isSeeMore":return a.isSeeMore;case"objectType":return a.type;case"resultSetType":return a.isWorkplacePost?"workpost":null;case"renderType":return a.render_type||a.type;case"cacheOnlyResult":return a.cacheOnlyResult;case"closeEntity":return a.bootstrapped||(a.tags?a.tags[b]:void 0);default:return a.tags?a.tags[b]:void 0}});d.fetchNullState();d.initWithConfig(b("FacebarGlobalOptions").grammarConfig);d.subscribe("bootstrapped",function(){b("Arbiter").subscribe("FacebarDataSource.getBootstrapMatches",function(b,a){a.callback.call(null,d.getBootstrapMatches(a.query,a.whitelistedEntIds))})});return d}var d=c.prototype;d.initWithConfig=function(a){this.facebarConfig=a,this.createResultStore(),this._fetched_null_state&&(this.setNullState(this._fetched_null_state),this._fetched_null_state=null)};d.throttleExecuteQuery=function(){var a=b("FacebarGlobalOptions").executeQueryThrottleTime;this.executeQueryThrottled=b("throttle").withBlocking(this.executeQuery,a,this)};d.throttleSendRemoteQuery=function(){var a=b("FacebarGlobalOptions").sendRemoteQueryThrottleTime;a===0?this.sendRemoteQueryThrottled=this.sendRemoteQuery:this.sendRemoteQueryThrottled=b("throttle").withBlocking(this.sendRemoteQuery,a,this)};d.throttleRenderResults=function(){var a=this,c=b("FacebarGlobalOptions").renderThrottleTime;if(c===0){this.renderResultsThrottled=this.renderResults;return}var d=Date.now();this.renderResultsThrottled=function(b,e,f,g,h){var i=Date.now();(f||d+c<i)&&(d=i,a.renderResults(b,e,f,g,h))}};d.createResultStore=function(){this.facebarConfig.maxGrammarResults=this._maxGrammarResults,b("CurrentUser").isWorkUser()?(this.facebarConfig.enableExactQueryMatchCost=!0,this.facebarConfig.non_exact_query_match_penalty=.5):(this.facebarConfig.enableExactQueryMatchCost=!1,this.facebarConfig.non_exact_query_match_penalty=0),this.resultStore=new(b("FacebarResultStore"))(this.facebarConfig,b("FacebarTokenizer").tokenize,this.getEntry.bind(this),this.resultStoreOptions),this._fixProcessLean&&this._processLean(),this.subscribe("setSortFunction",function(a,b){this.resultStore.setSortFunction(b)}.bind(this))};d.dirty=function(){this._nullStateFetched=!1,this.resultStore.resetCaches(),a.prototype.dirty.call(this)};d.refreshNullstate=function(a,c){a===void 0&&(a=b("emptyFunction")),c===void 0&&(c=b("emptyFunction")),this._nullStateFetched=!1,this.fetchNullState(a,c)};d.addEntries=function(a){this.resultStore.addBootstrap(this.processEntries(a))};d._processLean=function(){__p&&__p();if(this._fixProcessLean){if(this._leanPayload&&this.resultStore){var b,c=this._leanPayload.entries;for(var d in c){b=this.getEntry(d);if(!b)continue;for(var e in c[d])b.grammar_costs||(b.grammar_costs={}),b.grammar_costs["{"+e+"}"]=c[d][e]}this.setExclusions(this._leanPayload.blocked);this._leanPayload=null}}else a.prototype._processLean.call(this)};d.setNullStateData=function(a,b){b&&(this.nullStateData={grammar_version:this.grammarVersion});Object.assign(this.nullStateData,a);return this};d.setNullState=function(a){__p&&__p();var c={};a.queries=a.queries.filter(function(a){if(a.isWorkplacePost)return!0;a=a.parse.display.join(" ").toLowerCase();if(!c[a]){c[a]=!0;return!0}return!1});this._null_state=a;this.processEntries(this._null_state.entities);this.resultStore.setNullState(this._null_state.queries);this.resultStore.addNullStateToQueryCache(this.getRawStructure(b("FacebarStructuredText").fromString("")))};d.getNullStateTrending=function(){return this._null_state.trending};d.setSingleState=function(a){this._single_state=a};d.getSingleState=function(){return this._single_state};d.setLocal=function(a){this._is_local=a};d.setCategoryName=function(a){this._categoryName=a};d.overrideNullState=function(a){this._null_state!=null||g(0,5553),this._original_null_state=this._original_null_state||this._null_state,this.setNullState(a)};d.restoreNullState=function(){this._original_null_state&&this.setNullState(this._original_null_state)};d.fetchNullState=function(a,c){__p&&__p();a===void 0&&(a=b("emptyFunction"));c===void 0&&(c=b("emptyFunction"));if(this._nullStateFetched){this.activityStart();setTimeout(this.activityEnd.bind(this),0);a();return}var d=new(b("AsyncRequest"))().setURI(this.nullStateEndpoint).setData(this.nullStateData).setMethod("GET").setReadOnly(!0).setAllowCrossPageTransition(!0).setHandler(function(b){this.resultStore?(this.setNullState(b.payload),this.inform("nullstateReady",!0)):this._fetched_null_state=b.payload,this._nullStateFetched=!0,a()}.bind(this)).setErrorHandler(function(){c()}).setFinallyHandler(this.activityEnd.bind(this));this.activityStart();d.send()};d.toTypeaheadEntryUid=function(a,c){__p&&__p();var d,e=b("FacebarStructuredText").fromStruct(c.structure),f=e.getFragment(0);if(e.getCount()==1&&f.isType("ent")){var g=f.getType().split(":")[2];d=this.getEntry(f.getUID(),g);d.type=this.resultStore.stripBrackets(c.type)}else d=this.getEntry(c.tuid),d||(d={dynamic_cost:c.dynamic_cost,extra_uri_params:c.extra_uri_params,memcache:c.fromMemcache,photo:c.photo,results_set_type:c.resultsSetType,tuid:c.tuid,type:c.type,uid:c.tuid,tags:c.tags},this.processEntries([d]),d=this.getEntry(c.tuid)),d.icon_class=c.iconClass,d.unseen_posts=c.unseen_posts,d.category=c.category,d.subtext=c.subtext,d.boldedSubtext=c.boldedSubtext,d.is_work_foreign_entity=c.is_work_foreign_entity,d.official_status=c.official_status;d.error_info=c.errorInfo;d.logInfo=c.logInfo;d.itemLoggingInfo=c.item_logging_info;d.itemLoggingId=c.item_logging_id;d.structure=e;d.text=d.structure.toString();d.queryTypeText=c.queryTypeText;d.semantic=!!c.isSingleState&&c.singleStateSemantic?c.singleStateSemantic:c.semantic;d.alternateSemantic=c.alternateSemantic;d.tree=c.tree;d.cost=c.cost;d.isSeeMore=!!c.isSeeMore;d.isNullState=!!c.isNullState;d.isSingleState=!!c.isSingleState;d.keywordSource=c.keywordSource;d.keyword=c.keyword;f=c.keyword_type;d.keywordType=f;d.isTrending=!!c.isTrending||c.keywordBootstrapType===b("FacebarJSConstants").keywordBootstrapTypes.trending||f===b("FacebarJSConstants").keywordTypes.trending;d.isCelebrity=f===b("FacebarJSConstants").keywordTypes.celebrity;d.isFootball=f===b("FacebarJSConstants").keywordTypes.football;d.isPhotos=f===b("FacebarJSConstants").keywordTypes.photos;d.isVideos=f===b("FacebarJSConstants").keywordTypes.videos;d.isHashtag=f===b("FacebarJSConstants").keywordTypes.hashtag;d.isLocal=f===b("FacebarJSConstants").keywordTypes.local||f===b("FacebarJSConstants").keywordTypes.local_category;d.isCompany=f===b("FacebarJSConstants").keywordTypes.company;d.isMovie=f===b("FacebarJSConstants").keywordTypes.movie;d.isHappeningNow=f===b("FacebarJSConstants").keywordTypes.happeningNow;d.isSpecialIntentGeneric=f===b("FacebarJSConstants").keywordTypes.specialIntentGeneric;d.isLink=f===b("FacebarJSConstants").keywordTypes.link;b("FacebarJSConstants").intentKeys.map(function(a){d.isSpecialIntent=d.isSpecialIntent||d[a]});d.isRecent=!!c.isRecent;d.isNullState&&(d.isWorkplacePost=!!c.isWorkplacePost,d.postUri=c.postUri,d.attachedPhoto=c.attachedPhoto);d.isWorkplacePost&&(d.uri=new(h||(h=b("URI")))(d.postUri));d.isPrefetched=!!c.isPrefetched;d.isSuggestion=!!c.isSuggestion;d.isInjectedSuggestion=!!c.isInjectedSuggestion;d.isFromGSEF=!!c.isFromGSEF;d.isGloballyCachedKeyword=!!c.isGloballyCachedKeyword;d.entityInfo=c.entityInfo;d.cacheOnlyResult=c.cacheOnlyResult||!1;if(!b("CurrentUser").isWorkUser()&&(!b("FacebarGlobalOptions").logSERPClickAsRecentSearch||!c.isNullState)){g=b("FacebarStructuredText").fromStruct(c.structure).toString().toLowerCase();e=b("FacebarKeywordSearchUtils").makeFacebarEntry(g);d.uri=e.uri;d.semantic=e.semantic;d.structure=e.structure}else d.uri=d.uri||b("FacebarURI").getURI(this.facebarConfig,d);b("WorkplaceSearchTypeaheadConfigs").unifySearchBox&&b("WorkGalahadNavStore").getSelectedAppTabID()==="chats"&&d.type==="user"&&(d.uri=b("XFacebookWorkChatInboxController").getURIBuilder().setString("thread_key",d.semantic).getURI());d.parse=c.parse;d.tags=c.tags||{};d.isKeywordL2=c.isKeywordL2||!1;d.exactMatchKeyword=c.exactMatchKeyword||!1;d.qid=c.qid;d.templateID=c.templateID;c.isJSBootstrapMatch&&(d.isJSBootstrapMatch=c.isJSBootstrapMatch,d.backendCost=c.backendCost,d.bootstrapCost=c.bootstrapCost,d.keywordBootstrapType=c.keywordBootstrapType);this._replaceCategoryWithTermMatches(a,d,c);return d.tuid};d._replaceCategoryWithTermMatches=function(a,b,c){__p&&__p();if(b.type!=="user"&&b.type!=="page")return;if(!b.term_to_subtitle||!c.termMatches)return;var d=b.alias,e=d==null?"":this.resultStore._convertToAliasKey(d),f=[];c.termMatches.forEach(function(c){var d=b.term_to_subtitle[c];!a.is_alias_search&&c===e&&c!==a.potential_alias_term&&(d=null);d&&f.push(d)},this);b.category===void 0&&(b.category="");b.original_category!==void 0&&(b.category=b.original_category);if(!f||f.length===0)return;b.original_category===void 0&&(b.original_category=b.category);if(!b.original_category)return;d=b.original_category.length>0?b.original_category.split(" \xb7 "):[];d.unshift.apply(d,f);d=d.filter(function(a,b,c){return b==c.indexOf(a)});b.category=d.splice(0,2).join(" \xb7 ")};d.getRawStructure=function(a){typeof a==="string"&&(a=b("FacebarStructuredText").fromString(a));if(this.resultStore)return this.resultStore.transformStructured(a.toArray())};d.saveResult=function(a){this._initialQueryData=this.getUID(a.uid,a.fetchType)};d.isDefaultKeywordQuery=function(a){return a.type===b("FacebarJSConstants").keywordType&&b("FacebarResultStoreUtils").getTextFromResult(a).toLowerCase()===this.value.getHash().trim().toLowerCase()};d.buildUids=function(a){__p&&__p();var c=this;if(!a||!this.resultStore)return[];typeof a==="string"&&(a=b("FacebarStructuredText").fromString(a));var d=this.getRawStructure(a);a=this.resultStore.getResults(d,this.getMaxResults());var e=a.results;if(e===void 0)return[];a=a.null_state===!0;var f=0;e=e.filter(function(a,c){return!b("FacebarGlobalOptions").allowGrammar&&a.type=="grammar"?!1:a.semantic!="<blank>"&&(a.type!="unimplemented"||f++===0)},this);var g=[],h=[],i=[];e.forEach(function(a){a.forcedPosition>0?i.push(a):a.isSeeMore?g.push(a):h.push(a)});a?e=this.orderNullState(e,this.getMaxResults()):e=h;i.length>0&&(i.sort(function(a,b){return a.forcedPosition-b.forcedPosition}),i.forEach(function(a){e.splice(a.forcedPosition,0,a)}));g.length>0&&e.push.apply(e,g);return e.map(function(a){return c.toTypeaheadEntryUid(d,a)})};d.orderNullState=function(a,b){var c={top:[],bottom:[],middle:[]},d=function(a){a=a.null_state_position;return Object.prototype.hasOwnProperty.call(c,a)?a:"middle"},e=function(a,b){return a.original_cost-b.original_cost};a&&a.forEach(function(a){c[d(a)].push(a)},this);for(var f in c)c[f]=c[f].sort(e).slice(0,b),b-=c[f].length;return[].concat(c.top,c.middle,c.bottom)};d.isEntity=function(a){return!a?!1:/^\d+$/.test(a)};d.handleResponse=function(a,b){var c=this;a.payload.errors||(this.processEntries(a.payload.entities),a.payload.results.forEach(function(d){d.qid=a.queryId,d.parse||(d.parse={}),d.parse.entTokens=d.parse.entTokens||[],d.parse.remTokens=d.parse.remTokens||[],d.parse.suffix=d.parse.suffix||"",c.isEntity(d.semantic)&&(d=c._buildCommonEntityFields(d,b.tokens))}),this.saveResults(a,b))};d.saveResults=function(a,b){a.payload.prefetched&&this.processPrefetched(a.payload.prefetched),this.resultStore.saveResults(a.payload.results,b,a.payload.incomplete,{},[])};d.processPrefetched=function(a){var c=this,d=function(d){var e=b("FacebarStructuredText").fromString(d),f=c.getRawStructure(e);e=a[d];c.processEntries(e.entities);e.results.forEach(function(a){c.isEntity(a.semantic)&&(a=c._buildCommonEntityFields(a,f.tokens))});c.resultStore.saveResults(e.results,f,e.incomplete)};for(var e in a)d(e)};d.processEntries=function(a){__p&&__p();return a.map(function(a,b){__p&&__p();var c=a.uid+="";a.textToIndex=this.getTitleTerms(a);a.titleToIndex=this.getTitleTerms(a);c=this.getUID(c,a.fetchType);var d=this.getEntry(c);!d?(this.setEntry(c,{}),d=this.getEntry(c)):delete a.photo;Object.assign(d,a);d.tuid=c;d.index===void 0&&(d.index=b);return c},this)};d.getUID=function(a,b){a+="";if(b!==void 0){b=/([^:]+:)?([^:]+)(:.*)?/.exec(b)[2];return JSON.stringify([a,b])}return a};d.getEntry=function(b,c){b=""+b;c=c!=null?a.prototype.getEntry.call(this,this.getUID(b,c))||a.prototype.getEntry.call(this,b):a.prototype.getEntry.call(this,b);return c};d.getEntryForFragment=function(a){return this.getEntry(a.getUID(),a.getTypePart(2))};d.getMaxResults=function(){return j?k:this._numResults.max};d.query=function(a,c,d){this.executeQueryThrottled(a,this._initialQueryData,{keyPress:b("FacebarTimerUtils").getTimestamp()}),this._initialQueryData=null};d.setCustomQueryID=function(a){this._customQueryID=a};d.shouldFetchMore=function(a,c){__p&&__p();if(!a.is_empty&&!b("CurrentUser").isWorkUser()){var d=c.filter(function(a){return a.type===b("FacebarJSConstants").keywordType}).length;if(d<b("FacebarGlobalOptions").default_num_top_results_to_show)return!0}if(a.is_empty)return!1;if(this.resultStore.alreadyKnown(a.cache_id))return!1;if(a.raw_text&&this._isQueryTooShort(a.raw_text))return!1;if(j)return!0;return c.length<this.getMaxResults()||this._performShortQuery?!0:this.countValidResults(c)<this.getMaxResults()||this._performShortQuery};d.countValidResults=function(a){var b=0;a.forEach(function(a){a&&!a.isNullState&&!a.isSeeMore&&b++},this);return b};d.handleQueryResponse=function(a,c,d,e,f){__p&&__p();var g=this,h=a.payload;a.queryId=c;a.inputQuery=d.text_form;h.results!=null&&h.results.forEach(function(a){a.isSingleState=g._single_state});f!=null&&(f.endRemoteQuery=b("FacebarTimerUtils").getTimestamp());this.inform("response_received",a);this.handleResponse(a,d);c=[];h.abandon_cache&&(c=h.results.map(function(a){return g.toTypeaheadEntryUid(d,a)}));var i=h.num_topresults_to_show;(i==null||i<3)&&(i=3);this.respond(e,c,!0,h&&(!h.results||h.results.length===0),f,i);this.inform("backend_response",a)};d.activityStart=function(){this._waitingQueries||this.inform("activity",{activity:!0},"state"),this._waitingQueries++};d.activityEnd=function(){this._waitingQueries--,this._waitingQueries||this.inform("activity",{activity:!1},"state")};d._bucketizeResults=function(a,b,c){b=this._tagKeywordsSuggestions(b);return this._resultsBucketizer.bucketize(b,i,null,c)};d._tagKeywordsSuggestions=function(a){__p&&__p();if(!a||a.length===0)return a;var c=a[0];if(c.bootstrapped)return a;return c.type==="grammar"||c.cost<b("FacebarGlobalOptions").closeEntityThreshold&&c.type==="user"?a:a.map(function(a){if(a.type!==b("FacebarJSConstants").keywordType)return a;a=babelHelpers["extends"]({},a);a.tags.topBucket=!0;return a})};d._buildCommonEntityFields=function(a,c){if(a.queryTypeText)return a;a.parse.display=[{type:"ent:"+a.type,uid:a.semantic}];a.parse.fetchType&&(a.parse.display[0].fetchType=a.parse.fetchType);a.parse.entTokens=c;a.parse.pos=0;a.resultsSetType="{"+a.type+"}";a.queryTypeText=b("FacebarJSConstants").defaultQueryTypeText;return a};d.setBypassBucketizer=function(a){this._bypassBucketizer=a};d.respond=function(a,c,d,e,f,g){__p&&__p();d&&this.value&&(typeof this.value==="string"&&(this.value=b("FacebarStructuredText").fromString(this.value)),this.inform("remote_query_match",{isMatch:this.value.matches(a),queryId:f!=null?f.queryId:0}),a=this.value,(!c||c.length===0)&&(c=this.buildUids(a)));this.inform("reorderResults",c);this.inform("respondValidUids",c);c=c.map(this.getEntry,this);c.forEach(function(a,b){a.fromCache=!d,a.isSingleState=this._single_state},this);if(!d&&(a.getHash().length<512||a.getHash().startsWith("http://")||a.getHash().startsWith("https://"))){var h=this.getRawStructure(a);this.shouldFetchMore(h,c)&&(f!=null&&(f.dispatchRemoteQuery=b("FacebarTimerUtils").getTimestamp()),this.sendRemoteQueryThrottled(h,a,f))}(!d||f==null||f.queryId===this._maxRemoteQueryId)&&this.renderResultsThrottled(a,c,d,e,g);f!=null&&this.logLatencies(d,f)};d.injectExtraResults=function(a,c,d){b("FacebarInviteCoworkers").insertInto(a,c,!d,this._single_state),b("FacebarSearchAllMessages").insertInto(a,c,!d)};d.logLatencies=function(a,c){var d=b("FacebarTimerUtils").getTimestamp();a?this.inform("remote_query_latency",{queryId:c.queryId,latencies:{queryStart:Math.max(c.startRemoteQuery-c.dispatchRemoteQuery,0),queryEnd:Math.max(c.endRemoteQuery-c.startRemoteQuery,0),keyPressToQueryDispatch:Math.max(c.dispatchRemoteQuery-c.keyPress,0),keyPressToQueryStart:Math.max(c.startRemoteQuery-c.keyPress,0),keyPressToQueryEnd:Math.max(c.endRemoteQuery-c.keyPress,0),render:Math.max(d-c.endRemoteQuery,0),inflightRequests:c.inflightRequests,waitingQueries:c.waitingQueries,keyPressToRender:Math.max(d-c.keyPress,0)}}):this.inform("cache_query_latency",{queryId:c.queryId,latencies:{queryStart:Math.max(c.startCacheQuery-c.keyPress,0),queryEnd:Math.max(c.endCacheQuery-c.startCacheQuery,0),keyPressToQueryEnd:Math.max(c.endCacheQuery-c.keyPress,0),render:Math.max(d-c.endCacheQuery,0),keyPressToRender:Math.max(d-c.keyPress,0)}})};d._updateMaxResults=function(){var a=this;b("queryThenMutateDOM")(function(){var c=b("Vector").getViewportDimensions().y,d=b("ViewportBounds").getTop()||42,e=56,f=48;c=c-d-f-25;a._maxResults=Math.max(a._numResults.min,Math.min(a._numResults.max,Math.floor(c/e)-1));a.value&&a.query(a.value)})};d.setUseCustomQueryId=function(a){this._useCustomQueryId=a};d.setCurQueryId=function(a){this._curQueryId=a};d.getCurQueryId=function(){return this._curQueryId};d.setMinQueryLength=function(a){this._minQueryLength=a};d.setGrammarOption=function(a){b("FacebarGlobalOptions").allowGrammar=a};d.getBootstrapMatches=function(a,c){var d=this;c===void 0&&(c=[]);var e=this.getRawStructure(b("FacebarStructuredText").fromString(a));a=this.resultStore.getBootstrapMatches(e,c);return a.map(function(a){return d.getEntry(d.toTypeaheadEntryUid(e,a))})};return c}(b("SearchDataSource"));Object.assign(c.prototype,{events:["query","respond","bootstrapped","activity","ready"]});e.exports=c}),null);
__d("SimpleStructuredInput",["csx","ArbiterMixin","DataStore","DOM","Event","FacebarStructuredText","FlipDirection","Input","Parent","getActiveElement","mixin","requestAnimationFrame"],(function(a,b,c,d,e,f,g){__p&&__p();a=function(a){"use strict";__p&&__p();babelHelpers.inheritsLoose(c,a);function c(c){var d;d=a.call(this)||this;d.$SimpleStructuredInput1=c;d.$SimpleStructuredInput2=b("DOM").find(c,"._1frb");d.$SimpleStructuredInput3=b("DOM").find(c,"._5eay");b("DataStore").set(c,"SimpleStructuredInput",babelHelpers.assertThisInitialized(d));d.init();return d}var d=c.prototype;d.init=function(){var a=this,c=function(b){return a.inform(b.type)};b("Event").listen(this.$SimpleStructuredInput2,"blur",c);b("Event").listen(this.$SimpleStructuredInput2,"focus",c);b("Event").listen(this.$SimpleStructuredInput2,"input",function(){b("FlipDirection").setDirection(a.$SimpleStructuredInput2,1,!0),a.inform("change"),b("requestAnimationFrame")(function(){a.$SimpleStructuredInput2.scrollLeft>0&&a.clearHint()})});this.inform("init",null,"persistent")};d.clearHint=function(){b("Input").setValue(this.$SimpleStructuredInput3,"")};d.setHint=function(a){a=a.map(function(a){return a.text}).join("");var c=b("Input").getValue(this.$SimpleStructuredInput2);this.hasFocus()&&c.length>0&&a.toLowerCase().indexOf(c.toLowerCase())===0&&!this.hasTextOverflow()?b("Input").setValue(this.$SimpleStructuredInput3,c+a.slice(c.length)):this.clearHint()};d.focus=function(){this.$SimpleStructuredInput2.focus()};d.blur=function(){this.$SimpleStructuredInput2.blur(),this.setHint([])};d.hasTextOverflow=function(){return this.$SimpleStructuredInput2.offsetWidth!==this.$SimpleStructuredInput2.scrollWidth};d.hasFocus=function(){return b("DOM").contains(this.$SimpleStructuredInput1,b("getActiveElement")())};d.setStructure=function(a,c){c===void 0&&(c=!1);a=a.map(function(a){return a.text});b("Input").setValue(this.$SimpleStructuredInput2,a.join(""));c!==!0&&this.inform("change")};d.getStructure=function(){return b("FacebarStructuredText").fromString(b("Input").getValue(this.$SimpleStructuredInput2)).toStruct()};d.getSelection=function(){return{offset:this.$SimpleStructuredInput2.selectionStart,length:this.$SimpleStructuredInput2.selectionEnd-this.$SimpleStructuredInput2.selectionStart}};d.setSelection=function(a){this.hasFocus()&&(this.$SimpleStructuredInput2.setSelectionRange(a.offset,a.offset+a.length),this.inform("select"))};d.isSelectionAtEnd=function(){var a=this.getSelection().offset,c=b("Input").getValue(this.$SimpleStructuredInput2).length;return a>=c};d.selectAll=function(){this.setSelection({offset:0,length:b("Input").getValue(this.$SimpleStructuredInput2).length})};c.getInstance=function(a){a=b("Parent").bySelector(a,"._5eaz");if(!(a instanceof HTMLElement))throw new Error("No DOMElement structured input found using");return b("DataStore").get(a,"SimpleStructuredInput")||new c(a)};return c}(b("mixin")(b("ArbiterMixin")));e.exports=a}),null);
__d("SearchTypeaheadRecorder",["AsyncRequest","Banzai","BanzaiNectar","BanzaiScuba","CurrentUser","Event","FacebarGlobalOptions","Keys","TokenizeUtil","Vector","clickRefAction","ge","mapObject","throttle","whitelistObjectKeys"],(function(a,b,c,d,e,f){__p&&__p();var g,h={WAITING:"WAITING",SUCCESS:"SUCCESS",NO_RESULTS:"NO_RESULTS",ERROR:"ERROR"};a=function(){"use strict";__p&&__p();function a(a){this.init(a),this.initEvents(a)}var c=a.prototype;c.init=function(a){__p&&__p();this.core=a.getCore();this.data=a.getData();this.view=a.getView();this.element=this.core.getElement();this.initTime=Date.now();this._onloadTime=0;this._extraRecorder=[];this.performanceTimings={};this.allFromSingleState=!1;this.allFromNullState=!1;a=b("ge")("search_first_focus");this.initStartTime=a&&a.value;this.bootstrapStats={bootstrapped:0};this.type="legacy_search";this._reset()};c._reset=function(){__p&&__p();this.stats={};this.avgStats={};this.appendStats={};this._backspacing=!1;this.backendQueries=[];this.backendQueriesStatus={};this._topreplace=!1;this._inflightRequests={};var a=Math.random().toString();this.data.setQueryData({sid:a});this.view.setSid(a);this.recordStat("sid",a);this.recordStat("keypressed",0)};c.initEvents=function(){__p&&__p();var a=this;this.core.subscribe("focus",function(a){if(!this.stats.session_start_time){this.recordStat("session_start_time",Date.now());a=new Date();a=a.getTimezoneOffset();a=Date.now()-a*60*1e3;this.recordStat("session_start_time_user_timezone",a);this._lastRenderTime=0;this._firstKeypressTime=null}}.bind(this));this.core.subscribe("blur",function(a){a=Date.now();for(var b in this._inflightRequests){var c=this._inflightRequests[b];c=a-c;this.recordAvgStat("search_endpoint_ms_from_js",c)}this.recordStat("session_end_time",a);this.submit()}.bind(this));this.view.subscribe("select",function(a,b){this.recordStat("time_between_select_and_last_render",Date.now()-this._lastRenderTime),this._firstKeypressTime!=null&&this.recordStat("keypress_to_select_time",Date.now()-this._firstKeypressTime),this.recordSelectInfo(b)}.bind(this));this.view.subscribe("render",function(a,b){this._lastRenderTime=Date.now(),this.recordRender(b)}.bind(this));this.data.subscribe("logPerformanceTiming",function(b,c){a.performanceTimings[c.field]=c.value});this.data.subscribe("logProxygenForkPoolId",function(b,c){a.recordStat(c.field,c.value)});this.data.subscribe("activity",function(a,b){this.recordStat("pending_request",b.activity)}.bind(this));this.data.subscribe("respondValidUids",function(a,b){this.validUids=b.slice(0)}.bind(this));this.data.subscribe("beforeQuery",function(a,b){__p&&__p();if(!b.value){this.query="";this.results=[];this.data.lastNullOrSingleStateFetchStartTime=Date.now();return}this.stats.first_query_time||this.recordStat("first_query_time",Date.now());this.query=b.value;this.queryStartTime||(this.queryStartTime=[]);this.queryStartTime[this.query]=Date.now();this.recordCountStat("num_queries")}.bind(this));this.data.subscribe("queryEndpoint",function(a,b){this.recordCountStat("num_search_ajax_requests"),this.recordAvgStat("endpoint_query_length",b.value.length),this._inflightRequests[b.value]=Date.now()}.bind(this));this.data.subscribe("onload",function(a,b){this._onloadTime=b.time}.bind(this));this.data.subscribe("bootstrapped",function(a,b){this.bootstrapStats.endTime=b.time,this.bootstrapStats.bootstrapped=1}.bind(this));this.core.subscribe("recordFunction",function(a,b){this._extraRecorder.push(b)}.bind(this));this.data.subscribe("endpointStats",function(a,b){a=b.info;b=a.fetch_end-a.fetch_start;a.value?this.recordAvgStat("search_endpoint_ms_from_js",b):this.bootstrapStats[a.type]=b;a.coeff2_ts&&(this.bootstrapStats.coeff2_ts=a.coeff2_ts);typeof a.browserCacheHit!=="undefined"&&this.recordCountStat(a.browserCacheHit?"bootstrap_cachehits":"bootstrap_cachemisses");this._inflightRequests[a.value]&&delete this._inflightRequests[a.value]}.bind(this));this.data.subscribe("fetchComplete",function(b,c){b=c.entries;c=c.value;c&&a.backendQueriesStatus[c]&&(a._addDurationForBackendQuery(a.backendQueriesStatus[c]),a.backendQueriesStatus[c].status=b&&b.length>0?h.SUCCESS:h.NO_RESULTS)});this.data.subscribe("fetchError",function(b,c){b=c.fetch_context;c=b.value;if(b.bootstrap||!c)return;a.backendQueriesStatus[c]&&(a.backendQueriesStatus[c].status=h.ERROR,a._addDurationForBackendQuery(a.backendQueriesStatus[c]))});this.data.subscribe("query",function(a,b){this.recordAvgStat("num_results_from_cache",b.results.length)}.bind(this));this.data.subscribe("backend_topreplace",function(a,b){!1===this._topreplace&&(this.recordStat("backend_topreplace",1),this._topreplace=!0)}.bind(this));this.data.subscribe("completeFetch",function(a,b){if(this.core.scubaInfo){a=b.response;b={recv:b.stats.fetch_end-b.stats.fetch_start,render:Date.now()-b.stats.fetch_start,payload_size:JSON.stringify(a).length};a.payload.entities||(a.payload.entities=this.buildResults());this.logToScuba(a,b,this.core.scubaInfo,this.query,this.type)}}.bind(this));this.data.subscribe("completeCacheFetch",b("throttle")(function(b,c){a.core.scubaInfo&&a.logToScuba({},{},a.core.scubaInfo,a.query,a.type)},500));b("Event").listen(this.element,"keydown",function(a){this.recordStat("keypressed",1),this.recordCountStat("count_keys_pressed"),b("Event").getKeyCode(a)==b("Keys").BACKSPACE?!this._backspacing&&this.query&&(this._backspacing=!0,this.recordAppendStat("before_backspace_queries",this.query)):this._backspacing=!1,this._firstKeypressTime==null&&(this._firstKeypressTime=Date.now())}.bind(this));this.data.subscribe("beforeFetch",function(a,b){a=b.request.data?b.request.data.value:null;if(!a)return;this.backendQueries.push(a);this.backendQueriesStatus[a]={status:h.WAITING,start_time:Date.now()}}.bind(this))};c.recordStat=function(a,b){this.stats[a]=b};c.recordCountStat=function(a){var b=this.stats[a];this.stats[a]=b?b+1:1};c.recordAvgStat=function(a,b){this.avgStats[a]?(this.avgStats[a][0]+=b,++this.avgStats[a][1]):this.avgStats[a]=[b,1]};c.recordAppendStat=function(a,b){Object.prototype.hasOwnProperty.call(this.appendStats,a)||(this.appendStats[a]=[]),this.appendStats[a].push(b)};c.recordRender=function(a){__p&&__p();this.results=a.filter(function(a){return a.uid!="search"&&a.type!="disabled_result"&&a.type!="header"}).map(function(a){return babelHelpers["extends"]({},a)});a=null;this.queryStartTime&&(a=this.queryStartTime[this.query]);var c=this.results.every(function(a){return a.fromCache||a.isSeeMore}),d=this.results.every(function(a){return a.isFromGSEF||a.fromCache||a.isSeeMore||a.isJSBootstrapMatch})&&this.results.some(function(a){return a.isFromGSEF}),e=this.results.every(function(a){return a.isGloballyCachedKeyword||a.fromCache||a.isSeeMore||a.isJSBootstrapMatch})&&this.results.some(function(a){return a.isGloballyCachedKeyword}),f=this.results.every(function(a){return a.isNullState}),g=this.results.every(function(a){return a.isSingleState}),h=this.results.every(function(a){return a.exactMatchKeyword||a.isSeeMore});this.allFromSingleState=g;this.allFromNullState=f;if(this.results.length&&this.data.lastNullOrSingleStateFetchStartTime&&f)this.recordStat("time_render_null_state",Date.now()-this.data.lastNullOrSingleStateFetchStartTime),this.data.lastNullOrSingleStateFetchStartTime=null;else if(this.data.lastNullOrSingleStateFetchStartTime&&this.results.length&&g)this.recordStat("time_render_single_state",Date.now()-this.data.lastNullOrSingleStateFetchStartTime);else if(a){f=Date.now()-a;h?this.recordAppendStat("times_render_gs_echo",f):this.recordAppendStat(c?"times_render_local":"times_render_remote",f);!c&&d&&this.recordAppendStat("time_render_gs_early_fetch",f);!c&&e&&this.recordAppendStat("time_render_globally_cached_keywords",f);!c&&!d&&!e&&this.recordAppendStat("time_render_remote_main_call",f)}this.data.lastNullOrSingleStateFetchStartTime=null;g=b("Vector").getViewportDimensions();this.recordStat("window_size_width",g.x);this.recordStat("window_size_height",g.y);this.results.length>0&&!this.stats.first_result_time&&this.recordStat("first_result_time",Date.now());a="typed";this.allFromNullState?a="nullstate":this.allFromSingleState&&(a="singlestate");this.recordStat("last_state",a)};c.recordSelectInfo=function(a){__p&&__p();var c=a.selected,d=a.index;c.groupIndex!==void 0&&(d=a.index-c.groupIndex-1);var e={href:c.path},f=c.dataGT?{gt:JSON.parse(c.dataGT)}:{};b("clickRefAction")("click",e,null,null,f);if(c.uid=="search"||c.uid=="people_search")this.recordStat("selected_position",this.results!=null?this.results.length:0),this.recordStat("selected_search",1);else if(c.uid=="invite")this.recordStat("selected_invite",1);else{e=c.log_type||c.rankType||c.render_type||c.type;f=e=="friend"?"user":e;this.recordStat("selected_"+f,1);this.recordStat("selected_position",d);this.recordStat("selected_type",e);this.recordStat("selected_name_length",c.text.length);this.recordStat("selected_id",c.uid);this.recordStat("selected_degree",c.bootstrapped?1:2);this.recordStat("selected_recent_search",c.recent_search);f=b("TokenizeUtil").parse(this.data.getTextToIndex(c)).tokens;d=i(f,this.query);d&&this.recordStat("matched_terms",d);this.recordStat("selected_text",c.text)}var g={};this._extraRecorder.forEach(function(b){b(a,this.results,g)}.bind(this));this.recordStat("extra_select_info",JSON.stringify(g));this.recordStat("selected_with_mouse",a.clicked?1:0)};c._addDurationForBackendQuery=function(a){a.start_time&&(a.duration=Date.now()-a.start_time,delete a.start_time)};c._dataToSubmit=function(){__p&&__p();this.recordStat("candidate_results",this.buildResults());this.recordStat("query",this.query);this.recordStat("init_time",this.initTime);this.initStartTime&&(this.recordStat("init_start_time",this.initStartTime),this.recordStat("onload_time",this._onloadTime),this.initStartTime=0);this.recordStat("bootstrapped",this.bootstrapStats.bootstrapped);this.bootstrapStats.endTime&&(this.recordStat("bootstrapped_time",this.bootstrapStats.endTime),this.recordStat("user_bootstrap_ms",this.bootstrapStats.user),this.recordStat("other_bootstrap_ms",this.bootstrapStats.other),this.bootstrapStats.endTime=0);var a=this.data.getBootstrapError();a&&this.recordStat("bootstrap_error",1);this.recordStat("coeff2_ts",this.bootstrapStats.coeff2_ts);this.recordStat("max_results",this.data._maxResults);if(this.backendQueries.length>0){this.backendQueries.length>this.data.logBackendQueriesWindow&&(this.backendQueries=this.backendQueries.slice(this.backendQueries.length-this.data.logBackendQueriesWindow));this.recordStat("backend_queries",this.backendQueries);a=b("whitelistObjectKeys")(this.backendQueriesStatus,this.backendQueries);(g||(g=b("mapObject")))(a,this._addDurationForBackendQuery,this);this.recordStat("backend_queries_status",a)}if(b("FacebarGlobalOptions").taSessionLoggingSample){var c=[];this.results.forEach(function(a){c.push([a.text||"",a.category||"",a.subtext||""])});this.recordStat("raw_suggestions_text",c)}a=this.stats;for(var d in this.avgStats){var e=this.avgStats[d];a[d]=e[0]/e[1]}for(var f in this.appendStats)a[f]=JSON.stringify(this.appendStats[f]);return a};c.buildResults=function(){var a=(this.results||[]).map(function(a,c){var d=b("TokenizeUtil").parse(this.data.getTextToIndex(a)).tokens,e=a.rankType||a.render_type||a.type,f=a.log_type,g=a.bootstrapped?1:0,h=a.s_token||"",j=typeof a.index==="undefined"?100:a.index;d=i(d,this.query)||this.query;var k=a.index_rank,l=a.match_type,m=a.l_type,n=a.vertical_type,o=a.prefix_match,p=a.prefix_length,q=a.text,r=a.category,s=a.subtext,t=a.fromCache,u=a.isNullState,v=a.isSingleState,w=a.logInfo;return typeof a.groupIndex==="number"?[a.groupIndex,a.indexInGroup,a.uid,e,g,h,d,k,l,o,p,a.origIndex,m,n,q,r,s,j,t,u,v,w,f]:[0,c,a.uid,e,g,h,d,k,l,o,p,a.origIndex,m,n,q,r,s,j,t,u,v,w,f]}.bind(this));return JSON.stringify(a)};c.submit=function(){var a=this._dataToSubmit();switch(this.data.recordingRoute){case"banzai_vital":b("Banzai").post(this._banzaiRoute,a,{delay:0,retry:!0});break;default:this.submitThroughAsyncRequest(a)}this._reset()};c.addLatencyToSample=function(a,b,c,d){a.addInteger(d+"query_start",c.queryStart),a.addInteger(d+"query_end",c.queryEnd),a.addInteger(d+"keypress_query_end",c.keyPressToQueryEnd),a.addInteger(d+"render",c.render),a.addInteger(d+"keypress_render",c.keyPressToRender),b[d+"query_start"]=c.queryStart,b[d+"query_end"]=c.queryEnd,b[d+"keypress_query_end"]=c.keyPressToQueryEnd,b[d+"render"]=c.render,b[d+"keypress_render"]=c.keyPressToRender};c.logToScuba=function(a,c,d,e,f){__p&&__p();var g=this,h={},i=new(b("BanzaiScuba"))("search_facebar_js",null,{addBrowserFields:!0,addPredictedGeographyFields:!0,addUser:!0,addSearchVersion:!0,addGatekeepers:{facebarGKs:!0}});i.addInteger("sample_rate",d.sample_rate);h.sample_rate=d.sample_rate;i.addNormal("site",d.site);h.site=d.site;i.addDenorm("query",e);h.query=e;d=a.payload||{};d.entities&&(i.addInteger("num_entities",d.entities.length),h.num_entities=d.entities.length);Object.keys(this.performanceTimings).forEach(function(a){i.addInteger(a,g.performanceTimings[a]),h[a]=g.performanceTimings[a]},this);if(d.results||d.entries){var j=(d.results||d.entries).length;i.addInteger("num_results",j);h.num_results=j}d.gzipped_payload_size!==void 0&&(i.addInteger("gzipped_payload_size",d.gzipped_payload_size),h.gzipped_payload_size=d.gzipped_payload_size);c.recv&&c.render>c.recv&&(i.addInteger("time_render",c.render-c.recv),h.time_render=c.render-c.recv,i.addInteger("time_js_async",c.recv),h.time_js_async=c.recv);c.payload_size&&(i.addInteger("payload_size",c.payload_size),h.payload_size=c.payload_size);this.stats.time_render_null_state&&(!e||e.length===0)&&(i.addInteger("time_render_null_state",this.stats.time_render_null_state),h.time_render_null_state=this.stats.time_render_null_state);i.addInteger("query_id",a.queryId);h.query_id=a.queryId;i.addDenorm("user_id",b("CurrentUser").getID());h.user_id=b("CurrentUser").getID();i.addDenorm("session_id",this.stats.sid);h.session_id=this.stats.sid;i.addNormal("typeahead_type",f);h.typeahead_type=f;c.remoteQueryLatencies&&(this.addLatencyToSample(i,h,c.remoteQueryLatencies,"remote_"),i.addInteger("remote_keypress_query_dispatch",c.remoteQueryLatencies.keyPressToQueryDispatch),h.remote_keypress_query_dispatch=c.remoteQueryLatencies.keyPressToQueryDispatch,i.addInteger("remote_keypress_query_start",c.remoteQueryLatencies.keyPressToQueryStart),h.remote_keypress_query_start=c.remoteQueryLatencies.keyPressToQueryStart,i.addNormal("inflight_requests",c.remoteQueryLatencies.inflightRequests),i.addInteger("inflight_requests",c.remoteQueryLatencies.inflightRequests),h.inflight_requests=c.remoteQueryLatencies.inflightRequests,i.addNormal("waiting_queries",c.remoteQueryLatencies.waitingQueries),i.addInteger("waiting_queries",c.remoteQueryLatencies.waitingQueries),h.waiting_queries=c.remoteQueryLatencies.waitingQueries);c.cacheQueryLatencies&&this.addLatencyToSample(i,h,c.cacheQueryLatencies,"cache_");i.post();b("BanzaiNectar").log("search_facebar_js","typeahead",h)};c.submitThroughAsyncRequest=function(a){Object.keys(a).length>0&&new(b("AsyncRequest"))().setURI(this._endPoint).setMethod("POST").setData({stats:a}).setOption("handleErrorAfterUnload",!0).setErrorHandler(function(c){a.retry=!0,new(b("AsyncRequest"))().setURI(this._endPoint).setMethod("POST").setData({stats:a}).setOption("asynchronous_DEPRECATED",!1).send()}.bind(this)).send()};return a}();var i=function(a,c){__p&&__p();if(!a||!c)return;c=b("TokenizeUtil").parse(c);if(c.flatValue[c.flatValue.length-1]===" ")return c.flatValue;var d=c.tokens[c.tokens.length-1],e={};a.forEach(function(a){e[a]=(e[a]||0)+1});var f={};c=c.tokens.slice(0,c.tokens.length-1);c.forEach(function(a){f[a]=(f[a]||0)+1});for(var g=0;g<a.length;++g){var h=a[g];if(h.indexOf(d)===0&&e[h]-(f[h]||0)>0){c.push(h);return c.join(" ")}}return void 0};Object.assign(a.prototype,{_endPoint:"/ajax/typeahead/record_metrics.php",_banzaiRoute:"search"});e.exports=a}),null);
__d("XSearchFacebarSurveyController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/search/facebar_survey/",{id:{type:"String",required:!0},query:{type:"String"},session_id:{type:"String",required:!0},on_session_start:{type:"Exists",defaultValue:!1},result_selected:{type:"Exists",defaultValue:!1}})}),null);
__d("AbandonedSessionSurvey",["AsyncRequest","SubscriptionsHandler","XSearchFacebarSurveyController","getOrCreateDOMID"],(function(a,b,c,d,e,f){__p&&__p();a=function(){"use strict";__p&&__p();function a(a){var c=this;this.tryToSubmitSurvey=function(){c.searchBoxFocused&&(c.openSurvey(),c.resultSelected=!1,c.searchBoxFocused=!1)};this.core=a.getCore();this.data=a.getData();this.view=a.getView();this.subscriptionsHandler=new(b("SubscriptionsHandler"))()}var c=a.prototype;c.enable=function(){var a=this;this.subscriptionsHandler.addSubscriptions(this.core.subscribe("focus",function(){a.searchBoxFocused=!0,a.resultSelected=!1}),this.data.subscribe("beforeQuery",function(b,c){a.query=c.value||""}),this.view.subscribe("select",function(){a.resultSelected=!0,a.tryToSubmitSurvey()}),this.core.subscribe("blur",this.tryToSubmitSurvey))};c.disable=function(){this.subscriptionsHandler.release(),this.request&&this.request.abort()};c.openSurvey=function(){if(this.openedSurvey)return;this.openedSurvey=!0;var a=this.core.element;a==null&&(a=this.core.getElement());var c=this.normalizeValue(this.query);a=b("XSearchFacebarSurveyController").getURIBuilder().setString("id",b("getOrCreateDOMID")(a)).setString("query",c!=null?c:"").setString("session_id",this.data.queryData.sid).setExists("result_selected",this.resultSelected);this.request=new(b("AsyncRequest"))().setMethod("POST").setAllowCrossPageTransition(!0).setURI(a.getURI());this.request.send()};c.normalizeValue=function(a){return String(a).trim().replace(/\s+/g," ").replace(/[\u200E|\u200F|\u202a|\u202b|\u202c]/g,"").toLowerCase()};return a}();e.exports=a}),null);
__d("FluxHooks",["React","shallowEqual","useSubscriptionValue"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("React").useCallback;function a(a,c){var d=g(function(d){var e=c(a);return d!=null&&b("shallowEqual")(d,e)?d:e},[a,c]),e=g(function(b){var c=a.addListener(b);return function(){return c.remove()}},[a]);return b("useSubscriptionValue")({getCurrentValue:d,subscribe:e})}e.exports={useFluxStore:a}}),null);
__d("SearchSuggestionsHighlighter",["React","escapeRegex"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function g(a,c,d,e){__p&&__p();a=b("escapeRegex")(a);e=e?"gi":"g";a=new RegExp("( "+a.split(/\s+/).join("| ")+")",e);e=" "+c;var f=[],g=0,h=null;while(!0){h=a.exec(e);if(h==null)break;var i=e.substring(g,h.index);g===0&&(i=i.trimLeft());d?f.push(i):f.push(b("React").jsx("strong",{children:i},c+"-"+h.index));i=h[0];h.index===0&&(i=i.trimLeft());g=h.index+h[0].length;d?f.push(b("React").jsx("strong",{children:i},c+"-"+g)):f.push(i)}d?f.push(e.substring(g,e.length)):f.push(b("React").jsx("strong",{children:e.substring(g,e.length)},c+"-"+e.length));return f}function a(a,b){return g(a,b,!0,!1)}function c(a,b){return g(a,b,!1,!1)}function d(a,b){return g(a,b,!1,!0)}e.exports={highlightMatch:a,highlightNonMatch:c,highlightNonMatchCaseInsensitive:d}}),null);