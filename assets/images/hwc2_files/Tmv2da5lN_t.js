if (self.CavalryLogger) { CavalryLogger.start_js(["rn51s"]); }

__d("RichTextEditorLink.react",["cx","Link.react","React","Tooltip"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();a=function(a){__p&&__p();babelHelpers.inheritsLoose(c,a);function c(){return a.apply(this,arguments)||this}var d=c.prototype;d.render=function(){var a=this.props,c=a.children,d=a.contentState,e=a.entityKey;a=a.offsetKey;var f="#";e!=null&&(f=d.getEntity(e).getData().url);d=f==="#"?{}:b("Tooltip").propsFor(f);return b("React").jsx(b("Link.react"),babelHelpers["extends"]({},d,{"data-offset-key":a,"data-tooltip-alignh":"center","data-tooltip-content":f,href:f,target:"_blank",className:"_42a-",children:c}))};return c}(b("React").Component);e.exports=a}),null);
__d("fileSliceName",["UserAgent_DEPRECATED"],(function(a,b,c,d,e,f){a="slice";(c=b("UserAgent_DEPRECATED").chrome())?c<21&&(a="webkitSlice"):(c=b("UserAgent_DEPRECATED").firefox())?c<13&&(a="mozSlice"):b("UserAgent_DEPRECATED").safari()||b("UserAgent_DEPRECATED").webkit()&&(a="webkitSlice");e.exports=a}),null);
__d("FileHasher",["WebWorker","emptyFunction","fileSliceName","FileHashWorkerResource"],(function(a,b,c,d,e,f){__p&&__p();a=function(){"use strict";__p&&__p();a.isSupported=function(){return b("WebWorker").isSupported()};function a(){var a=this,c=b("FileHashWorkerResource");b("WebWorker").prepareResource(c);this.$1=new(b("WebWorker"))(c).setMessageHandler(function(b){a.$2(b)}).execute()}var c=a.prototype;c.hash=function(a,c){this.$2=c;this.$1.postMessage({file:a,fileSliceName:b("fileSliceName")});return this};c.destroy=function(){this.$2=b("emptyFunction"),this.$1.terminate()};return a}();e.exports=a}),null);
__d("fileSlice",["fileSliceName"],(function(a,b,c,d,e,f){c=a.File&&a.File.prototype[b("fileSliceName")];c||(c=a.Blob&&a.Blob.prototype[b("fileSliceName")]);e.exports=c}),null);
__d("XSlideshowShakrOAuthController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/slideshow/shakr/",{})}),null);
__d("XSlideshowShakrPollController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/slideshow/shakr/show/",{})}),null);
__d("XSlideshowStorylineMoodAsyncController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/slideshow/storyline_mood/",{target_id:{type:"FBID"}})}),null);
__d("XSlideshowStorylineMoodDeleteController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/slideshow/storyline_mood/delete/",{})}),null);
__d("XSlideshowStorylineMoodUploadController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/slideshow/storyline_mood/upload/",{})}),null);
__d("XSlideshowVideoFrameImagesAsyncController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/slideshow/frame_images/",{request_type:{type:"Enum",enumType:0},video_id:{type:"FBID"}})}),null);
__d("SlideshowDataManager",["AsyncRequest","XSlideshowShakrOAuthController","XSlideshowShakrPollController","XSlideshowStorylineMoodAsyncController","XSlideshowStorylineMoodDeleteController","XSlideshowStorylineMoodUploadController","XSlideshowVideoFrameImagesAsyncController","immutable"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a=function(){__p&&__p();function a(){}var c=a.prototype;c.fetchStorylineMoodSource=function(a,c,d){var e=b("XSlideshowStorylineMoodAsyncController").getURIBuilder().getURI();new(b("AsyncRequest"))().setURI(e).setData({storyline_mood_id:a,total_length:c}).setMethod("POST").setHandler(function(a){return d(a.payload)}).send()};c.fetchStorylineMoodFiles=function(a,c){var d=this,e=b("XSlideshowStorylineMoodAsyncController").getURIBuilder().getURI();new(b("AsyncRequest"))().setURI(e).setMethod("GET").setData({target_id:c}).setReadOnly(!0).setHandler(function(b){return a(d.getStorylineMoodFiles(b.payload))}).send()};c.getStorylineMoodFiles=function(a){var c=[];Object.keys(a).forEach(function(b){c.push({moodID:b,fileName:a[b].fileName,categories:a[b].categories,source:null})});return b("immutable").List(c)};c.scheduleFrameImagesAsyncJob=function(a){var c=b("XSlideshowVideoFrameImagesAsyncController").getURIBuilder().getURI();new(b("AsyncRequest"))().setURI(c).setData({request_type:0,video_id:a}).setMethod("POST").send()};c.fetchVideoFrameImages=function(a,c){var d=b("XSlideshowVideoFrameImagesAsyncController").getURIBuilder().getURI();new(b("AsyncRequest"))().setURI(d).setData({request_type:1,video_id:c}).setMethod("POST").setHandler(function(b){return a(b.payload)}).send()};c.uploadAudioFile=function(a,c,d,e){__p&&__p();var f=this;if(!a||!a.input||!a.input.files.length)return;var g=b("XSlideshowStorylineMoodUploadController").getURIBuilder().getURI(),h=new FormData();h.append("audio_file",a.input.files[0]);h.append("target_id",c);new(b("AsyncRequest"))().setURI(g).setRawData(h).setMethod("POST").setErrorHandler(function(a){return e()}).setHandler(function(a){return f.$1(a.payload,d,e)}).send();a.clear()};c.$1=function(a,b,c){a.success?b({moodID:a.moodID,fileName:a.fileName,categories:a.categories,source:null}):c()};c.deleteAudioFile=function(a){var c=b("XSlideshowStorylineMoodDeleteController").getURIBuilder().getURI();new(b("AsyncRequest"))().setURI(c).setData({mood_id:a}).setMethod("POST").send()};c.getShakrScopeToken=function(a){var c=b("XSlideshowShakrOAuthController").getURIBuilder();new(b("AsyncRequest"))().setURI(c.getURI()).setHandler(function(b){return a(b.payload)}).send()};c.pollShakrForVideoURL=function(a,c){var d=b("XSlideshowShakrPollController").getURIBuilder();new(b("AsyncRequest"))().setURI(d.getURI()).setData({show_id:a}).setHandler(function(a){return c(a.payload)}).send()};return a}();e.exports=new a()}),null);
__d("SphericalPhotoUploadHelper",[],(function(a,b,c,d,e,f){"use strict";e.exports={shouldResize360:function(a,b,c){return b&&Math.max(b.x,b.y)<=c||a==="cubestrip"?!1:!0},shouldRecompress360:function(a,b,c){return b==null||b<=c||a==="cubestrip"?!1:!0}}}),null);
__d("ResumableUploadServiceState.enum",[],(function(a,b,c,d,e,f){"use strict";a=Object.freeze({CANCEL:"upload-cancel",FAIL:"upload-fail",FILE_TOO_LARGE:"upload-too-large",NOT_STARTED:"upload-not-started",PROGRESS:"upload-progress",START:"upload-start",SUCCESS:"upload-success",TRANSPORT_FAILURE:"upload-transport-fail"});e.exports=a}),null);
__d("ResumableUploadAsyncService",["regeneratorRuntime","Promise","AsyncRequest","EventEmitter","ResumableUploadServiceState.enum","URI","uuid"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g,h="rupload",i="facebook.com";a=function(a){__p&&__p();babelHelpers.inheritsLoose(c,a);function c(c,d,e,f,g,j,k,l,m){__p&&__p();var n;n=a.call(this)||this;n.consumer=c;n.accessToken=d;n.sessionKey=e||b("uuid")();n.contentKey=f||"";n.contentValue=g||"";n.serviceName=j&&j!=""?j:h;n.serviceDomain=k&&k!=""?k:i;n.receiveParameters=l;n.flowCaptureHeaderValue=m;return n}var d=c.prototype;d.resume=function(a){__p&&__p();var c,d;return b("regeneratorRuntime").async(function(e){__p&&__p();while(1)switch(e.prev=e.next){case 0:e.prev=0;e.next=3;return b("regeneratorRuntime").awrap(this.sendOffsetRequest(a));case 3:c=e.sent;this.emit(b("ResumableUploadServiceState.enum").START,{offset:c.offset});e.next=7;return b("regeneratorRuntime").awrap(this.sendUploadRequest(a,c));case 7:d=e.sent;this.emit(b("ResumableUploadServiceState.enum").SUCCESS,d.h);e.next=14;break;case 11:e.prev=11,e.t0=e["catch"](0),this.emit(b("ResumableUploadServiceState.enum").FAIL,e.t0);case 14:this.abortUpload=void 0;case 15:case"end":return e.stop()}},null,this,[[0,11]])};d.cancel=function(){this.abortUpload&&this.abortUpload(),this.emit(b("ResumableUploadServiceState.enum").CANCEL)};d.decorateRequestFlowCaptureHeader=function(a){this.flowCaptureHeaderValue&&a.setRequestHeader("X-Fb-Flow-Capture",String(this.flowCaptureHeaderValue))};d.sendOffsetRequest=function(a){var c=this;return new(b("Promise"))(function(a,d){var e=new(b("AsyncRequest"))().disableInteractionServerTracing().setAllowCrossOrigin(!0).setAllowCredentials(!0).setMethod("GET").setURI(c.getUploadUri()).setReadOnly(!0).setRequestHeader("Authorization","OAuth "+c.accessToken).setHandler(function(b){return a(JSON.parse(b.payload.response))}).setErrorHandler(d).setOption("suppressEvaluation",!0).setTransportErrorHandler(function(a){c.emit(b("ResumableUploadServiceState.enum").TRANSPORT_FAILURE,a)});c.decorateRequestFlowCaptureHeader(e);c.abortUpload=function(){return e.abort()};e.send()})};d.sendUploadRequest=function(a,c){__p&&__p();var d=this;c=c||{};var e=c.offset;c=c.duplicate;var f=c?"":a.slice(e);return new(b("Promise"))(function(c,g){__p&&__p();var h=new(b("AsyncRequest"))().disableInteractionServerTracing().setAllowCrossOrigin(!0).setAllowCredentials(!0).setURI(d.getUploadUri()).setRawData(f).setHandler(function(a){return c(JSON.parse(a.payload.response))}).setErrorHandler(g).setRequestHeader("Authorization","OAuth "+d.accessToken).setRequestHeader("X-Entity-Name",encodeURIComponent(a.name)).setRequestHeader("X-Entity-Type",a.type).setRequestHeader("X-Entity-Length",String(a.size)).setRequestHeader("Offset",String(e)).setOption("suppressEvaluation",!0).setUploadProgressHandler(function(c){c=new ProgressEvent("upload-service",{total:a.size,loaded:c.loaded+Number(e)});d.emit(b("ResumableUploadServiceState.enum").PROGRESS,c)}).setTransportErrorHandler(function(a){d.emit(b("ResumableUploadServiceState.enum").TRANSPORT_FAILURE,a)});d.decorateRequestFlowCaptureHeader(h);d.abortUpload=function(){return h.abort()};g=d.receiveParameters;g&&(h.setRequestHeader("start_offset",String(g.start_offset)).setRequestHeader("end_offset",String(g.end_offset)).setRequestHeader("composer_session_id",String(g.composer_session_id)).setRequestHeader("id",String(g.upload_session_id)),g.fb_region&&h.setRequestHeader("X-FB-Region",String(g.fb_region)));h.send()})};d.getUploadUri=function(){var a=this.getServiceName();a=new(g||(g=b("URI")))("https://"+a+"/"+this.consumer+"/"+this.sessionKey);this.contentKey&&this.contentValue&&(a=a.addQueryData(this.contentKey,this.contentValue));return a};d.getServiceName=function(){return this.serviceName+"."+this.serviceDomain};return c}(b("EventEmitter"));e.exports=a}),null);
__d("ResumableUploadService",["Promise","AsyncRequest","EventEmitter","ResumableUploadServiceState.enum","URI","uuid"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g,h="rupload",i="facebook.com";a=function(a){__p&&__p();babelHelpers.inheritsLoose(c,a);function c(c,d,e,f,g,j,k,l,m,n){__p&&__p();var o;o=a.call(this)||this;o.consumer=c;o.accessToken=d;o.sessionKey=e||b("uuid")();o.contentKey=f||"";o.contentValue=g||"";o.serviceName=j&&j!=""?j:h;o.serviceDomain=k&&k!=""?k:i;o.receiveParameters=l;o.flowCaptureHeaderValue=m;o.skipOffsetFetching=n;return o}var d=c.prototype;d.resume=function(a){__p&&__p();var c=this,d=this.getServiceName(),e=new(g||(g=b("URI")))("https://"+d+"/"+this.consumer+"/"+this.sessionKey);this.contentKey&&this.contentValue&&(e=e.addQueryData(this.contentKey,this.contentValue));d=function(){return new(b("Promise"))(function(a,d){a=new(b("AsyncRequest"))().disableInteractionServerTracing().setAllowCrossOrigin(!0).setAllowCredentials(!0).setMethod("GET").setURI(e).setReadOnly(!0).setHandler(a).setErrorHandler(d).setOption("suppressEvaluation",!0).setTransportErrorHandler(function(a){c.emit(b("ResumableUploadServiceState.enum").TRANSPORT_FAILURE,a)});c.decorateRequestFlowCaptureHeader(a);a.send()})};var f=function(d){__p&&__p();return new(b("Promise"))(function(f,g){__p&&__p();var h=0;if(d!==void 0){var i=JSON.parse(d.payload.response);h=i.offset}c.emit(b("ResumableUploadServiceState.enum").START,{offset:h});c.uploadAsyncRequest=new(b("AsyncRequest"))().disableInteractionServerTracing().setAllowCrossOrigin(!0).setAllowCredentials(!0).setURI(e).setRawData(a.slice(h)).setHandler(f).setErrorHandler(g).setRequestHeader("X-Entity-Name",encodeURIComponent(a.name)).setRequestHeader("X-Entity-Type",a.type).setRequestHeader("X-Entity-Length",String(a.size)).setRequestHeader("Offset",String(h)).setOption("suppressEvaluation",!0).setUploadProgressHandler(function(d){d=new ProgressEvent("upload-service",{total:a.size,loaded:d.loaded+Number(h)});c.emit(b("ResumableUploadServiceState.enum").PROGRESS,d)}).setTransportErrorHandler(function(a){c.emit(b("ResumableUploadServiceState.enum").TRANSPORT_FAILURE,a)});c.decorateRequestFlowCaptureHeader(c.uploadAsyncRequest);if(c.receiveParameters){i=c.receiveParameters;c.uploadAsyncRequest.setRequestHeader("start_offset",String(i.start_offset));c.uploadAsyncRequest.setRequestHeader("end_offset",String(i.end_offset));c.uploadAsyncRequest.setRequestHeader("composer_session_id",String(i.composer_session_id));c.uploadAsyncRequest.setRequestHeader("id",String(i.upload_session_id));c.uploadAsyncRequest.setRequestHeader("product_media_id",String(i.product_media_id));i.fb_region&&c.uploadAsyncRequest.setRequestHeader("X-FB-Region",String(i.fb_region))}c.uploadAsyncRequest.send()})},h=function(a){if(a!=null){a=JSON.parse(a.payload.response);c.emit(b("ResumableUploadServiceState.enum").SUCCESS,a.h)}else c.emit(b("ResumableUploadServiceState.enum").FAIL,"uploading failed")},i=function(a){return c.emit(b("ResumableUploadServiceState.enum").FAIL,a)};d=this.skipOffsetFetching?b("Promise").resolve():d();return d.then(f,i).then(h,i)};d.getServiceName=function(){return this.serviceName+"."+this.serviceDomain};d.cancel=function(){this.uploadAsyncRequest&&this.uploadAsyncRequest.abort(),this.emit(b("ResumableUploadServiceState.enum").CANCEL)};d.decorateRequestFlowCaptureHeader=function(a){this.flowCaptureHeaderValue&&a.setRequestHeader("X-Fb-Flow-Capture",String(this.flowCaptureHeaderValue))};return c}(b("EventEmitter"));e.exports=a}),null);
__d("VideoUploadLogger",["Banzai"],(function(a,b,c,d,e,f){__p&&__p();function g(a){this._source=a.source,this._composerDialogVersion=a.composer_dialog_version,this._waterfallID=a.waterfall_id,this._adAccountID=a.ad_account_id,this._targetID=a.target_id,this._delay=a.delay,this._times=[],this._isChunkedUpload=a.is_chunked_upload,this._actorID=a.actor_id,this._composerEntryPointRef=a.composer_entry_point_ref,this._isRemoteUpload=a.is_remote_upload,this._containerType=a.container_type,this._hasFileBeenReplaced=a.has_file_been_replaced}a={BANZAI_GK:"videos",BANZAI_ROUTE:"video_waterfall",SOURCE_SIMPLE:"simple",SOURCE_COMPOSER:"composer",EVENT_STARTED_GENERATE_THUMBNAILS:"upload.client.started_generate_thumbnails",EVENT_FINISHED_GENERATE_THUMBNAILS:"upload.client.finished_generate_thumbnails",EVENT_SELECTED_CUSTOM_THUMBNAIL:"upload.client.selected_custom_thumbnail",EVENT_VIDEO_DIMENSIONS_UNREADABLE:"upload.client.video_dimensions_unreadable",EVENT_REPLACE_VIDEO:"upload.client.replace_video",EVENT_STARTED_FLOW:"upload.client.started_flow",EVENT_FINISHED_FLOW:"upload.client.finished_flow",EVENT_FAILED_FLOW:"upload.client.failed_flow",EVENT_CANCELED_FLOW:"upload.client.canceled_flow",EVENT_RESIGNED_FLOW:"upload.client.resigned_flow",EVENT_REQUESTED_UPLOADING:"upload.client.requested_uploading",EVENT_INVALIDATED_UPLOADING:"upload.client.invalidated_uploading",EVENT_STARTED_UPLOADING:"upload.client.started_uploading",EVENT_PROGRESS_UPLOADING_START_REQUEST:"upload.client.progress_uploading_start_request",EVENT_FINISHED_UPLOADING:"upload.client.finished_uploading",EVENT_CANCELED_UPLOADING:"upload.client.canceled_uploading",EVENT_ABANDONED_UPLOADING:"upload.client.abandoned_uploading",EVENT_FAILED_UPLOADING:"upload.client.failed_uploading",EVENT_STARTED_SENDING_BYTES:"upload.client.started_sending_bytes",EVENT_FINISHED_SENDING_BYTES:"upload.client.finished_sending_bytes",EVENT_CANCELED_SENDING_BYTES:"upload.client.canceled_sending_bytes",EVENT_FAILED_SENDING_BYTES:"upload.client.failed_sending_bytes",EVENT_STARTED_START_REQUEST:"upload.client.started_sending_start_request",EVENT_FINISHED_START_REQUEST:"upload.client.finished_sending_start_request",EVENT_FAILED_START_REQUEST:"upload.client.failed_sending_start_request",EVENT_CANCELED_START_REQUEST:"upload.client.canceled_sending_start_request",EVENT_STARTED_RECEIVE_REQUEST:"upload.client.started_sending_receive_request",EVENT_FINISHED_RECEIVE_REQUEST:"upload.client.finished_sending_receive_request",EVENT_FAILED_RECEIVE_REQUEST:"upload.client.failed_sending_receive_request",EVENT_STARTED_POST_REQUEST:"upload.client.started_sending_post_request",EVENT_FINISHED_POST_REQUEST:"upload.client.finished_sending_post_request",EVENT_FAILED_POST_REQUEST:"upload.client.failed_sending_post_request",EVENT_HANDLING_SERVER_FAILURE_RESPONSE:"upload.client.handling_server_failure_response",EVENT_HANDLING_TRANSPORT_FAILURE_RESPONSE:"upload.client.handling_transport_failure_response",EVENT_DUPLICATE_POST_REQUEST:"upload.client.duplicate_post_request",EVENT_STARTED_SENDING_CHUNK_BYTES:"upload.client.started_sending_chunk_bytes",EVENT_FINISHED_SENDING_CHUNK_BYTES:"upload.client.finished_sending_chunk_bytes",EVENT_CANCELED_SENDING_CHUNK_BYTES:"upload.client.canceled_sending_chunk_bytes",EVENT_FAILED_SENDING_CHUNK_BYTES:"upload.client.failed_sending_chunk_bytes",EVENT_TIMEOUT_SENDING_CHUNK_BYTES:"upload.client.timeout_sending_chunk_bytes",EVENT_STARTED_FETCHING_STATUS:"upload.client.started_fetching_status",EVENT_FINISHED_FETCHING_STATUS:"upload.client.finished_fetching_status",EVENT_RESUMABLE_CALLED:"upload.client.resumable_called",EVENT_RESUMABLE_STARTED:"upload.client.resumable_started",EVENT_RESUMABLE_SUCCESS:"upload.client.resumable_success",EVENT_RESUMABLE_FAILED:"upload.client.resumable_failed",EVENT_ENCODING_START_OBSERVED:"encode.client.encoding_start_observed",EVENT_ENCODING_SUCCESS_OBSERVED:"encode.client.encoding_success_observed",EVENT_ENCODING_FAIL_OBSERVED:"encode.client.encoding_fail_observed",EVENT_ENCODING_ABORT_OBSERVED:"encode.client.encoding_abort_observed",EVENT_FETCH_FAIL_OBSERVED:"encode.client.fetch_video_info_fail_observed",EVENT_ENCODING_SUBSCRIBE_TO_VIDEO_STATUS:"encode.client.subscribe_to_video_status",EVENT_ENCODING_POLLING_FALLBACK:"encode.client.polling_fallback",EVENT_RECEIVED_RESPONSE:"upload.client.received_response",EVENT_STARTED_FLOW_EXP1:"upload.client.started_flow_exp1",EVENT_FINISHED_FLOW_EXP1:"upload.client.finished_flow_exp1",EVENT_CANCELED_FLOW_EXP1:"upload.client.canceled_flow_exp1",EVENT_MEASURE_FREE_LOCAL_STORAGE:"upload.client.free_local_storage",EVENT_ASYNC_STORAGE_WRITE_STARTED:"upload.client.async_storage_write_started",EVENT_ASYNC_STORAGE_WRITE_SUCCEEDED:"upload.client.async_storage_write_succeeded",EVENT_ASYNC_STORAGE_WRITE_FAILED:"upload.client.async_storage_write_failed",EVENT_ASYNC_STORAGE_READ_STARTED:"upload.client.async_storage_read_started",EVENT_ASYNC_STORAGE_READ_SUCCEEDED:"upload.client.async_storage_read_succeeded",EVENT_ASYNC_STORAGE_READ_FAILED:"upload.client.async_storage_read_failed",EVENT_ASYNC_STORAGE_DATA_CLEANED:"upload.client.async_storage_data_cleaned",EVENT_ASYNC_STORAGE_DATA_VALIDATE_FAILED:"upload.client.async_storage_data_validate_failed",EVENT_ASYNC_STORAGE_DATA_VALIDATE_SUCCEEDED:"upload.client.async_storage_data_validate_succeeded"};Object.assign(g,a);Object.assign(g.prototype,{logEvent:function(a,c){__p&&__p();c=babelHelpers["extends"]({},c);c.elapsed_time==null&&(a.indexOf("started")!==-1?this._times[a]=Date.now():a.indexOf("finished")!==-1?c.elapsed_time=this._computeElapsedTime(a,"finished"):a.indexOf("canceled")!==-1?c.elapsed_time=this._computeElapsedTime(a,"canceled"):a.indexOf("failed")!==-1&&(c.elapsed_time=this._computeElapsedTime(a,"failed")));c.event=a;c.source=this._source;c.composer_dialog_version=c.composer_dialog_version||this._composerDialogVersion;c.waterfall_id=this._waterfallID;c.ad_account_id=this._adAccountID;c.target_id=this._targetID;c.is_chunked_upload=this._isChunkedUpload;c.actor_id=this._actorID;c.composer_entry_point_ref=this._composerEntryPointRef;c.is_remote_upload=this._isRemoteUpload;c.container_type=this._containerType;c.has_file_been_replaced=this._hasFileBeenReplaced;c.trigger_time=Date.now();b("Banzai").post(g.BANZAI_ROUTE,c,{delay:this._delay,retry:!0})},getWaterfallID:function(){return this._waterfallID},_computeElapsedTime:function(a,b){a=a.replace(b,"started");b=this._times[a];return b?Date.now()-b:null}});e.exports=g}),null);
__d("VideoUploadCrashMonitor",["Bandicoot","VideoUploadLogger"],(function(a,b,c,d,e,f){__p&&__p();a=function(a){"use strict";__p&&__p();babelHelpers.inheritsLoose(c,a);function c(b,c,d,e,f,g,h,i){var j;j=a.call(this,"VideoUploadSession")||this;j.$VideoUploadCrashMonitor1={waterfallID:b,actorID:c,source:d,targetID:e,loggingDelay:f,supportsChunking:g,composerEntryPointRef:h,flowStarted:i};return j}var d=c.prototype;d.flowStarted=function(){this.$VideoUploadCrashMonitor1.flowStarted=!0};d.getCrashTimeData=function(){return this.$VideoUploadCrashMonitor1};d.logCrash=function(a,c,d){if(!c.waterfallID)return;a=new(b("VideoUploadLogger"))({actor_id:c.actorID,source:c.source,waterfall_id:c.waterfallID,target_id:c.targetID,delay:c.loggingDelay,is_chunked_upload:c.supportsChunking,composer_entry_point_ref:c.composerEntryPointRef});d={error:"Crash Detected",error_description:"Detected video upload did not complete due to a crash"};a.logEvent(b("VideoUploadLogger").EVENT_FAILED_UPLOADING,d);c.flowStarted&&a.logEvent(b("VideoUploadLogger").EVENT_RESIGNED_FLOW,{})};return c}(b("Bandicoot"));e.exports=a}),null);
__d("VideoUploadFileValidator",["errorCode","fbt","requireCond","cr:909496","cr:909497","React"],(function(a,b,c,d,e,f,g,h){__p&&__p();var i=[1363019,1363020,1363021,1363022,1363023,1363024,1363025,1363026,1363027,1363030,1363031,1363032,1363033,1363038,1363039,1363040,1363048],j=["VIDEO__INVALID_GUIDE_DATA"];a=function(){"use strict";__p&&__p();function a(a){this.$1=a}var c=a.prototype;c.validate=function(a,b){return this.$2(a)&&this.$3(a)&&this.$4(a.getExtension()==="gif",b)};c.getValidationErrorMessage=function(a,b){return this.$5(a)||this.$6(a)||this.$7(a.getExtension()==="gif",b)};a.canReplaceVideoForError=function(a){if(!a)return!0;if(j.indexOf(a)>-1)return!1;return i.indexOf(a)>-1?!0:!1};c.$2=function(a){a=this.$5(a);if(a){b("cr:909496")!==null&&b("cr:909496").show(a.summary,a.description);return!1}else return!0};c.$5=function(a){if(this.$1.extensions[a.getExtension()])return;a="http://www.facebook.com/help/?faq=218673814818907#What-formats-of-video-files-can-I-upload?";a=b("React").jsx(b("cr:909497"),{target:"_blank",href:a,children:h._("recommended formats")});return{summary:h._("Unsupported File Format"),description:h._("Sorry, the file you selected is in a format that we don't support. Please use one of our {link} for video files.",[h._param("link",a)])}};c.$3=function(a){a=this.$6(a);if(a){b("cr:909496")!==null&&b("cr:909496").show(a.summary,a.description);return!1}else return!0};c.$6=function(a){var b;if(a.getSize()===null)return;a.getSize()<this.$1.minSize&&(b=this.$8());a.getSize()>this.$1.maxSize&&(b=this.$9());return b};c.$8=function(){var a=Math.round(this.$1.minSize/1024);return{summary:h._("Video File Too Small"),description:h._("The video file you tried to upload is too small. The minimum size for a video file is {min-size} KB. Please try again with a larger file.",[h._param("min-size",a)])}};c.$9=function(){var a=Math.floor(this.$1.maxSize/1024/1024);return{summary:h._("Video File Too Large"),description:h._("The video file you tried to upload is too large. The maximum size for a video file is {max-size} MB. Please try again with a smaller file.",[h._param("max-size",a)])}};c.$4=function(a,c){a=this.$7(a,c);if(a){b("cr:909496")!==null&&b("cr:909496").show(a.summary,a.description);return!1}else return!0};c.$7=function(a,b){__p&&__p();var c;if(!b)return;var d=b.format.duration;d&&(d>this.$1.maxLength&&(c=this.$10()),d<this.$1.minLength&&!a&&(c=this.$11()));if(!b.streams||!b.streams.primaryVideo)return;d=b.streams.primaryVideo.width;a=b.streams.primaryVideo.height;var e=0,f=0;b.videoPlayerData!==null&&(e=b.videoPlayerData.height,f=b.videoPlayerData.width);this.$1.acceptDimensionsFromPlayer&&f!==0&&e!==0&&(d=f,a=e);!b.streams.primaryVideo&&b.streams.primaryAudio&&(c=this.$12());d<this.$1.minWidth&&(c=this.$13());a<this.$1.minHeight&&(c=this.$14());f=d/a;this.$1.require16to9AspectRatio&&((f>2||f<1.6)&&(c=this.$15()));this.$1.minAspectRatio&&(f<this.$1.minAspectRatio&&(c=this.$16()));this.$1.maxAspectRatio&&(f>this.$1.maxAspectRatio&&(c=this.$17()));return c};c.$10=function(){if(this.$1.source==="profile_video")return{summary:h._("Profile Video Duration Too Long"),description:h._("The maximum length is {max-length} seconds. Please upload a shorter video.",[h._param("max-length",this.$1.maxLength)])};else return{summary:h._("Video Duration Too Long"),description:h._("The duration of the video you tried to upload is too long. The maximum duration for a video is {max-length} minutes. Please upload a shorter video.",[h._param("max-length",Math.round(this.$1.maxLength/60))])}};c.$11=function(){return{summary:h._("Video File Too Short"),description:h._({"second":"The duration of the video you tried to upload is too short. The minimum length for a video is {min-length} second. Please upload a longer video.","seconds":"The duration of the video you tried to upload is too short. The minimum length for a video is {min-length} seconds. Please upload a longer video."},[h._param("min-length",this.$1.minLength),h._enum(this.$1.minLength===1?"second":"seconds",{second:"second",seconds:"seconds"})])}};c.$12=function(){var a="http://www.facebook.com/help/?faq=218673814818907#What-formats-of-video-files-can-I-upload?";a=b("React").jsx(b("cr:909497"),{href:a,children:h._("supported video format")});return{summary:h._("No Video Detected"),description:h._("It looks like you're trying to upload a file that isn't a video. Please try uploading a {supported-video-format link}",[h._param("supported-video-format link",a)])}};c.$13=function(){return{summary:h._("Video Width Too Narrow"),description:h._("The width of the video you tried to upload is too short. The minimum width for a video is {min-width}. Please upload a wider video.",[h._param("min-width",this.$1.minWidth)])}};c.$15=function(){return{summary:h._("Problem Uploading Video"),description:h._("Videos look best when they have a 16:9 aspect ratio. Please edit your video and upload again.")}};c.$14=function(){return{summary:h._("Video Height Too Short"),description:h._("The height of the video you tried to upload is too short. The minimum height for a video is {min-height}. Please upload a taller video.",[h._param("min-height",this.$1.minHeight)])}};c.$17=function(){return{summary:h._("Video Too Wide"),description:h._("The video you selected is too wide. Aspect ratios for videos need to be between {max_aspect_ratio} and {min_aspect_ratio}. Please record and upload a taller video.",[h._param("max_aspect_ratio",this.$1.maxAspectRatio+":1"),h._param("min_aspect_ratio",this.$1.minAspectRatio+":1")])}};c.$16=function(){return{summary:h._("Video Too Tall"),description:h._("The video you selected is too tall. Aspect ratios for videos need to be between {max_aspect_ratio} and {min_aspect_ratio}. Please record and upload a narrower video.",[h._param("max_aspect_ratio",this.$1.maxAspectRatio+":1"),h._param("min_aspect_ratio",this.$1.minAspectRatio+":1")])}};return a}();e.exports=a}),null);
__d("VideoUploadFeatureDetector",["UserAgent_DEPRECATED","fileSlice"],(function(a,b,c,d,e,f){a={supportsChunking:function(){return typeof b("fileSlice")==="function"&&this.supportsXHR()},supportsFullProgress:function(){return!b("UserAgent_DEPRECATED").firefox()},supportsFileAPI:function(){return"FileList"in window},supportsFileReading:function(){return"FileReader"in window&&"DataView"in window},supportsXHR:function(){return"FormData"in window}};e.exports=a}),null);
__d("VideoUploadRequest",["AsyncRequest","DOM","DTSG","FileForm","Form","VideoUploadFeatureDetector","emptyFunction","flattenPHPQueryData","submitForm"],(function(a,b,c,d,e,f){__p&&__p();var g="video";a=function(){"use strict";__p&&__p();function a(a){__p&&__p();this.$1=a;this.$2=null;this.$3=!1;this.$4=null;this.$5=null;this.$6=null;this.$7=null;this.$8=a=b("emptyFunction");this.$9=a;this.$10=a;this.$11=a;this.$12=null}var c=a.prototype;c.setAllowCrossOrigin=function(a){this.$3=a;return this};c.setData=function(a){this.$4=a;return this};c.setWaterfallID=function(a){this.$6=a;return this};c.setSuccessHandler=function(a){this.$8=a;return this};c.setErrorHandler=function(a){this.$9=a;return this};c.setTransportErrorHandler=function(a){this.$10=a;return this};c.setUploadProgressHandler=function(a){this.$11=a;return this};c.setTimeoutHandler=function(a,b){this.$7=a;this.$12=b;return this};c.setThumbnail=function(a){this.$13=a;return this};c.setCustomProfileImage=function(a){this.$14=a;return this};c.setCustomBackgroundImage=function(a){this.$15=a;return this};c.setFeedBackgroundImage=function(a){this.$16=a;return this};c.setHandle=function(a){this.$5=a;return this};c.setCaptions=function(a){this.$17=a;return this};c.setPollOptionImages=function(a){this.$18=a;return this};c.send=function(){__p&&__p();if(this.$2)throw new Error("An upload request is already in progress.");if(b("VideoUploadFeatureDetector").supportsXHR()){this.$2=this.$19();if(this.$13||this.$17||this.$14||this.$15||this.$16||this.$18){var a=new FormData();this.$13&&a.append("thumb",this.$13);this.$14&&a.append("schedule_custom_profile_image",this.$14);this.$15&&a.append("schedule_custom_background_image",this.$15);this.$16&&a.append("schedule_feed_background_image",this.$16);this.$17&&this.$17.forEach(function(b,c){c=b.getIsDefault()?"captions_default":"captions_file"+c;a.append(c,b.getFile())});if(this.$18){var c=this.$18;Object.keys(c).forEach(function(b){a.append(b,c[b])})}if(this.$4){var d=b("flattenPHPQueryData")(this.$4);Object.keys(d).forEach(function(b){a.append(b,d[b])})}this.$2.setRawData(a)}this.$2.send()}else this.$2=this.$20(),this.$21(this.$2)};c.sendChunk=function(a){if(this.$2)throw new Error("An upload request is already in progress.");var b=new FormData();this.$5?b.append("fbuploader_video_file_chunk",this.$5):b.append("video_file_chunk",a);this.$2=this.$19();this.$2.setRawData(b);this.$2.send()};c.sendFile=function(a){__p&&__p();if(this.$2)throw new Error("An upload request is already in progress.");this.$2=this.$20();var c=a.cloneNode(!1);a.name=g;b("DOM").replace(a,c);b("DOM").appendContent(this.$2.getRoot(),a);this.$21(this.$2);a.name=c.name;b("DOM").replace(c,a)};c.abort=function(){if(!this.$2)return;this.$2.abort();this.$2=null};c.$19=function(){var a=this.__getAsyncRequest().setAllowCrossOrigin(this.$3).setURI(this.$1).setData(this.$4).setRequestHeader("X_FB_VIDEO_WATERFALL_ID",this.$6).setHandler(this.$8).setErrorHandler(this.$9).setTransportErrorHandler(this.$10).setUploadProgressHandler(this.$11);this.$12&&a.setTimeoutHandler(this.$7,this.$12);return a};c.__getAsyncRequest=function(){return new(b("AsyncRequest"))()};c.$20=function(){var a=b("DOM").create("form",{action:this.$1,method:"POST"});b("Form").createHiddenInputs(babelHelpers["extends"]({fb_dtsg:b("DTSG").getToken()},this.$4),a);a=new(b("FileForm"))(a,null,{allowCrossOrigin:this.$3});a.subscribe("success",this.$22.bind(this));a.subscribe("failure",this.$23.bind(this));a.subscribe("progress",this.$24.bind(this));return a};c.$21=function(a){b("DOM").appendContent(document.body,a.getRoot()),b("submitForm")(a.getRoot())};c.$22=function(a,b){this.$8(b.response)};c.$23=function(a,b){this.$9(b.response)};c.$24=function(a,b){this.$11(b.event)};return a}();e.exports=a}),null);
__d("VideoUploadRequestContext",[],(function(a,b,c,d,e,f){__p&&__p();a=function(){"use strict";__p&&__p();function a(){this.reset()}var b=a.prototype;b.setFile=function(a){this.$1=a;return this};b.getFile=function(){return this.$1};b.setMetadata=function(a){this.$2=a;return this};b.getMetadata=function(){return this.$2};b.setVideoID=function(a){this.$3=a;return this};b.getVideoID=function(){return this.$3};b.setUploadSessionID=function(a){this.$4=a;return this};b.getUploadSessionID=function(){return this.$4};b.setFbRegion=function(a){this.$5=a;return this};b.getFbRegion=function(){return this.$5};b.setStartOffset=function(a){this.$6=a;return this};b.getStartOffset=function(){return this.$6};b.setEndOffset=function(a){this.$7=a;return this};b.getEndOffset=function(){return this.$7};b.setPartitionStartOffset=function(a){this.$8=a;return this};b.getPartitionStartOffset=function(){return this.$8};b.setPartitionEndOffset=function(a){this.$9=a;return this};b.getPartitionEndOffset=function(){return this.$9};b.setTargetID=function(a){this.$10=a;return this};b.getTargetID=function(){return this.$10};b.setSource=function(a){this.$11=a;return this};b.setComposerDialogVersion=function(a){this.$12=a;return this};b.getComposerDialogVersion=function(){return this.$12};b.getSource=function(){return this.$11};b.setWaterfallID=function(a){this.$13=a;return this};b.getWaterfallID=function(){return this.$13};b.setComposerEntryPointRef=function(a){this.$14=a};b.getComposerEntryPointRef=function(){return this.$14};b.setHasFileBeenReplaced=function(a){this.$15=a;return this};b.getHasFileBeenReplaced=function(){return this.$15};b.setSupportsChunking=function(a){this.$16=a;return this};b.getSupportsChunking=function(){return this.$16};b.setSupportsFileAPI=function(a){this.$17=a;return this};b.getSupportsFileAPI=function(){return this.$17};b.setCreatorProduct=function(a){this.$18=a;return this};b.getCreatorProduct=function(){return this.$18};b.setLastKnownUploadSpeed=function(a){this.$19=a};b.getLastKnownUploadSpeed=function(){return this.$19||0};b.setUseParallelChunks=function(a){this.$20=a};b.getUseParallelChunks=function(){return this.$20};b.setIsSphericalVideo=function(a){this.$21=a};b.getIsSphericalVideo=function(){return this.$21};b.setSphericalMetadata=function(a){this.$22=a};b.getSphericalMetadata=function(){return this.$22};b.setEnableOmnistab=function(a){this.$23=a};b.getEnableOmnistab=function(){return this.$23};b.setClientChunkSize=function(a){this.$24=a};b.getClientChunkSize=function(){return this.$24};b.setVideoPublisherActionSource=function(a){this.$25=a};b.getVideoPublisherActionSource=function(){return this.$25};b.reset=function(){this.$1=null,this.$3=null,this.$4=null,this.$5=null,this.$6=null,this.$7=null,this.$10=null,this.$11=null,this.$12=null,this.$13=null,this.$14=null,this.$15=!1,this.$16=null,this.$17=null,this.$8=null,this.$9=null,this.$18=null,this.$19=0,this.$20=!1,this.$21=!1,this.$2={},this.$22={},this.$23=!1,this.$24=null,this.$25={}};return a}();e.exports=a}),null);
__d("VideoUploadPostRequestManager",["requireCond","cr:909282","VideoUploadLogger","VideoUploadRequest","clearTimeout","mixin","setTimeout"],(function(a,b,c,d,e,f){__p&&__p();a=function(a){"use strict";__p&&__p();babelHelpers.inheritsLoose(c,a);function c(b,c,d,e,f){__p&&__p();var g;g=a.call(this)||this;g.$VideoUploadPostRequestManager2=b;g.$VideoUploadPostRequestManager3=c;g.$VideoUploadPostRequestManager4=d;g.$VideoUploadPostRequestManager5=0;g.$VideoUploadPostRequestManager6=e;g.$VideoUploadPostRequestManager7=f;g.$VideoUploadPostRequestManager8=0;return g}var d=c.prototype;d.$VideoUploadPostRequestManager9=function(){return this.$VideoUploadPostRequestManager1?new(b("VideoUploadLogger"))({source:this.$VideoUploadPostRequestManager1.getSource(),waterfall_id:this.$VideoUploadPostRequestManager1.getWaterfallID(),target_id:this.$VideoUploadPostRequestManager1.getTargetID(),composer_entry_point_ref:this.$VideoUploadPostRequestManager1.getComposerEntryPointRef&&this.$VideoUploadPostRequestManager1.getComposerEntryPointRef()}):null};d.getRequest=function(){return this.$VideoUploadPostRequestManager10};d.sendRequest=function(a){__p&&__p();this.$VideoUploadPostRequestManager1=a;if(this.$VideoUploadPostRequestManager10){var c=this.$VideoUploadPostRequestManager9();c&&c.logEvent(b("VideoUploadLogger").EVENT_DUPLICATE_POST_REQUEST);return}this.$VideoUploadPostRequestManager11=babelHelpers["extends"]({},a.getMetadata(),this.__createRequestData(a));this.$VideoUploadPostRequestManager12=this.$VideoUploadPostRequestManager11.thumb;this.$VideoUploadPostRequestManager13=this.$VideoUploadPostRequestManager11.schedule_custom_profile_image;this.$VideoUploadPostRequestManager14=this.$VideoUploadPostRequestManager11.schedule_custom_background_image;this.$VideoUploadPostRequestManager15=this.$VideoUploadPostRequestManager11.schedule_feed_background_image;delete this.$VideoUploadPostRequestManager11.thumb;this.$VideoUploadPostRequestManager16=this.$VideoUploadPostRequestManager11.captions;delete this.$VideoUploadPostRequestManager11.captions;this.$VideoUploadPostRequestManager17=a.getWaterfallID();this.$VideoUploadPostRequestManager18=this.$VideoUploadPostRequestManager11.pollImages;this.$VideoUploadPostRequestManager19();this.inform("request-started")};d.$VideoUploadPostRequestManager19=function(){b("clearTimeout")(this.$VideoUploadPostRequestManager20),this.$VideoUploadPostRequestManager20=null,this.$VideoUploadPostRequestManager10=this.__getVideoUploadRequest(this.$VideoUploadPostRequestManager2).setAllowCrossOrigin(!0).setData(this.$VideoUploadPostRequestManager11).setThumbnail(this.$VideoUploadPostRequestManager12).setCustomProfileImage(this.$VideoUploadPostRequestManager13).setCustomBackgroundImage(this.$VideoUploadPostRequestManager14).setFeedBackgroundImage(this.$VideoUploadPostRequestManager15).setCaptions(this.$VideoUploadPostRequestManager16).setWaterfallID(this.$VideoUploadPostRequestManager17).setPollOptionImages(this.$VideoUploadPostRequestManager18).setSuccessHandler(this.$VideoUploadPostRequestManager21.bind(this)).setErrorHandler(this.$VideoUploadPostRequestManager22.bind(this)).setTransportErrorHandler(this.$VideoUploadPostRequestManager23.bind(this)),this.$VideoUploadPostRequestManager10.send()};d.__createRequestData=function(a){return{video_id:a.getVideoID(),target_id:a.getTargetID(),source:a.getSource(),waterfall_id:a.getWaterfallID(),creator_product:a.getCreatorProduct(),composer_entry_point_ref:a.getComposerEntryPointRef&&a.getComposerEntryPointRef(),composer_dialog_version:a.getComposerDialogVersion(),has_file_been_replaced:a.getHasFileBeenReplaced(),supports_chunking:a.getSupportsChunking()}};d.__getVideoUploadRequest=function(a){return new(b("VideoUploadRequest"))(a)};d.clearRequest=function(){this.$VideoUploadPostRequestManager10=null,this.$VideoUploadPostRequestManager8=0,this.$VideoUploadPostRequestManager5=0};d.isInProgress=function(){return!!this.$VideoUploadPostRequestManager10};d.$VideoUploadPostRequestManager24=function(a){b("clearTimeout")(this.$VideoUploadPostRequestManager20),this.$VideoUploadPostRequestManager20=b("setTimeout")(this.$VideoUploadPostRequestManager19.bind(this),a)};d.$VideoUploadPostRequestManager25=function(a,b){return Math.pow(a,b)*1e3};d.$VideoUploadPostRequestManager21=function(a){a=a.getPayload();this.inform("request-finished",{video_id:a.video_id,video_asset_id:a.video_asset_id,container_type:a.container_type,transport_retries:this.$VideoUploadPostRequestManager5,server_retries:this.$VideoUploadPostRequestManager8,premiere_destination_video_id:a.premiere_destination_video_id});this.clearRequest()};d.$VideoUploadPostRequestManager26=function(a){this.inform("request-failed",{error_code:a.getError(),error_description:a.getErrorDescription(),error_summary:a.getErrorSummary(),transport_retries:this.$VideoUploadPostRequestManager5,server_retries:this.$VideoUploadPostRequestManager8,error_is_transient:a.isTransient()}),this.clearRequest()};d.$VideoUploadPostRequestManager22=function(a){this.$VideoUploadPostRequestManager10=null;this.$VideoUploadPostRequestManager5=0;var c=this.$VideoUploadPostRequestManager9();if(c){var d={server_retries:this.$VideoUploadPostRequestManager8,extra_data:{failure_is_transient:a.isTransient()}};c.logEvent(b("VideoUploadLogger").EVENT_HANDLING_SERVER_FAILURE_RESPONSE,d)}a.isTransient()&&this.$VideoUploadPostRequestManager8<this.$VideoUploadPostRequestManager6?(this.$VideoUploadPostRequestManager8++,this.$VideoUploadPostRequestManager24(this.$VideoUploadPostRequestManager25(this.$VideoUploadPostRequestManager7,this.$VideoUploadPostRequestManager8))):this.$VideoUploadPostRequestManager26(a)};d.$VideoUploadPostRequestManager23=function(a){var c=this.$VideoUploadPostRequestManager9();if(c){var d={extra_data:{transport_retries:this.$VideoUploadPostRequestManager5}};c.logEvent(b("VideoUploadLogger").EVENT_HANDLING_TRANSPORT_FAILURE_RESPONSE,d)}this.$VideoUploadPostRequestManager3===0||this.$VideoUploadPostRequestManager5>=this.$VideoUploadPostRequestManager3?this.$VideoUploadPostRequestManager26(a):(this.$VideoUploadPostRequestManager5++,this.$VideoUploadPostRequestManager10=null,this.$VideoUploadPostRequestManager24(this.$VideoUploadPostRequestManager25(this.$VideoUploadPostRequestManager4,this.$VideoUploadPostRequestManager5)))};return c}(b("mixin")(b("cr:909282")));e.exports=a}),null);
__d("VideoUploadConnectionMonitor",["requireCond","cr:909282","Network","VideoUploadFeatureDetector","debounce","mixin","setTimeout"],(function(a,b,c,d,e,f){__p&&__p();a=function(a){"use strict";__p&&__p();babelHelpers.inheritsLoose(c,a);function c(){var c;c=a.call(this)||this;c.$VideoUploadConnectionMonitor1=!1;c.$VideoUploadConnectionMonitor2=[];c.$VideoUploadConnectionMonitor3=!1;c.$VideoUploadConnectionMonitor4=!0;c.$VideoUploadConnectionMonitor5=b("debounce")(function(){this.$VideoUploadConnectionMonitor6(!1)}.bind(babelHelpers.assertThisInitialized(c)),2e3);return c}var d=c.prototype;d.notifyStart=function(){if(this.$VideoUploadConnectionMonitor3)return;this.$VideoUploadConnectionMonitor2.length===0&&(this.$VideoUploadConnectionMonitor2.push(b("Network").addListener("online",function(){this.$VideoUploadConnectionMonitor6(!0)}.bind(this))),this.$VideoUploadConnectionMonitor2.push(b("Network").addListener("offline",function(){this.$VideoUploadConnectionMonitor1?this.$VideoUploadConnectionMonitor5():(this.$VideoUploadConnectionMonitor5.reset(),b("setTimeout")(this.$VideoUploadConnectionMonitor5,2e3))}.bind(this))));this.$VideoUploadConnectionMonitor3=!0};d.notifyProgress=function(a){if(!this.$VideoUploadConnectionMonitor3)return;if(!a)return;b("VideoUploadFeatureDetector").supportsFullProgress()&&(this.$VideoUploadConnectionMonitor1=!0,a.total&&a.loaded===a.total?this.$VideoUploadConnectionMonitor5.reset():this.$VideoUploadConnectionMonitor5())};d.notifySuccess=function(){if(!this.$VideoUploadConnectionMonitor3)return;this.reset();this.$VideoUploadConnectionMonitor6(!0)};d.notifyTransportError=function(){if(!this.$VideoUploadConnectionMonitor3)return;this.$VideoUploadConnectionMonitor3=!1;this.$VideoUploadConnectionMonitor6(!1)};d.notifyError=function(){if(!this.$VideoUploadConnectionMonitor3)return;this.reset();this.$VideoUploadConnectionMonitor6(!0)};d.isOnline=function(){return this.$VideoUploadConnectionMonitor4};d.reset=function(){while(this.$VideoUploadConnectionMonitor2.length)this.$VideoUploadConnectionMonitor2.pop().remove();this.$VideoUploadConnectionMonitor5.reset();this.$VideoUploadConnectionMonitor3=!1};d.$VideoUploadConnectionMonitor6=function(a){this.$VideoUploadConnectionMonitor5.reset(),this.$VideoUploadConnectionMonitor4!==a&&(this.$VideoUploadConnectionMonitor4=a,this.$VideoUploadConnectionMonitor4?this.inform("online"):this.inform("offline"))};return c}(b("mixin")(b("cr:909282")));e.exports=a}),null);
__d("VideoUploadReceiveRequestManager",["fbt","requireCond","cr:909282","BanzaiODS","ResumableUploadAsyncService","ResumableUploadService","ResumableUploadServiceState.enum","VideoUploadConnectionMonitor","VideoUploadRequest","clearTimeout","md5","mixin","setTimeout"],(function(a,b,c,d,e,f,g){__p&&__p();var h=1363037;a=function(a){"use strict";__p&&__p();babelHelpers.inheritsLoose(c,a);function c(c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){__p&&__p();var x;m===void 0&&(m="");n===void 0&&(n=!1);o===void 0&&(o=!1);p===void 0&&(p=null);q===void 0&&(q=null);r===void 0&&(r=null);s===void 0&&(s=0);t===void 0&&(t=!1);u===void 0&&(u=!1);v===void 0&&(v=!1);w===void 0&&(w=!1);x=a.call(this)||this;x.$VideoUploadReceiveRequestManager1=c;x.$VideoUploadReceiveRequestManager2=d;x.$VideoUploadReceiveRequestManager3=e!=null?e:0;x.$VideoUploadReceiveRequestManager4=f;x.$VideoUploadReceiveRequestManager5=g;x.$VideoUploadReceiveRequestManager6=h;x.$VideoUploadReceiveRequestManager7=i;x.$VideoUploadReceiveRequestManager8=j;x.$VideoUploadReceiveRequestManager9=k;x.$VideoUploadReceiveRequestManager10=l;x.$VideoUploadReceiveRequestManager11=0;x.$VideoUploadReceiveRequestManager12=0;x.$VideoUploadReceiveRequestManager13=0;x.$VideoUploadReceiveRequestManager14=null;x.$VideoUploadReceiveRequestManager15=null;x.$VideoUploadReceiveRequestManager16=0;x.$VideoUploadReceiveRequestManager17="constructed";x.$VideoUploadReceiveRequestManager18=null;x.$VideoUploadReceiveRequestManager19=m;x.$VideoUploadReceiveRequestManager20=o;x.$VideoUploadReceiveRequestManager21=n;x.$VideoUploadReceiveRequestManager22=p;x.$VideoUploadReceiveRequestManager23=!1;x.$VideoUploadReceiveRequestManager24=q;x.$VideoUploadReceiveRequestManager25=t;x.$VideoUploadReceiveRequestManager26=u;x.$VideoUploadReceiveRequestManager27=s;x.$VideoUploadReceiveRequestManager28=v;x.$VideoUploadReceiveRequestManager29=r;x.$VideoUploadReceiveRequestManager30=w;x.$VideoUploadReceiveRequestManager31=null;x.$VideoUploadReceiveRequestManager32=null;x.$VideoUploadReceiveRequestManager33=!1;x.$VideoUploadReceiveRequestManager34=null;x.$VideoUploadReceiveRequestManager35=new(b("VideoUploadConnectionMonitor"))();x.$VideoUploadReceiveRequestManager35.subscribe("online",x.$VideoUploadReceiveRequestManager36.bind(babelHelpers.assertThisInitialized(x)));x.$VideoUploadReceiveRequestManager35.subscribe("offline",x.$VideoUploadReceiveRequestManager37.bind(babelHelpers.assertThisInitialized(x)));return x}var d=c.prototype;d.updateVideoID=function(a){if(this.$VideoUploadReceiveRequestManager38.getVideoID())return;this.$VideoUploadReceiveRequestManager38.setVideoID(a);this.$VideoUploadReceiveRequestManager39&&this.$VideoUploadReceiveRequestManager39.setData(this.__createRequestData(this.$VideoUploadReceiveRequestManager38));this.$VideoUploadReceiveRequestManager40()};d.isResumabilityEnabled=function(){return this.$VideoUploadReceiveRequestManager21};d.isResumableServiceProxyReceiveEnabled=function(){return this.$VideoUploadReceiveRequestManager25};d.sendRequest=function(a){this.$VideoUploadReceiveRequestManager17="sending request";if(this.$VideoUploadReceiveRequestManager39){this.$VideoUploadReceiveRequestManager17="request already in progress";return}this.$VideoUploadReceiveRequestManager16=a.getEndOffset()-a.getStartOffset();this.$VideoUploadReceiveRequestManager38=a;this.$VideoUploadReceiveRequestManager41()};d.cancelRequest=function(){if(!this.$VideoUploadReceiveRequestManager39)return;this.$VideoUploadReceiveRequestManager39.abort();this.$VideoUploadReceiveRequestManager18!==null&&this.$VideoUploadReceiveRequestManager18.cancel();this.$VideoUploadReceiveRequestManager42();this.inform("request-canceled")};d.appendStateLogData=function(a,b){a[b+"request_manager_state"]=this.$VideoUploadReceiveRequestManager17,a[b+"upload_speed"]=this.$VideoUploadReceiveRequestManager15,a[b+"transport_retries"]=this.$VideoUploadReceiveRequestManager11,a[b+"server_retries"]=this.$VideoUploadReceiveRequestManager12,a[b+"timeout_retries"]=this.$VideoUploadReceiveRequestManager13,a[b+"last_timeout_value"]=this.$VideoUploadReceiveRequestManager43,a[b+"last_request_start_time"]=this.$VideoUploadReceiveRequestManager14,a[b+"pending_request"]=this.$VideoUploadReceiveRequestManager39!=null,a[b+"pending_timer"]=this.$VideoUploadReceiveRequestManager44!=null,a[b+"cached_chunk"]=this.$VideoUploadReceiveRequestManager45!=null,a[b+"early_receive_start"]=this.$VideoUploadReceiveRequestManager33,this.$VideoUploadReceiveRequestManager38!=null&&(a[b+"start_offset"]=this.$VideoUploadReceiveRequestManager38.getStartOffset(),a[b+"end_offset"]=this.$VideoUploadReceiveRequestManager38.getEndOffset(),a[b+"partition_start_offset"]=this.$VideoUploadReceiveRequestManager38.getPartitionStartOffset(),a[b+"partition_end_offset"]=this.$VideoUploadReceiveRequestManager38.getPartitionEndOffset()),this.$VideoUploadReceiveRequestManager35!=null&&(a[b+"connection_monitor_online"]=this.$VideoUploadReceiveRequestManager35.isOnline())};d.getHostName=function(a){try{return new URL(a).hostname}catch(a){return null}};d.$VideoUploadReceiveRequestManager42=function(){this.$VideoUploadReceiveRequestManager39=null,this.$VideoUploadReceiveRequestManager45=null,this.$VideoUploadReceiveRequestManager11=0,this.$VideoUploadReceiveRequestManager12=0,this.$VideoUploadReceiveRequestManager13=0,this.$VideoUploadReceiveRequestManager14=null,this.$VideoUploadReceiveRequestManager15=null,this.$VideoUploadReceiveRequestManager16=0,this.$VideoUploadReceiveRequestManager31=null,this.$VideoUploadReceiveRequestManager32=null,this.$VideoUploadReceiveRequestManager33=!1,this.$VideoUploadReceiveRequestManager23=!1,this.$VideoUploadReceiveRequestManager34=null,this.$VideoUploadReceiveRequestManager38.reset(),this.$VideoUploadReceiveRequestManager35.reset(),b("clearTimeout")(this.$VideoUploadReceiveRequestManager44),this.$VideoUploadReceiveRequestManager44=null};d.$VideoUploadReceiveRequestManager41=function(a){__p&&__p();b("clearTimeout")(this.$VideoUploadReceiveRequestManager44);this.$VideoUploadReceiveRequestManager44=null;if(this.$VideoUploadReceiveRequestManager38.getSupportsChunking()&&this.$VideoUploadReceiveRequestManager38.getStartOffset()>=this.$VideoUploadReceiveRequestManager38.getPartitionEndOffset()){!a?(this.inform("request-finished",{start_offset:this.$VideoUploadReceiveRequestManager38.getEndOffset()-1,end_offset:this.$VideoUploadReceiveRequestManager38.getEndOffset(),transport_retries:this.$VideoUploadReceiveRequestManager11,server_retries:this.$VideoUploadReceiveRequestManager12,upload_speed:this.$VideoUploadReceiveRequestManager15,request_manager_state:this.$VideoUploadReceiveRequestManager17,upload_domain:this.$VideoUploadReceiveRequestManager34}),this.$VideoUploadReceiveRequestManager17="request finished - notified"):this.$VideoUploadReceiveRequestManager17="request finished - not notified";return}this.$VideoUploadReceiveRequestManager39=this.__getVideoUploadRequest(this.$VideoUploadReceiveRequestManager1).setAllowCrossOrigin(!0).setData(this.__createRequestData(this.$VideoUploadReceiveRequestManager38)).setWaterfallID(this.$VideoUploadReceiveRequestManager38.getWaterfallID()).setSuccessHandler(this.__handleSuccessResponse.bind(this)).setErrorHandler(this.__handleServerFailureResponse.bind(this)).setTransportErrorHandler(this.$VideoUploadReceiveRequestManager46.bind(this));this.$VideoUploadReceiveRequestManager21||this.$VideoUploadReceiveRequestManager39.setUploadProgressHandler(this.$VideoUploadReceiveRequestManager47.bind(this));this.$VideoUploadReceiveRequestManager14=Date.now();this.$VideoUploadReceiveRequestManager34=this.getHostName(this.$VideoUploadReceiveRequestManager1);if(this.$VideoUploadReceiveRequestManager38.getSupportsChunking()){if(this.$VideoUploadReceiveRequestManager5){a=this.$VideoUploadReceiveRequestManager48(this.$VideoUploadReceiveRequestManager38.getEndOffset()-this.$VideoUploadReceiveRequestManager38.getStartOffset(),this.$VideoUploadReceiveRequestManager15);this.$VideoUploadReceiveRequestManager39.setTimeoutHandler(a,this.__handleResponseTimeout.bind(this));this.$VideoUploadReceiveRequestManager17="sending chunk with timeout = "+a;this.$VideoUploadReceiveRequestManager43=a}else this.$VideoUploadReceiveRequestManager17="sending chunk without timeout";a=this.$VideoUploadReceiveRequestManager49();var c=!1;this.$VideoUploadReceiveRequestManager21&&this.$VideoUploadReceiveRequestManager27<this.$VideoUploadReceiveRequestManager38.getFile().getSize()?(c=!0,this.$VideoUploadReceiveRequestManager50(a)):this.$VideoUploadReceiveRequestManager39.sendChunk(a)}else this.$VideoUploadReceiveRequestManager17="sending file",this.$VideoUploadReceiveRequestManager39.sendFile(this.$VideoUploadReceiveRequestManager38.getFile().getFileInput());this.$VideoUploadReceiveRequestManager51(c);this.$VideoUploadReceiveRequestManager35.notifyStart();this.inform("request-started",{start_offset:this.$VideoUploadReceiveRequestManager38.getStartOffset(),end_offset:this.$VideoUploadReceiveRequestManager38.getEndOffset(),transport_retries:this.$VideoUploadReceiveRequestManager11,server_retries:this.$VideoUploadReceiveRequestManager12,upload_speed:this.$VideoUploadReceiveRequestManager15,request_manager_state:this.$VideoUploadReceiveRequestManager17,upload_domain:this.$VideoUploadReceiveRequestManager34})};d.$VideoUploadReceiveRequestManager51=function(a){(this.$VideoUploadReceiveRequestManager38.getSource()==="create_flow"||this.$VideoUploadReceiveRequestManager38.getSource()==="ads_interfaces")&&b("BanzaiODS").bumpEntityKey(2966,"video_ads_upload",a?"upload_service":"graph_api")};d.$VideoUploadReceiveRequestManager52=function(a,b){!this.$VideoUploadReceiveRequestManager38.getVideoID()?(this.$VideoUploadReceiveRequestManager31=a,this.$VideoUploadReceiveRequestManager32=b):a(b)};d.$VideoUploadReceiveRequestManager40=function(){this.$VideoUploadReceiveRequestManager31&&(this.$VideoUploadReceiveRequestManager31(this.$VideoUploadReceiveRequestManager32),this.$VideoUploadReceiveRequestManager31=null,this.$VideoUploadReceiveRequestManager32=null)};d.$VideoUploadReceiveRequestManager50=function(a){__p&&__p();var c=this.$VideoUploadReceiveRequestManager38.getFile();c=c.getFile().lastModified+c.getFile().name+c.getFile().type+this.$VideoUploadReceiveRequestManager53();c=b("md5")(c)+"-"+this.$VideoUploadReceiveRequestManager38.getStartOffset()+"-"+this.$VideoUploadReceiveRequestManager38.getEndOffset();this.isResumabilityEnabled()&&this.$VideoUploadReceiveRequestManager22&&this.$VideoUploadReceiveRequestManager11>this.$VideoUploadReceiveRequestManager2/3&&(this.$VideoUploadReceiveRequestManager23=!0);var d="fb_video",e=null;this.$VideoUploadReceiveRequestManager25&&(d="fb_video2");if(this.$VideoUploadReceiveRequestManager25||this.$VideoUploadReceiveRequestManager26){var f={start_offset:this.$VideoUploadReceiveRequestManager38.getStartOffset(),end_offset:this.$VideoUploadReceiveRequestManager38.getEndOffset(),composer_session_id:this.$VideoUploadReceiveRequestManager38.getWaterfallID(),upload_session_id:this.$VideoUploadReceiveRequestManager38.getUploadSessionID(),product_media_id:this.$VideoUploadReceiveRequestManager38.getVideoID(),fb_region:this.$VideoUploadReceiveRequestManager38.getFbRegion()};e=f}f=this.$VideoUploadReceiveRequestManager20?b("ResumableUploadAsyncService"):b("ResumableUploadService");this.$VideoUploadReceiveRequestManager18=new f(d,this.$VideoUploadReceiveRequestManager19,c,null,null,this.$VideoUploadReceiveRequestManager23?null:this.$VideoUploadReceiveRequestManager22,this.$VideoUploadReceiveRequestManager24,e,this.$VideoUploadReceiveRequestManager30?this.$VideoUploadReceiveRequestManager38.getWaterfallID():null);this.$VideoUploadReceiveRequestManager34=this.$VideoUploadReceiveRequestManager18.getServiceName();this.$VideoUploadReceiveRequestManager54();this.$VideoUploadReceiveRequestManager18.resume(a);this.inform("resumable-called")};d.$VideoUploadReceiveRequestManager54=function(){__p&&__p();var a=this;this.$VideoUploadReceiveRequestManager38.getVideoID()||(this.$VideoUploadReceiveRequestManager33=!0);this.$VideoUploadReceiveRequestManager18.addListener(b("ResumableUploadServiceState.enum").START,function(b){a.inform("resumable-started",{resume_from_offset:b.offset})});this.$VideoUploadReceiveRequestManager55=function(b){a.inform("resumable-failed",{error_code:b.getError(),error_description:b.getErrorDescription(),error_summary:b.getErrorSummary(),error_is_transient:b.isTransient()}),a.__handleServerFailureResponse(b)};this.$VideoUploadReceiveRequestManager18.addListener(b("ResumableUploadServiceState.enum").FAIL,function(b){a.$VideoUploadReceiveRequestManager52(a.$VideoUploadReceiveRequestManager55,b)});this.$VideoUploadReceiveRequestManager56=function(b){!a.$VideoUploadReceiveRequestManager25?(a.$VideoUploadReceiveRequestManager39.setHandle(b),a.$VideoUploadReceiveRequestManager39.sendChunk(null)):a.__handleSuccessResponsePayload({start_offset:a.$VideoUploadReceiveRequestManager38.getEndOffset(),end_offset:a.$VideoUploadReceiveRequestManager38.getPartitionEndOffset()}),a.inform("resumable-success",{everstore_handle:b})};this.$VideoUploadReceiveRequestManager18.addListener(b("ResumableUploadServiceState.enum").SUCCESS,function(b){a.$VideoUploadReceiveRequestManager52(a.$VideoUploadReceiveRequestManager56,b)});this.$VideoUploadReceiveRequestManager57=function(b){a.inform("resumable-failed",{error_code:b.getError(),error_description:b.getErrorDescription(),error_summary:b.getErrorSummary(),error_is_transient:b.isTransient()}),a.$VideoUploadReceiveRequestManager46(b)};this.$VideoUploadReceiveRequestManager18.addListener(b("ResumableUploadServiceState.enum").TRANSPORT_FAILURE,function(b){a.$VideoUploadReceiveRequestManager52(a.$VideoUploadReceiveRequestManager57,b)});this.$VideoUploadReceiveRequestManager18.addListener(b("ResumableUploadServiceState.enum").PROGRESS,function(b){a.$VideoUploadReceiveRequestManager28&&(a.$VideoUploadReceiveRequestManager11=0),a.$VideoUploadReceiveRequestManager47(b)})};d.__getVideoUploadRequest=function(a){return new(b("VideoUploadRequest"))(a)};d.$VideoUploadReceiveRequestManager58=function(a){this.$VideoUploadReceiveRequestManager17="setting request to send after"+a,b("clearTimeout")(this.$VideoUploadReceiveRequestManager44),this.$VideoUploadReceiveRequestManager44=b("setTimeout")(this.$VideoUploadReceiveRequestManager41.bind(this),a)};d.$VideoUploadReceiveRequestManager49=function(){if(this.$VideoUploadReceiveRequestManager45)return this.$VideoUploadReceiveRequestManager45;this.$VideoUploadReceiveRequestManager21?this.$VideoUploadReceiveRequestManager45=this.$VideoUploadReceiveRequestManager38.getFile().getFile().slice(this.$VideoUploadReceiveRequestManager38.getStartOffset(),this.$VideoUploadReceiveRequestManager38.getEndOffset(),"application/octet-stream"):this.$VideoUploadReceiveRequestManager45=this.$VideoUploadReceiveRequestManager38.getFile().getChunk(this.$VideoUploadReceiveRequestManager38.getStartOffset(),this.$VideoUploadReceiveRequestManager38.getEndOffset());return this.$VideoUploadReceiveRequestManager45};d.__createRequestData=function(a){return{video_id:a.getVideoID(),start_offset:a.getStartOffset(),end_offset:a.getEndOffset(),source:a.getSource(),target_id:a.getTargetID(),waterfall_id:a.getWaterfallID(),composer_entry_point_ref:a.getComposerEntryPointRef&&a.getComposerEntryPointRef(),composer_dialog_version:a.getComposerDialogVersion(),has_file_been_replaced:a.getHasFileBeenReplaced(),supports_chunking:a.getSupportsChunking(),upload_speed:this.$VideoUploadReceiveRequestManager15,partition_start_offset:a.getPartitionStartOffset(),partition_end_offset:a.getPartitionEndOffset()}};d.__handleSuccessResponse=function(a){a=a.getPayload();this.__handleSuccessResponsePayload(a)};d.__handleSuccessResponsePayload=function(a){__p&&__p();this.$VideoUploadReceiveRequestManager17="success response received";var b=Date.now()-this.$VideoUploadReceiveRequestManager14;b=b===0?1:b;if(a.start_offset===this.$VideoUploadReceiveRequestManager38.getEndOffset()){var c=this.$VideoUploadReceiveRequestManager38.getEndOffset()-this.$VideoUploadReceiveRequestManager38.getStartOffset();this.$VideoUploadReceiveRequestManager15=Math.floor(c/b)}else this.$VideoUploadReceiveRequestManager15=null;this.$VideoUploadReceiveRequestManager35.notifySuccess();this.inform("request-finished",{start_offset:this.$VideoUploadReceiveRequestManager38.getStartOffset(),end_offset:this.$VideoUploadReceiveRequestManager38.getEndOffset(),transport_retries:this.$VideoUploadReceiveRequestManager11,server_retries:this.$VideoUploadReceiveRequestManager12,upload_speed:this.$VideoUploadReceiveRequestManager15,request_manager_state:this.$VideoUploadReceiveRequestManager17,upload_domain:this.$VideoUploadReceiveRequestManager34});this.$VideoUploadReceiveRequestManager38.setStartOffset(a.start_offset);c=a.end_offset;this.$VideoUploadReceiveRequestManager38.getClientChunkSize()&&(c=a.start_offset+Math.min(this.$VideoUploadReceiveRequestManager38.getPartitionEndOffset()-a.start_offset,this.$VideoUploadReceiveRequestManager38.getClientChunkSize()));this.$VideoUploadReceiveRequestManager38.setEndOffset(c);this.$VideoUploadReceiveRequestManager38.setLastKnownUploadSpeed(this.$VideoUploadReceiveRequestManager15);this.$VideoUploadReceiveRequestManager39=null;this.$VideoUploadReceiveRequestManager45=null;this.$VideoUploadReceiveRequestManager11=0;this.$VideoUploadReceiveRequestManager12=0;this.$VideoUploadReceiveRequestManager13=0;this.$VideoUploadReceiveRequestManager38.getSupportsChunking()&&this.$VideoUploadReceiveRequestManager41(!0)};d.__handleServerFailureResponse=function(a){__p&&__p();this.$VideoUploadReceiveRequestManager17="failure response received";this.$VideoUploadReceiveRequestManager39=null;this.$VideoUploadReceiveRequestManager11=0;this.$VideoUploadReceiveRequestManager15=null;this.$VideoUploadReceiveRequestManager13=0;this.$VideoUploadReceiveRequestManager35.notifyError();if(this.__hasInvalidStartOffsetAndHasRetries(a.getError())){this.$VideoUploadReceiveRequestManager12++;var b=a.getPayload();this.$VideoUploadReceiveRequestManager17="invalid offset response received start="+b.start_offset+" end="+b.end_offset;(this.$VideoUploadReceiveRequestManager38.getStartOffset()!=b.start_offset||this.$VideoUploadReceiveRequestManager38.getEndOffset()!=b.end_offset)&&(this.$VideoUploadReceiveRequestManager38.setStartOffset(b.start_offset),this.$VideoUploadReceiveRequestManager38.setEndOffset(b.end_offset),this.$VideoUploadReceiveRequestManager45=null);this.$VideoUploadReceiveRequestManager41()}else(a.isTransient()||this.$VideoUploadReceiveRequestManager10)&&this.$VideoUploadReceiveRequestManager12<this.$VideoUploadReceiveRequestManager4?(this.$VideoUploadReceiveRequestManager17="transient server error",this.$VideoUploadReceiveRequestManager12++,this.$VideoUploadReceiveRequestManager58(this.$VideoUploadReceiveRequestManager59(this.$VideoUploadReceiveRequestManager9,this.$VideoUploadReceiveRequestManager12,0))):this.$VideoUploadReceiveRequestManager60(a)};d.__handleResponseTimeout=function(a){__p&&__p();this.inform("request-timeout",{start_offset:this.$VideoUploadReceiveRequestManager38.getStartOffset(),end_offset:this.$VideoUploadReceiveRequestManager38.getEndOffset(),transport_retries:this.$VideoUploadReceiveRequestManager11,server_retries:this.$VideoUploadReceiveRequestManager12,timeout_retries:this.$VideoUploadReceiveRequestManager13,upload_speed:this.$VideoUploadReceiveRequestManager15,request_manager_state:this.$VideoUploadReceiveRequestManager17,upload_domain:this.$VideoUploadReceiveRequestManager34});this.$VideoUploadReceiveRequestManager39.abort();this.$VideoUploadReceiveRequestManager39=null;this.$VideoUploadReceiveRequestManager15=null;this.$VideoUploadReceiveRequestManager35.notifyTransportError();if(++this.$VideoUploadReceiveRequestManager13<=this.$VideoUploadReceiveRequestManager6){a=this.$VideoUploadReceiveRequestManager38.getEndOffset()-this.$VideoUploadReceiveRequestManager38.getStartOffset();a=Math.floor(a/2);a=Math.max(a,this.$VideoUploadReceiveRequestManager16);var b=this.$VideoUploadReceiveRequestManager38.getEndOffset();b=Math.min(b,this.$VideoUploadReceiveRequestManager38.getStartOffset()+a);this.$VideoUploadReceiveRequestManager38.setEndOffset(b);this.$VideoUploadReceiveRequestManager45=null;this.$VideoUploadReceiveRequestManager17="resending after timeout with chunksize="+a;this.$VideoUploadReceiveRequestManager41()}else this.$VideoUploadReceiveRequestManager61({error_code:1006,error_description:g._("Your browser appears to be offline. Please check your internet connection and try again."),error_summary:g._("No Network Connection"),error_is_transient:!0})};d.__hasInvalidStartOffsetAndHasRetries=function(a){return a===h&&this.$VideoUploadReceiveRequestManager12<this.$VideoUploadReceiveRequestManager4};d.$VideoUploadReceiveRequestManager46=function(a){this.$VideoUploadReceiveRequestManager35.notifyTransportError(),this.$VideoUploadReceiveRequestManager15=null,this.$VideoUploadReceiveRequestManager13=0,this.$VideoUploadReceiveRequestManager11<this.$VideoUploadReceiveRequestManager2?(this.$VideoUploadReceiveRequestManager17="resending after transport failure",this.$VideoUploadReceiveRequestManager11++,this.$VideoUploadReceiveRequestManager39=null,this.$VideoUploadReceiveRequestManager58(this.$VideoUploadReceiveRequestManager59(this.$VideoUploadReceiveRequestManager8,this.$VideoUploadReceiveRequestManager11,this.$VideoUploadReceiveRequestManager3))):this.$VideoUploadReceiveRequestManager60(a)};d.$VideoUploadReceiveRequestManager60=function(a){this.$VideoUploadReceiveRequestManager61({error_code:a.getError(),error_description:a.getErrorDescription(),error_summary:a.getErrorSummary(),error_is_transient:a.isTransient(),upload_domain:this.uploadDomain})};d.$VideoUploadReceiveRequestManager61=function(a){this.$VideoUploadReceiveRequestManager17="handling failure error",this.inform("request-failed",a),this.$VideoUploadReceiveRequestManager42()};d.$VideoUploadReceiveRequestManager47=function(a){this.$VideoUploadReceiveRequestManager35.notifyProgress(a),this.$VideoUploadReceiveRequestManager38&&this.$VideoUploadReceiveRequestManager38.getFile()&&this.inform("request-progressed",{file_size:this.$VideoUploadReceiveRequestManager38.getFile().getSize(),start_offset:this.$VideoUploadReceiveRequestManager38.getStartOffset(),sent_bytes:a.loaded,transport_retries:this.$VideoUploadReceiveRequestManager11,upload_domain:this.$VideoUploadReceiveRequestManager34})};d.$VideoUploadReceiveRequestManager36=function(a){this.inform("online"),this.$VideoUploadReceiveRequestManager11=0,this.$VideoUploadReceiveRequestManager13=0,this.$VideoUploadReceiveRequestManager44&&this.$VideoUploadReceiveRequestManager41()};d.$VideoUploadReceiveRequestManager37=function(a){this.inform("offline")};d.$VideoUploadReceiveRequestManager59=function(a,b,c){var d;this.$VideoUploadReceiveRequestManager21?d=Math.min(Math.pow(a,b),8)*1e3:d=Math.pow(a,b)*1e3;c>0&&(d=Math.min(d,c));return d};d.$VideoUploadReceiveRequestManager48=function(a,b){b>0?b=b:b=10;a=Math.floor(a/b*this.$VideoUploadReceiveRequestManager7/100);return Math.max(a,3e4)};d.$VideoUploadReceiveRequestManager53=function(){return this.$VideoUploadReceiveRequestManager29?this.$VideoUploadReceiveRequestManager29:this.$VideoUploadReceiveRequestManager38.getWaterfallID()};return c}(b("mixin")(b("cr:909282")));e.exports=a}),null);
__d("VideoUploadStartRequestManager",["requireCond","cr:909282","Assert","FileHasher","VideoUploadRequest","clearTimeout","mixin","performanceNow","setTimeout"],(function(a,b,c,d,e,f){__p&&__p();var g;a=function(a){"use strict";__p&&__p();babelHelpers.inheritsLoose(c,a);function c(b,c,d,e,f,g,h,i){__p&&__p();var j;j=a.call(this)||this;j.$VideoUploadStartRequestManager1=b;j.$VideoUploadStartRequestManager2=c;j.$VideoUploadStartRequestManager3=d;j.$VideoUploadStartRequestManager4=e;j.$VideoUploadStartRequestManager5=0;j.$VideoUploadStartRequestManager6=f;j.$VideoUploadStartRequestManager7=g;j.$VideoUploadStartRequestManager8=h;j.$VideoUploadStartRequestManager9=i;j.$VideoUploadStartRequestManager10=0;return j}var d=c.prototype;d.getRequest=function(){return this.$VideoUploadStartRequestManager11};d.sendRequest=function(a){var c=this;if(this.$VideoUploadStartRequestManager12||this.$VideoUploadStartRequestManager11)return;this.$VideoUploadStartRequestManager13=a;this.$VideoUploadStartRequestManager6&&this.$VideoUploadStartRequestManager13.getFile().getFile()&&this.$VideoUploadStartRequestManager13.getFile().getFile().size<this.$VideoUploadStartRequestManager7&&b("FileHasher").isSupported()?(this.$VideoUploadStartRequestManager14=(g||(g=b("performanceNow")))(),this.$VideoUploadStartRequestManager12=new(b("FileHasher"))(),this.$VideoUploadStartRequestManager12.hash(this.$VideoUploadStartRequestManager13.getFile().getFile(),function(a){c.$VideoUploadStartRequestManager14=(g||(g=b("performanceNow")))()-c.$VideoUploadStartRequestManager14,c.$VideoUploadStartRequestManager15=a.hash,c.$VideoUploadStartRequestManager12.destroy(),c.$VideoUploadStartRequestManager12=null,a.hash||(c.$VideoUploadStartRequestManager16=a.exception),c.$VideoUploadStartRequestManager17()})):this.$VideoUploadStartRequestManager17()};d.$VideoUploadStartRequestManager17=function(){this.$VideoUploadStartRequestManager18(),this.inform("request-started",{hash_time:this.$VideoUploadStartRequestManager14,hash_exception:this.$VideoUploadStartRequestManager16})};d.$VideoUploadStartRequestManager18=function(){b("clearTimeout")(this.$VideoUploadStartRequestManager19),this.$VideoUploadStartRequestManager19=null,this.$VideoUploadStartRequestManager11=this.__getVideoUploadRequest(this.$VideoUploadStartRequestManager1).setAllowCrossOrigin(!0).setData(this.__getDataToSend(this.$VideoUploadStartRequestManager13,this.$VideoUploadStartRequestManager15)).setWaterfallID(this.$VideoUploadStartRequestManager13.getWaterfallID()).setSuccessHandler(this.$VideoUploadStartRequestManager20.bind(this)).setErrorHandler(this.$VideoUploadStartRequestManager21.bind(this)).setTransportErrorHandler(this.$VideoUploadStartRequestManager22.bind(this)),this.$VideoUploadStartRequestManager11.send()};d.__getVideoUploadRequest=function(a){return new(b("VideoUploadRequest"))(a)};d.__getDataToSend=function(a,b){return{file_size:a.getFile().getSize(),file_extension:a.getFile().getExtension(),target_id:a.getTargetID(),source:a.getSource(),composer_dialog_version:a.getComposerDialogVersion(),waterfall_id:a.getWaterfallID(),composer_entry_point_ref:a.getComposerEntryPointRef&&a.getComposerEntryPointRef(),has_file_been_replaced:a.getHasFileBeenReplaced(),supports_chunking:a.getSupportsChunking(),supports_file_api:a.getSupportsFileAPI(),partition_start_offset:a.getPartitionStartOffset(),partition_end_offset:a.getPartitionEndOffset(),creator_product:a.getCreatorProduct(),original_file_hash:b,spherical:a.getIsSphericalVideo(),spherical_metadata:a.getSphericalMetadata(),video_publisher_action_source:a.getVideoPublisherActionSource()}};d.cancelRequest=function(){this.$VideoUploadStartRequestManager23(),this.inform("request-canceled")};d.$VideoUploadStartRequestManager24=function(a){b("clearTimeout")(this.$VideoUploadStartRequestManager19),this.$VideoUploadStartRequestManager19=b("setTimeout")(this.$VideoUploadStartRequestManager18.bind(this),a)};d.$VideoUploadStartRequestManager23=function(){this.$VideoUploadStartRequestManager12&&(this.$VideoUploadStartRequestManager12.destroy(),this.$VideoUploadStartRequestManager12=null),this.$VideoUploadStartRequestManager11&&(this.$VideoUploadStartRequestManager11.abort(),this.$VideoUploadStartRequestManager11=null),this.$VideoUploadStartRequestManager10=0,this.$VideoUploadStartRequestManager5=0,this.$VideoUploadStartRequestManager13=null,b("clearTimeout")(this.$VideoUploadStartRequestManager19),this.$VideoUploadStartRequestManager19=null};d.$VideoUploadStartRequestManager25=function(a,b,c){a=Math.pow(a,b)*1e3;c>0&&(a=Math.min(a,c));return a};d.$VideoUploadStartRequestManager20=function(a){a=a.getPayload();this.inform("request-finished",this.__getSuccessInformData(a));this.$VideoUploadStartRequestManager11=null;b("Assert").isTrue(this.$VideoUploadStartRequestManager12==null,"Unexpected: if file hasher is not null, clean up is required.")};d.__getSuccessInformData=function(a){return{video_id:a.video_id,upload_session_id:a.upload_session_id,fb_region:a.region_hint,start_offset:a.start_offset,end_offset:a.end_offset,transport_retries:this.$VideoUploadStartRequestManager5,server_retries:this.$VideoUploadStartRequestManager10,skip_upload:a.skip_upload,hash_time:this.$VideoUploadStartRequestManager14}};d.$VideoUploadStartRequestManager26=function(a){this.inform("request-failed",this.$VideoUploadStartRequestManager27(a)),this.$VideoUploadStartRequestManager11=null,b("Assert").isTrue(this.$VideoUploadStartRequestManager12==null,"Unexpected: if file hasher is not null, clean up is required.")};d.$VideoUploadStartRequestManager21=function(a){this.$VideoUploadStartRequestManager11=null,this.$VideoUploadStartRequestManager5=0,a.isTransient()&&this.$VideoUploadStartRequestManager10<this.$VideoUploadStartRequestManager8?(this.$VideoUploadStartRequestManager10++,this.$VideoUploadStartRequestManager24(this.$VideoUploadStartRequestManager25(this.$VideoUploadStartRequestManager9,this.$VideoUploadStartRequestManager10))):this.$VideoUploadStartRequestManager26(a)};d.$VideoUploadStartRequestManager22=function(a){this.$VideoUploadStartRequestManager2===0||this.$VideoUploadStartRequestManager5>=this.$VideoUploadStartRequestManager2?this.$VideoUploadStartRequestManager26(a):(this.$VideoUploadStartRequestManager5++,this.$VideoUploadStartRequestManager11=null,this.$VideoUploadStartRequestManager24(this.$VideoUploadStartRequestManager25(this.$VideoUploadStartRequestManager3,this.$VideoUploadStartRequestManager5,this.$VideoUploadStartRequestManager4)))};d.$VideoUploadStartRequestManager27=function(a){return{error_code:a.getError(),error_description:a.getErrorDescription(),error_summary:a.getErrorSummary(),transport_retries:this.$VideoUploadStartRequestManager5,server_retries:this.$VideoUploadStartRequestManager10,error_is_transient:a.isTransient()}};return c}(b("mixin")(b("cr:909282")));e.exports=a}),null);
__d("VideoUploadSession",["requireCond","cr:909282","AsyncRequest","cr:967670","VideoUploadCrashMonitor","VideoUploadFeatureDetector","VideoUploadFileValidator","VideoUploadLogger","VideoUploadMetadataParser","VideoUploadPostRequestManager","VideoUploadReceiveRequestManager","VideoUploadRequestContext","VideoUploadStartRequestManager","WaterfallIDGenerator","getByPath","md5","mixin"],(function(a,b,c,d,e,f){__p&&__p();a=function(a){"use strict";__p&&__p();babelHelpers.inheritsLoose(c,a);function c(c){__p&&__p();var d;d=a.call(this)||this;d.$VideoUploadSession1=c.source;d.$VideoUploadSession2=c.composer_dialog_version;d.$VideoUploadSession3=c.target_id;d.$VideoUploadSession4=c.logging_delay;d.$VideoUploadSession5=c.silent_file_validation;d.$VideoUploadSession6=c.background_upload;d.$VideoUploadSession7=c.actor_id;d.$VideoUploadSession8=c.composer_entry_point_ref;d.$VideoUploadSession9=c.video_publisher_action_source;d.$VideoUploadSession10=c.monitor_crashes;d.$VideoUploadSession11=c.isMultiMediaPost;d.$VideoUploadSession12=c.container_type;d.$VideoUploadSession13=c.number_of_partitions;d.$VideoUploadSession14=c.multi_partitioning_enabled;d.$VideoUploadSession15=c.change_default_chunk_size;d.$VideoUploadSession16=c.has_file_been_replaced?c.has_file_been_replaced:!1;d.$VideoUploadSession15&&(d.$VideoUploadSession17=c.client_chunk_size);d.$VideoUploadSession18=c.early_receive;d.$VideoUploadSession19=!1;d.$VideoUploadSession20=c.accept_dimensions_from_player;d.$VideoUploadSession21=c.ad_account_id;d.$VideoUploadSession22=c.waterfall_id;d.$VideoUploadSession23=new(b("VideoUploadFileValidator"))({minSize:c.min_size,maxSize:c.max_size,minLength:c.min_length,maxLength:c.max_length,minWidth:c.min_width,minHeight:c.min_height,extensions:c.extensions,source:c.source,require16to9AspectRatio:c.require_16to9_aspect_ratio,minAspectRatio:c.min_aspect_ratio,maxAspectRatio:c.max_aspect_ratio,acceptDimensionsFromPlayer:c.accept_dimensions_from_player});d.$VideoUploadSession24=b("VideoUploadFeatureDetector").supportsChunking();d.$VideoUploadSession25=b("VideoUploadFeatureDetector").supportsFileAPI();d.$VideoUploadSession24?(d.$VideoUploadSession26=c.parallel_chunk_uploads,d.$VideoUploadSession26&&(d.$VideoUploadSession27=c.parallel_chunk_upload_filesize,d.$VideoUploadSession28=c.default_chunk_size)):d.$VideoUploadSession26=!1;d.$VideoUploadSession29=d.$VideoUploadSession30(c);d.$VideoUploadSession31=d.$VideoUploadSession32(c);if(d.$VideoUploadSession26)if(d.$VideoUploadSession14){var e=0;d.$VideoUploadSession33=[];for(e=0;e<d.$VideoUploadSession13-1;e++)d.$VideoUploadSession33[e]=d.$VideoUploadSession32(c)}else d.$VideoUploadSession33=d.$VideoUploadSession32(c);d.$VideoUploadSession34=d.$VideoUploadSession35(c);d.$VideoUploadSession36=c.log_free_local_storage;d.$VideoUploadSession37=c.async_storage_enabled;d.$VideoUploadSession38=c.async_storage_validate;d.$VideoUploadSession39=c.async_storage_min_file_size;d.$VideoUploadSession40=c.async_storage_max_file_size;d.$VideoUploadSession41=c.async_storage_min_free_storage;return d}var d=c.prototype;d.$VideoUploadSession42=function(){this.$VideoUploadSession43=[];this.$VideoUploadSession44=[];this.$VideoUploadSession45=[];this.$VideoUploadSession46=[];this.$VideoUploadSession47=[];var a=0;for(a=0;a<this.$VideoUploadSession48-1;a++)this.$VideoUploadSession43.push(!1)};d.$VideoUploadSession49=function(){this.$VideoUploadSession22==null&&(this.$VideoUploadSession22=b("WaterfallIDGenerator").generate()),this.$VideoUploadSession50=new(b("VideoUploadLogger"))({actor_id:this.$VideoUploadSession7,ad_account_id:this.$VideoUploadSession21,source:this.$VideoUploadSession1,composer_dialog_version:this.$VideoUploadSession2,waterfall_id:this.$VideoUploadSession22,target_id:this.$VideoUploadSession3,delay:this.$VideoUploadSession4,is_chunked_upload:this.$VideoUploadSession24,composer_entry_point_ref:this.$VideoUploadSession8,container_type:this.$VideoUploadSession12,has_file_been_replaced:this.$VideoUploadSession16}),this.inform("set-waterfall-id",{waterfallID:this.$VideoUploadSession22})};d.createTestLogger=function(){this.$VideoUploadSession49()};d.getLogger=function(){return!this.$VideoUploadSession50?null:this.$VideoUploadSession50};d.start=function(a){__p&&__p();var c=this;this.$VideoUploadSession51=null;this.$VideoUploadSession52=null;this.$VideoUploadSession53=null;this.$VideoUploadSession54=!1;this.$VideoUploadSession55=!1;this.$VideoUploadSession56=a;this.$VideoUploadSession57=0;this.$VideoUploadSession58=!1;this.$VideoUploadSession59={sphericalMetadataXml:null,fbSpatialAudioMetadataXml:null,ytSa3dMetadataJson:null};this.$VideoUploadSession60=!1;this.$VideoUploadSession49();this.$VideoUploadSession14&&(this.$VideoUploadSession48=Math.min(this.$VideoUploadSession13,Math.ceil(this.$VideoUploadSession56.getSize()/this.$VideoUploadSession27)));this.__logEvent(b("VideoUploadLogger").EVENT_REQUESTED_UPLOADING);this.inform("upload-requested");a=new(b("VideoUploadMetadataParser"))(this.$VideoUploadSession56,this.$VideoUploadSession61.bind(this),this.$VideoUploadSession20);a.parse();this.$VideoUploadSession36&&navigator.webkitTemporaryStorage&&navigator.webkitTemporaryStorage.queryUsageAndQuota(function(a,d){c.__logEvent(b("VideoUploadLogger").EVENT_MEASURE_FREE_LOCAL_STORAGE,{free_space_in_device:d})})};d.setTargetID=function(a){this.$VideoUploadSession3=a};d.post=function(a){this.__logEvent(b("VideoUploadLogger").EVENT_STARTED_POST_REQUEST,this.$VideoUploadSession62);this.inform("post-started",a);var c=this.__createPostRequestContext(a);this.$VideoUploadSession34.sendRequest(c);this.$VideoUploadSession63=a};d.__createPostRequestContext=function(a){var c=new(b("VideoUploadRequestContext"))();this.__setupPostRequestContext(c,a);return c};d.__setupPostRequestContext=function(a,b){a.setMetadata(b).setVideoID(this.$VideoUploadSession51).setTargetID(this.$VideoUploadSession3).setSource(this.$VideoUploadSession1).setComposerDialogVersion(this.$VideoUploadSession2).setWaterfallID(this.$VideoUploadSession22).setSupportsChunking(this.$VideoUploadSession24).setCreatorProduct(this.$VideoUploadSession56.getCreatorProduct()).setFile(this.$VideoUploadSession56).setHasFileBeenReplaced(this.$VideoUploadSession16),b&&(b.spherical&&(this.$VideoUploadSession58=!0,a.setIsSphericalVideo(this.$VideoUploadSession58)),b.enable_omnistab&&(this.$VideoUploadSession60=!0,a.setEnableOmnistab(this.$VideoUploadSession60))),a.setComposerEntryPointRef&&a.setComposerEntryPointRef(this.$VideoUploadSession8)};d.cancel=function(a){a===void 0&&(a=!1);if(this.$VideoUploadSession54){var d=this.__fetchReceiveRequestManagerStateLogData();this.$VideoUploadSession64();this.$VideoUploadSession6?(this.$VideoUploadSession55||this.__logEvent(b("VideoUploadLogger").EVENT_CANCELED_UPLOADING),this.$VideoUploadSession65&&(this.__logEvent(b("VideoUploadLogger").EVENT_CANCELED_FLOW,d),this.$VideoUploadSession65=!1)):(this.__logEvent(b("VideoUploadLogger").EVENT_CANCELED_UPLOADING),this.__logEvent(b("VideoUploadLogger").EVENT_CANCELED_FLOW,d))}else a&&this.$VideoUploadSession51&&c.deleteVideo(this.$VideoUploadSession51)};d.abandon=function(a){a===void 0&&(a=!1);if(this.$VideoUploadSession54){var d=this.__fetchReceiveRequestManagerStateLogData();this.$VideoUploadSession64();this.$VideoUploadSession6?(this.$VideoUploadSession55||this.__logEvent(b("VideoUploadLogger").EVENT_ABANDONED_UPLOADING),this.$VideoUploadSession65&&(this.__logEvent(b("VideoUploadLogger").EVENT_CANCELED_FLOW,d),this.$VideoUploadSession65=!1)):(this.__logEvent(b("VideoUploadLogger").EVENT_ABANDONED_UPLOADING),this.__logEvent(b("VideoUploadLogger").EVENT_CANCELED_FLOW,d))}else a&&this.$VideoUploadSession51&&c.deleteVideo(this.$VideoUploadSession51)};d.isPostInProgress=function(){return this.$VideoUploadSession34.isInProgress()};d.isInProgress=function(){return this.$VideoUploadSession54};d.getHasUploadFinished=function(){return this.$VideoUploadSession55};d.getVideoID=function(){return this.$VideoUploadSession51};d.getUploadTime=function(){return this.$VideoUploadSession66};d.getExPartitionNumber=function(a){var b;for(b=0;b<this.$VideoUploadSession48-1;b++)if(a>=this.$VideoUploadSession44[b]&&a<this.$VideoUploadSession45[b])break;return b===this.$VideoUploadSession48?-1:b};d.getIsSphericalVideo=function(){return this.$VideoUploadSession58||!1};d.startFlow=function(){if(!this.$VideoUploadSession6||this.$VideoUploadSession65)return;this.__logEvent(b("VideoUploadLogger").EVENT_STARTED_FLOW,{is_spherical:this.getIsSphericalVideo()?"true":null});this.$VideoUploadSession65=!0;this.$VideoUploadSession67&&this.$VideoUploadSession67.flowStarted()};d.$VideoUploadSession61=function(a){__p&&__p();var c=this,d;if(this.$VideoUploadSession5){var e=this.$VideoUploadSession23.getValidationErrorMessage(this.$VideoUploadSession56,a);e?(d={error_summary:e.summary,error_description:e.description},e=!1):e=!0}else e=this.$VideoUploadSession23.validate(this.$VideoUploadSession56,a);if(!e){this.__logEvent(b("VideoUploadLogger").EVENT_INVALIDATED_UPLOADING);this.inform("upload-failed",d);return}e=b("getByPath")(a,["streams","primaryVideo"]);this.$VideoUploadSession62={source_height:b("getByPath")(e,["height"]),source_width:b("getByPath")(e,["width"]),duration:b("getByPath")(e,["duration"])*1e3};this.$VideoUploadSession37&&b("cr:967670")&&this.$VideoUploadSession56.getSize()>=this.$VideoUploadSession39&&this.$VideoUploadSession56.getSize()<=this.$VideoUploadSession40&&navigator.webkitTemporaryStorage&&navigator.webkitTemporaryStorage.queryUsageAndQuota(function(a,b){b>c.$VideoUploadSession41&&c.$VideoUploadSession68(c.$VideoUploadSession56,function(a,b){a||(c.$VideoUploadSession38?c.$VideoUploadSession69(c.$VideoUploadSession56,b,function(a){c.$VideoUploadSession70(b)}):c.$VideoUploadSession70(b))})});a&&a.format&&(this.$VideoUploadSession58=a.format.isSpherical,a.metadata&&(this.$VideoUploadSession59.sphericalMetadataXml=a.metadata.sphericalMetadataXml,this.$VideoUploadSession59.fbSpatialAudioMetadataXml=a.metadata.fbSpatialAudioMetadataXml,this.$VideoUploadSession59.ytSa3dMetadataJson=a.metadata.ytSa3dMetadataJson));this.$VideoUploadSession6||this.__logEvent(b("VideoUploadLogger").EVENT_STARTED_FLOW,{is_spherical:this.getIsSphericalVideo()?"true":null});this.$VideoUploadSession71=this.$VideoUploadSession26&&this.$VideoUploadSession56.getSize()>=this.$VideoUploadSession27;this.$VideoUploadSession72=!1;this.$VideoUploadSession73=0;this.$VideoUploadSession74=this.$VideoUploadSession73;this.$VideoUploadSession75=0;this.$VideoUploadSession14?this.$VideoUploadSession42():this.$VideoUploadSession43=!1;if(this.$VideoUploadSession71)if(this.$VideoUploadSession14){e=0;this.$VideoUploadSession76=Math.ceil(this.$VideoUploadSession56.getSize()/this.$VideoUploadSession48);var f=this.$VideoUploadSession76,g=this.$VideoUploadSession76;for(e=0;e<this.$VideoUploadSession48-1;e++)this.$VideoUploadSession44[e]=f,f=Math.min(this.$VideoUploadSession44[e]+g,this.$VideoUploadSession56.getSize()),this.$VideoUploadSession45[e]=f,this.$VideoUploadSession46[e]=this.$VideoUploadSession44[e],this.$VideoUploadSession47[e]=0}else this.$VideoUploadSession76=Math.floor(this.$VideoUploadSession56.getSize()/2),this.$VideoUploadSession44=this.$VideoUploadSession76,this.$VideoUploadSession46=this.$VideoUploadSession44,this.$VideoUploadSession47=0,this.$VideoUploadSession45=this.$VideoUploadSession56.getSize();else this.$VideoUploadSession76=this.$VideoUploadSession56.getSize();e=new(b("VideoUploadRequestContext"))().setFile(this.$VideoUploadSession56).setTargetID(this.$VideoUploadSession3).setSource(this.$VideoUploadSession1).setComposerDialogVersion(this.$VideoUploadSession2).setWaterfallID(this.$VideoUploadSession22).setHasFileBeenReplaced(this.$VideoUploadSession16).setSupportsChunking(this.$VideoUploadSession24).setSupportsFileAPI(this.$VideoUploadSession25).setCreatorProduct(this.$VideoUploadSession56.getCreatorProduct()).setPartitionStartOffset(this.$VideoUploadSession73).setPartitionEndOffset(this.$VideoUploadSession76);this.$VideoUploadSession26&&e.setUseParallelChunks(this.$VideoUploadSession26);this.$VideoUploadSession58&&(e.setIsSphericalVideo(this.$VideoUploadSession58),e.setSphericalMetadata(this.$VideoUploadSession59));e.setComposerEntryPointRef&&e.setComposerEntryPointRef(this.$VideoUploadSession8);e.setVideoPublisherActionSource(this.$VideoUploadSession9);this.$VideoUploadSession77();this.$VideoUploadSession29.sendRequest(e);this.$VideoUploadSession18&&this.$VideoUploadSession15&&this.$VideoUploadSession31.isResumabilityEnabled()&&!this.$VideoUploadSession31.isResumableServiceProxyReceiveEnabled()&&this.$VideoUploadSession78();this.inform("metadata-parsed",a)};d.$VideoUploadSession68=function(a,c){__p&&__p();var d=this;this.__logEvent(b("VideoUploadLogger").EVENT_ASYNC_STORAGE_WRITE_STARTED);var e=a.getFile(),f="video_upload_cache_"+this.$VideoUploadSession7+"_"+e.name+"_"+e.lastModified;b("cr:967670").setItem(f,a,function(a){if(a){d.__logEvent(b("VideoUploadLogger").EVENT_ASYNC_STORAGE_WRITE_FAILED);c(a,"");return}d.__logEvent(b("VideoUploadLogger").EVENT_ASYNC_STORAGE_WRITE_SUCCEEDED);c(null,f)})};d.$VideoUploadSession69=function(a,c,d){__p&&__p();var e=this;this.__logEvent(b("VideoUploadLogger").EVENT_ASYNC_STORAGE_READ_STARTED);b("cr:967670").getItem(c,function(c,f){if(c){e.__logEvent(b("VideoUploadLogger").EVENT_ASYNC_STORAGE_READ_FAILED);d(c);return}e.__logEvent(b("VideoUploadLogger").EVENT_ASYNC_STORAGE_READ_SUCCEEDED);c=b("md5")(a)===b("md5")(f);c?e.__logEvent(b("VideoUploadLogger").EVENT_ASYNC_STORAGE_DATA_VALIDATE_SUCCEEDED):e.__logEvent(b("VideoUploadLogger").EVENT_ASYNC_STORAGE_DATA_VALIDATE_FAILED);d(null)})};d.$VideoUploadSession70=function(a){var c=this;b("cr:967670").removeItem(a,function(a){if(a)return;c.__logEvent(b("VideoUploadLogger").EVENT_ASYNC_STORAGE_DATA_CLEANED)})};d.$VideoUploadSession30=function(a){var b=this.$VideoUploadSession24?a.chunk_start_uri:a.start_uri;b=this.__getVideoUploadStartRequestManager(b,a.start_max_transport_retries,a.start_transport_retry_interval_base,a.start_max_transport_retry_timeout,a.skip_upload_enabled,a.skip_upload_file_size_limit,a.start_max_server_retries,a.start_server_retry_interval_base);b.subscribe("request-started",this.$VideoUploadSession79.bind(this));b.subscribe("request-finished",this.$VideoUploadSession80.bind(this));b.subscribe("request-failed",this.$VideoUploadSession81.bind(this));b.subscribe("request-canceld",this.$VideoUploadSession82.bind(this));return b};d.$VideoUploadSession32=function(a){__p&&__p();var b=this.$VideoUploadSession24?a.chunk_receive_uri:a.receive_uri;b=this.__getVideoUploadReceiveRequestManager(b,a);b.subscribe("request-started",this.$VideoUploadSession83.bind(this));b.subscribe("request-progressed",this.$VideoUploadSession84.bind(this));b.subscribe("request-finished",this.$VideoUploadSession85.bind(this));b.subscribe("request-failed",this.$VideoUploadSession86.bind(this));b.subscribe("request-canceled",this.$VideoUploadSession87.bind(this));b.subscribe("request-timeout",this.$VideoUploadSession88.bind(this));b.subscribe("online",this.$VideoUploadSession89.bind(this));b.subscribe("offline",this.$VideoUploadSession90.bind(this));b.subscribe("resumable-called",this.$VideoUploadSession91.bind(this));b.subscribe("resumable-started",this.$VideoUploadSession92.bind(this));b.subscribe("resumable-success",this.$VideoUploadSession93.bind(this));b.subscribe("resumable-failed",this.$VideoUploadSession94.bind(this));return b};d.$VideoUploadSession35=function(a){var b=this.$VideoUploadSession24?a.chunk_post_uri:a.post_uri;b=this.__getVideoUploadPostRequestManager(b,a);b.subscribe("request-finished",this.__handlePostRequestFinished.bind(this));b.subscribe("request-failed",this.$VideoUploadSession95.bind(this));return b};d.$VideoUploadSession79=function(a,c){this.__logEvent(b("VideoUploadLogger").EVENT_STARTED_UPLOADING,babelHelpers["extends"]({hash_time:c.hash_time,hash_exception:c.hash_exception},this.$VideoUploadSession62)),this.__logEvent(b("VideoUploadLogger").EVENT_STARTED_START_REQUEST,this.$VideoUploadSession62),this.$VideoUploadSession96=Date.now(),this.inform("upload-started")};d.$VideoUploadSession78=function(a){__p&&__p();if(!this.$VideoUploadSession19){this.$VideoUploadSession19=!0;a||(a={video_id:null});var b;b=this.__createReceiveRequestContext(a,!1);this.$VideoUploadSession31.sendRequest(b);if(this.$VideoUploadSession71)if(this.$VideoUploadSession14){var c=0;for(c=0;c<this.$VideoUploadSession48-1;c++)b=this.__createReceiveRequestContext(a,!0,c),this.$VideoUploadSession33[c].sendRequest(b)}else b=this.__createReceiveRequestContext(a,!0),this.$VideoUploadSession33.sendRequest(b)}else this.$VideoUploadSession97()};d.$VideoUploadSession97=function(){this.$VideoUploadSession31.updateVideoID(this.$VideoUploadSession51);if(this.$VideoUploadSession71)if(this.$VideoUploadSession14){var a=0;for(a=0;a<this.$VideoUploadSession48-1;a++)this.$VideoUploadSession33[a].updateVideoID(this.$VideoUploadSession51)}else this.$VideoUploadSession33.updateVideoID(this.$VideoUploadSession51)};d.$VideoUploadSession80=function(a,c){this.__logEvent(b("VideoUploadLogger").EVENT_PROGRESS_UPLOADING_START_REQUEST,{transport_retries:c.transport_retries,hash_time:c.hash_time,skip_upload:c.skip_upload?1:null}),this.__logEvent(b("VideoUploadLogger").EVENT_FINISHED_START_REQUEST,babelHelpers["extends"]({video_id:c.video_id},this.$VideoUploadSession62)),this.$VideoUploadSession51=c.video_id,this.$VideoUploadSession52=c.upload_session_id,this.$VideoUploadSession53=c.fb_region,this.$VideoUploadSession98=c.skip_upload,!c.skip_upload?this.$VideoUploadSession78(c):(this.$VideoUploadSession99(),this.inform("upload-progressed",{start_offset:0,end_offset:this.$VideoUploadSession56.getSize(),file_size:this.$VideoUploadSession56.getSize(),sent_bytes:this.$VideoUploadSession56.getSize(),video_id:c.video_id,skip_upload:c.skip_upload}),this.$VideoUploadSession6&&this.__logFinishedUploading(),this.inform("upload-finished",{start_offset:0,end_offset:this.$VideoUploadSession56.getSize(),video_id:c.video_id,is_spherical_video:this.$VideoUploadSession58}))};d.__fetchReceiveRequestManagerStateLogData=function(){var a={};this.$VideoUploadSession31!=null&&(this.$VideoUploadSession31.appendStateLogData(a,"requestManager_"),a.request_manager_state=a.requestManager_last_log_state);if(this.$VideoUploadSession14){var b=0;for(b=0;b<this.$VideoUploadSession48-1;b++)this.$VideoUploadSession33[b]!=null&&this.$VideoUploadSession33[b].appendStateLogData(a,"requestManagerEx_"+b.toString())}else this.$VideoUploadSession33!=null&&this.$VideoUploadSession33.appendStateLogData(a,"requestManagerEx_");return a};d.__createReceiveRequestContext=function(a,c,d){c||(c=!1);var e=new(b("VideoUploadRequestContext"))();this.$VideoUploadSession14?this.__setupReceiveRequestContext(e,a,c,d):this.__setupReceiveRequestContext(e,a,c);return e};d.__setupReceiveRequestContext=function(a,b,c,d){var e,f,g;!c?(c=this.$VideoUploadSession73,e=this.$VideoUploadSession76,this.$VideoUploadSession15?(f=this.$VideoUploadSession73,g=this.$VideoUploadSession17?Math.min(this.$VideoUploadSession17,this.$VideoUploadSession76):this.$VideoUploadSession76):(f=b.start_offset,g=b.end_offset)):this.$VideoUploadSession14?(this.$VideoUploadSession15&&(this.$VideoUploadSession28=this.$VideoUploadSession45[d]-this.$VideoUploadSession44[d],this.$VideoUploadSession28=this.$VideoUploadSession17?Math.min(this.$VideoUploadSession17,this.$VideoUploadSession28):this.$VideoUploadSession28),c=this.$VideoUploadSession44[d],e=this.$VideoUploadSession45[d],f=this.$VideoUploadSession44[d],g=this.$VideoUploadSession44[d]+this.$VideoUploadSession28>=this.$VideoUploadSession45[d]?this.$VideoUploadSession45[d]:this.$VideoUploadSession44[d]+this.$VideoUploadSession28):(this.$VideoUploadSession15&&(this.$VideoUploadSession28=this.$VideoUploadSession45-this.$VideoUploadSession44,this.$VideoUploadSession28=this.$VideoUploadSession17?Math.min(this.$VideoUploadSession17,this.$VideoUploadSession28):this.$VideoUploadSession28),c=this.$VideoUploadSession44,e=this.$VideoUploadSession45,f=this.$VideoUploadSession44,g=this.$VideoUploadSession44+this.$VideoUploadSession28>=this.$VideoUploadSession45?this.$VideoUploadSession45:this.$VideoUploadSession44+this.$VideoUploadSession28);a.setFile(this.$VideoUploadSession56).setVideoID(b.video_id).setUploadSessionID(b.upload_session_id).setFbRegion(b.fb_region).setStartOffset(f).setEndOffset(g).setPartitionStartOffset(c).setPartitionEndOffset(e).setTargetID(this.$VideoUploadSession3).setSource(this.$VideoUploadSession1).setComposerDialogVersion(this.$VideoUploadSession2).setWaterfallID(this.$VideoUploadSession22).setSupportsChunking(this.$VideoUploadSession24).setHasFileBeenReplaced(this.$VideoUploadSession16);this.$VideoUploadSession26&&a.setUseParallelChunks(this.$VideoUploadSession26);a.setComposerEntryPointRef&&a.setComposerEntryPointRef(this.$VideoUploadSession8);this.$VideoUploadSession17&&a.setClientChunkSize(this.$VideoUploadSession17)};d.$VideoUploadSession81=function(a,c){a=this.__getLogErrorData(c);this.__logEvent(b("VideoUploadLogger").EVENT_FAILED_START_REQUEST,a);this.__logEvent(b("VideoUploadLogger").EVENT_FAILED_UPLOADING,a);a=c.error_is_transient?b("VideoUploadLogger").EVENT_RESIGNED_FLOW:b("VideoUploadLogger").EVENT_FAILED_FLOW;this.$VideoUploadSession6?this.$VideoUploadSession65&&(this.__logEvent(a),this.$VideoUploadSession65=!1):this.__logEvent(a);this.$VideoUploadSession99();this.$VideoUploadSession100();this.inform("upload-failed",c)};d.$VideoUploadSession82=function(a){this.__logEvent(b("VideoUploadLogger").EVENT_CANCELED_START_REQUEST)};d.$VideoUploadSession83=function(a,c){this.__logEvent(b("VideoUploadLogger").EVENT_STARTED_RECEIVE_REQUEST),!c.start_offset&&!c.transport_retries&&!c.server_retries&&this.__logEvent(b("VideoUploadLogger").EVENT_STARTED_SENDING_BYTES,{total_bytes:this.$VideoUploadSession56.getSize(),upload_domain:c.upload_domain}),this.$VideoUploadSession24&&this.__logEvent(b("VideoUploadLogger").EVENT_STARTED_SENDING_CHUNK_BYTES,{start_offset:c.start_offset,total_bytes:c.end_offset-c.start_offset,transport_retries:c.transport_retries,server_retries:c.server_retries,upload_speed:c.upload_speed,request_manager_state:c.request_manager_state,upload_domain:c.upload_domain})};d.$VideoUploadSession84=function(a,b){__p&&__p();if(b.start_offset<this.$VideoUploadSession76)this.$VideoUploadSession74=b.start_offset,this.$VideoUploadSession75=b.sent_bytes;else if(this.$VideoUploadSession14){a=this.getExPartitionNumber(b.start_offset);a>-1&&(this.$VideoUploadSession46[a]=b.start_offset,this.$VideoUploadSession47[a]=b.sent_bytes)}else this.$VideoUploadSession46=b.start_offset,this.$VideoUploadSession47=b.sent_bytes;b.start_offset=this.$VideoUploadSession74;b.sent_bytes=this.$VideoUploadSession75;if(this.$VideoUploadSession71)if(this.$VideoUploadSession14)for(a=0;a<this.$VideoUploadSession48-1;a++)b.start_offset+=this.$VideoUploadSession46[a]-this.$VideoUploadSession44[a],b.sent_bytes+=this.$VideoUploadSession47[a];else b.start_offset+=this.$VideoUploadSession46-this.$VideoUploadSession44,b.sent_bytes+=this.$VideoUploadSession47;a=Math.min(b.start_offset+b.sent_bytes,b.file_size);a>this.$VideoUploadSession57&&(this.$VideoUploadSession57=a,this.inform("upload-progressed",b))};d.$VideoUploadSession85=function(a,c){__p&&__p();this.__logEvent(b("VideoUploadLogger").EVENT_FINISHED_RECEIVE_REQUEST);this.$VideoUploadSession24&&this.__logEvent(b("VideoUploadLogger").EVENT_FINISHED_SENDING_CHUNK_BYTES,{start_offset:c.start_offset,sent_bytes:c.end_offset-c.start_offset,transport_retries:c.transport_retries,server_retries:c.server_retries,upload_speed:c.upload_speed,request_manager_state:c.request_manager_state,upload_domain:c.upload_domain});a=!1;if(c.start_offset<this.$VideoUploadSession76)this.$VideoUploadSession72=c.end_offset>=this.$VideoUploadSession76;else if(this.$VideoUploadSession14){var d;d=this.getExPartitionNumber(c.start_offset);if(d===-1){var e={error_summary:"Invalid offset",error_description:"Offset doesn't fall in any exPartition range."};this.__logEvent(b("VideoUploadLogger").EVENT_FAILED_UPLOADING);this.inform("upload-failed",e);return}this.$VideoUploadSession43[d]=c.end_offset>=this.$VideoUploadSession45[d]}else this.$VideoUploadSession43=c.end_offset>=this.$VideoUploadSession45;if(this.$VideoUploadSession14)for(d=0;d<this.$VideoUploadSession48-1;d++)if(this.$VideoUploadSession43[d]===!1){a=!1;break}else a=!0;else a=this.$VideoUploadSession43;(!this.$VideoUploadSession25||this.$VideoUploadSession72&&(!this.$VideoUploadSession71||a))&&(this.__logEvent(b("VideoUploadLogger").EVENT_FINISHED_SENDING_BYTES,{sent_bytes:this.$VideoUploadSession56.getSize(),upload_domain:c.upload_domain}),this.$VideoUploadSession66=Date.now()-this.$VideoUploadSession96,this.$VideoUploadSession6&&this.__logFinishedUploading(),c.video_id=this.$VideoUploadSession51,c.is_spherical_video=this.$VideoUploadSession58,this.inform("upload-finished",c),this.$VideoUploadSession11&&(this.$VideoUploadSession6||this.__logFinishedUploading(),this.__logEvent(b("VideoUploadLogger").EVENT_FINISHED_FLOW,c),this.$VideoUploadSession65=!1,this.$VideoUploadSession100(),this.inform("multimedia-upload-finished",c)))};d.$VideoUploadSession86=function(a,c){__p&&__p();a=this.__getLogErrorData(c);this.__logEvent(b("VideoUploadLogger").EVENT_FAILED_RECEIVE_REQUEST,a);this.$VideoUploadSession24&&this.__logEvent(b("VideoUploadLogger").EVENT_FAILED_SENDING_CHUNK_BYTES,a);if(this.$VideoUploadSession54){this.__logEvent(b("VideoUploadLogger").EVENT_FAILED_SENDING_BYTES,a);this.__logEvent(b("VideoUploadLogger").EVENT_FAILED_UPLOADING,a);var d=c.error_is_transient?b("VideoUploadLogger").EVENT_RESIGNED_FLOW:b("VideoUploadLogger").EVENT_FAILED_FLOW;this.$VideoUploadSession6?this.$VideoUploadSession65&&(this.__logEvent(d,a),this.$VideoUploadSession65=!1):this.__logEvent(d,a)}this.$VideoUploadSession100();this.inform("upload-failed",c)};d.$VideoUploadSession87=function(a){this.$VideoUploadSession24?this.__logEvent(b("VideoUploadLogger").EVENT_CANCELED_SENDING_CHUNK_BYTES):this.__logEvent(b("VideoUploadLogger").EVENT_CANCELED_SENDING_BYTES)};d.$VideoUploadSession88=function(a,c){a={start_offset:c.start_offset,sent_bytes:c.end_offset-c.start_offset,transport_retries:c.transport_retries,server_retries:c.server_retries,timeout_retries:c.timeout_retries,upload_speed:c.upload_speed,request_manager_state:c.request_manager_state};this.__logEvent(b("VideoUploadLogger").EVENT_TIMEOUT_SENDING_CHUNK_BYTES,a)};d.$VideoUploadSession89=function(a,b){this.inform("online",b)};d.$VideoUploadSession90=function(a,b){this.inform("offline",b)};d.$VideoUploadSession91=function(a,c){this.__logEvent(b("VideoUploadLogger").EVENT_RESUMABLE_CALLED,c)};d.$VideoUploadSession92=function(a,c){this.__logEvent(b("VideoUploadLogger").EVENT_RESUMABLE_STARTED,c)};d.$VideoUploadSession93=function(a,c){this.__logEvent(b("VideoUploadLogger").EVENT_RESUMABLE_SUCCESS,c)};d.$VideoUploadSession94=function(a,c){this.__logEvent(b("VideoUploadLogger").EVENT_RESUMABLE_FAILED,c)};d.__handlePostRequestFinished=function(a,c){this.__logEvent(b("VideoUploadLogger").EVENT_FINISHED_POST_REQUEST,babelHelpers["extends"]({video_id:this.$VideoUploadSession51},this.$VideoUploadSession62));c.video_id||(c.video_id=this.$VideoUploadSession51);this.$VideoUploadSession6||this.__logFinishedUploading();this.__logEvent(b("VideoUploadLogger").EVENT_FINISHED_FLOW);this.$VideoUploadSession65=!1;this.$VideoUploadSession100();a=babelHelpers["extends"]({},c,this.$VideoUploadSession63);this.inform("post-finished",a)};d.__logFinishedUploading=function(){this.__logEvent(b("VideoUploadLogger").EVENT_FINISHED_UPLOADING,babelHelpers["extends"]({elapsed_time:this.$VideoUploadSession66,skip_upload:this.$VideoUploadSession98?1:null,video_id:this.$VideoUploadSession51},this.$VideoUploadSession62)),this.$VideoUploadSession55=!0};d.$VideoUploadSession95=function(a,c){a=this.__getLogErrorData(c);this.__logEvent(b("VideoUploadLogger").EVENT_FAILED_POST_REQUEST,a);if(this.$VideoUploadSession54){this.__logEvent(b("VideoUploadLogger").EVENT_FAILED_UPLOADING,a);var d=c.error_is_transient?b("VideoUploadLogger").EVENT_RESIGNED_FLOW:b("VideoUploadLogger").EVENT_FAILED_FLOW;this.__logEvent(d,a)}this.$VideoUploadSession100();this.inform("post-failed",c)};d.$VideoUploadSession99=function(){this.$VideoUploadSession31.cancelRequest();if(this.$VideoUploadSession71)if(this.$VideoUploadSession14){var a=0;for(a=0;a<this.$VideoUploadSession48-1;a++)this.$VideoUploadSession33[a].cancelRequest()}else this.$VideoUploadSession33.cancelRequest();this.$VideoUploadSession19=!1};d.$VideoUploadSession64=function(){this.$VideoUploadSession29.cancelRequest(),this.$VideoUploadSession99(),this.$VideoUploadSession100(),this.$VideoUploadSession51&&(c.deleteVideo(this.$VideoUploadSession51),this.$VideoUploadSession51=null,this.$VideoUploadSession52=null,this.$VideoUploadSession53=null)};d.$VideoUploadSession77=function(){this.$VideoUploadSession54=!0,this.$VideoUploadSession10&&(this.$VideoUploadSession67=new(b("VideoUploadCrashMonitor"))(this.$VideoUploadSession22,this.$VideoUploadSession7,this.$VideoUploadSession1,this.$VideoUploadSession3,this.$VideoUploadSession4,this.$VideoUploadSession24,this.$VideoUploadSession8,!this.$VideoUploadSession6||this.$VideoUploadSession65),this.$VideoUploadSession67.startSession())};d.$VideoUploadSession100=function(){this.$VideoUploadSession54=!1,this.$VideoUploadSession67&&(this.$VideoUploadSession67.endSession(),this.$VideoUploadSession67=null)};d.__getLogErrorData=function(a){return{error:a.error_summary,error_code:a.error_code,error_description:a.error_description,transport_retries:a.transport_retries,server_retries:a.server_retries,request_manager_state:a.request_manager_state}};d.__logEvent=function(a,b){var c=this.getLogger();b=b||{};this.$VideoUploadSession56&&(b.file_size=this.$VideoUploadSession56.getSize(),b.file_extension=this.$VideoUploadSession56.getExtension(),b.sent_bytes=this.$VideoUploadSession57);c.logEvent(a,b)};d.__getVideoUploadStartRequestManager=function(a,c,d,e,f,g,h,i){return new(b("VideoUploadStartRequestManager"))(a,c,d,e,f,g,h,i)};d.__getVideoUploadReceiveRequestManager=function(a,c){return new(b("VideoUploadReceiveRequestManager"))(a,c.max_transport_retries,c.max_transport_retry_timeout,c.max_server_retries,c.response_timeout_enabled,c.max_response_timeout_retries,c.response_timeout_speed_variation_factor_ppt,c.transport_retry_interval_base,c.server_retry_interval_base,c.receive_errors_force_retry,c.access_token,c.resumability_enabled,c.resumability_async_enabled,c.resumable_service_name,c.resumable_service_domain,c.datr,c.resumability_min_file_size,c.resumable_service_proxy_receive,c.resumable_service_send_media_info,c.resumable_reset_transport_retries_on_progress,c.add_flow_capture_header)};d.__getVideoUploadPostRequestManager=function(a,c){return new(b("VideoUploadPostRequestManager"))(a,c.post_max_transport_retries,c.post_transport_retry_interval_base,c.post_max_server_retries,c.post_server_retry_interval_base)};c.deleteVideo=function(a){a=new(b("AsyncRequest"))("/ajax/video/actions/delete").setData({fbid:a,redirect:!1});a.setErrorHandler(function(){});a.send()};return c}(b("mixin")(b("cr:909282")));e.exports=a}),null);
__d("VideoUploader",["requireCond","cr:909282","VideoUploadCrashMonitor","VideoUploadSession","mixin"],(function(a,b,c,d,e,f){__p&&__p();a=function(a){"use strict";__p&&__p();babelHelpers.inheritsLoose(c,a);function c(c){var d;d=a.call(this)||this;d.$VideoUploader1=c;d.$VideoUploader2=null;d.$VideoUploader3=null;d.$VideoUploader4=c.waterfall_id==null?null:c.waterfall_id;d.$VideoUploader5=d.$VideoUploader1.ad_account_id;c.monitor_crashes&&(d.$VideoUploader6=new(b("VideoUploadCrashMonitor"))(),d.$VideoUploader6.logKnownCrashes());return d}var d=c.prototype;d.getLogger=function(){if(!this.$VideoUploader2)return;if(this.$VideoUploader2.getLogger)return this.$VideoUploader2.getLogger()};d.upload=function(a){var b=this;if(this.$VideoUploader2)return;var c=this.__getVideoUploadSession(this.$VideoUploader1);c.subscribe(this.__getEventsWhichShouldListenFromSession(),function(a,c){return b.$VideoUploader7(a,c)});c.start(a);this.$VideoUploader2=c};d.__getVideoUploadSession=function(a){return new(b("VideoUploadSession"))(a)};d.__getEventsWhichShouldListenFromSession=function(){return["upload-requested","upload-started","upload-progressed","upload-finished","upload-failed","post-started","post-finished","post-failed","online","offline","metadata-parsed","set-waterfall-id"]};d.postUserRequest=function(){if(!this.$VideoUploader2)return;this.$VideoUploader2.startFlow&&this.$VideoUploader2.startFlow()};d.setTargetID=function(a){if(this.$VideoUploader2==null)return;this.$VideoUploader2.setTargetID(a)};d.setHasFileBeenReplaced=function(a){this.$VideoUploader1.has_file_been_replaced=a};d.post=function(a){if(!this.$VideoUploader2)return;this.$VideoUploader2.post(a)};d.getVideoID=function(){this.$VideoUploader2&&(this.$VideoUploader3=this.$VideoUploader2.getVideoID());return this.$VideoUploader3};d.cancel=function(a){a===void 0&&(a=!1);var c=this.getVideoID();this.$VideoUploader2?this.$VideoUploader2.cancel(a):a&&c&&b("VideoUploadSession").deleteVideo(c);this.reset()};d.abandon=function(a){a===void 0&&(a=!1);var c=this.getVideoID();this.$VideoUploader2?this.$VideoUploader2.abandon(a):a&&c&&b("VideoUploadSession").deleteVideo(c);this.reset()};d.reset=function(){this.$VideoUploader2&&(this.$VideoUploader3=this.getVideoID()),this.$VideoUploader2=null};d.getUploadSession=function(){return this.$VideoUploader2};d.getLoggerData=function(){return{waterfall_id:this.$VideoUploader2?this.$VideoUploader2.$VideoUploader4:null,actor_id:this.$VideoUploader1.actor_id,target_id:this.$VideoUploader1.target_id,target_type:this.$VideoUploader1.target_type,composer_entry_point_ref:this.$VideoUploader1.composer_entry_point_ref}};d.isPostInProgress=function(){return!!this.$VideoUploader2&&this.$VideoUploader2.isPostInProgress()};d.isSessionInProgress=function(){return!!this.$VideoUploader2&&this.$VideoUploader2.isInProgress()};d.getUploadParameters=function(){return this.$VideoUploader1};d.__getSession=function(){return this.$VideoUploader2};d.__getEventsForWhichSessionShouldBeSetToNull=function(){return["upload-failed","post-finished","multimedia-upload-finished"]};d.$VideoUploader7=function(a,b){this.__getEventsForWhichSessionShouldBeSetToNull().includes(a)&&this.reset(),this.__delegateEvent(a,b)};d.__delegateEvent=function(a,b){this.inform(a,b)};return c}(b("mixin")(b("cr:909282")));e.exports=a}),null);
__d("createPlainBlocksFromText",["CharacterMetadata","ContentBlock","immutable","generateRandomKey","sanitizeDraftText"],(function(a,b,c,d,e,f){"use strict";var g=b("immutable").List,h=b("immutable").Repeat,i=b("CharacterMetadata").EMPTY;function a(a){return a.map(function(a){a=b("sanitizeDraftText")(a);var c=a.length;return new(b("ContentBlock"))({key:b("generateRandomKey")(),text:a,type:"unstyled",characterList:g(h(i,c))})})}e.exports=a}),null);
__d("createEditorStateWithRanges",["invariant","ContentState","DraftModifier","EditorState","SelectionState","UnicodeUtils","createPlainBlocksFromText"],(function(a,b,c,d,e,f,g){__p&&__p();var h;function a(a){__p&&__p();var c=a.addEntityToContentStateFn,d=a.allowUndo,e=a.decorator,f=a.splitIntoBlocks,i=a.text;a=a.ranges;f===void 0&&(f=!0);i||(i="");var j=[],k=[];f=f?i.split(/(\r\n?|\n)/g):[i];var l=0;f.forEach(function(a,c){c%2===0&&(j.push(a),k.push(l)),l+=(h||(h=b("UnicodeUtils"))).strlen(a)});var m=b("createPlainBlocksFromText")(j);i=b("ContentState").createFromBlockArray(m);if(a&&a.length&&c){var n=c;i=a.reduce(function(a,c,d){__p&&__p();d=n(c,a);a=d.getLastCreatedEntityKey();var e=c.offset;c=e+c.length;var f,i,j,l;for(var o=0;o<k.length;o++){var p=k[o],q=k[o+1],r=q===void 0;(r||e>=p&&e<q)&&(f=m[o],i=e-p);if(r||c>=p&&c<q){j=m[o];l=c-p;break}}f&&j||g(0,1022);r=(h||(h=b("UnicodeUtils"))).substr(f.getText(),0,i);q=r.length;p=h.substr(j.getText(),0,l);c=p.length;e=new(b("SelectionState"))({anchorKey:f.getKey(),anchorOffset:q,focusKey:j.getKey(),focusOffset:c,isBackward:!1,hasFocus:!1});o=b("DraftModifier").applyEntity(d,e,a);return o},i)}f=b("EditorState").createWithContent(i,e);d===!1&&(f=b("EditorState").set(f,{allowUndo:!1}));return f}e.exports=a}),null);
__d("ImageExif",["exif-js"],(function(a,b,c,d,e,f){__p&&__p();b("exif-js").enableXmp();function g(a){__p&&__p();var b=function(b){return a.charCodeAt(b)&255};this.getByteAt=b;this.getShortAt=function(a,b){a=this.getSShortAt(a,b);return a>0?a:a+65536};this.getSShortAt=function(a,c){var d=b(a);a=b(a+1);return c?(d<<8)+a:(a<<8)+d};this.getLongAt=function(a,b){a=this.getSLongAt(a,b);return a>0?a:a+4294967296};this.getSLongAt=function(a,c){var d=b(a),e=b(a+1),f=b(a+2);a=b(a+3);return c?(((d<<8)+e<<8)+f<<8)+a:(((a<<8)+f<<8)+e<<8)+d};this.getStringAt=function(b,c){return a.substr(b,c)};this.getLength=function(){return a.length}}a={readFromFile:function(a,b){var c=this,d=new FileReader();d.addEventListener("load",function(a){a=a.target.result;a=a instanceof ArrayBuffer?c.readFromArrayBuffer(a):c.readFromBinaryString(a);b(a)},!1);window.DataView?d.readAsArrayBuffer(a):d.readAsBinaryString(a)},readFromBinaryString:function(a){return b("exif-js").readFromBinaryFile(new g(a))},readFromArrayBuffer:function(a){return b("exif-js").readFromBinaryFile(a)}};e.exports=a}),null);
__d("PhotosUploadWaterfallXMixin",["invariant","AsyncSignal","Banzai","PhotosUploadWaterfallXConfig","randomInt"],(function(a,b,c,d,e,f,g){__p&&__p();var h=new Map();function i(a,c){var d={};a.client_time=Math.round(Date.now()/1e3);b("PhotosUploadWaterfallXConfig").retryBanzai&&(d.retry=!0,a.nonce=b("randomInt")(4294967296));b("Banzai").post(b("PhotosUploadWaterfallXConfig").banzaiRoute,a,d);c&&setTimeout(c,0)}function j(a,c){if(b("PhotosUploadWaterfallXConfig").useBanzai)i(a,c);else{a=new(b("AsyncSignal"))(b("PhotosUploadWaterfallXConfig").loggingEndpoint,{data:JSON.stringify(a)}).setHandler(c);b("PhotosUploadWaterfallXConfig").timeout&&a.setTimeout(10*1e3);a.send()}}e.exports={logStep:function(a,b,c){var d=this.getWaterfallID&&this.getWaterfallID(),e=this.getWaterfallAppName&&this.getWaterfallAppName();if(!d||!e)return;j(babelHelpers["extends"]({step:a,qn:d,uploader:e,ref:this.getWaterfallSource&&this.getWaterfallSource()},b),c)},logPUWStep:function(a,b,c,d,e,f,g){if(f&&f.logOncePerSession){h.has(b)||h.set(b,new Set());if(h.get(b).has(a))return;h.get(b).add(a)}j(Object.assign({step:a,qn:b,uploader:c,ref:d},e),g)}}}),null);
__d("SlideshowFlowTypes",[],(function(a,b,c,d,e,f){"use strict";a={SETTINGS_TAB:"SETTINGS_TAB",MUSIC_TAB:"MUSIC_TAB",FRAMES_TAB:"FRAMES_TAB"};e.exports={SlideshowTabKey:a}}),null);
__d("StringEncoding",[],(function(a,b,c,d,e,f){"use strict";__p&&__p();function a(a,b){__p&&__p();a=new Uint8Array(a);var c=0,d=[];while(c<a.length){var e=a[c],f=void 0;if(e>>7===0)f=1;else if(e>>5===6)e&=31,f=2;else if(e>>4===14)e&=15,f=3;else if(e>>3===30)e&=7,f=4;else if(e>>2===62)e&=3,f=5;else if(e>>1===126)e&=1,f=6;else throw new Error("Cannot decode as UTF-8 - unrecognised codepoint header");if(c+f>a.length)throw new Error("Cannot decode as UTF-8 - incomplete codepoint");for(var g=1;g<f;g++){var h=a[c+g];if(h>>6!==2)throw new Error("Cannot decode as UTF-8 - unrecognised codepoint subsequent byte");h&=63;e<<=6;e|=h}if(e>1114111)throw new Error("Cannot decode as UTF-8 - JavaScript doesn't support codepoints over 0x10FFFF");if(!e)switch(b){case"error":throw new Error("Cannot decode as UTF-8 - contains a null and we're not allowing them");case"ignore":continue;case"truncate":return String.fromCodePoint.apply(String,d);case"include":break}d.push(e);c+=f}return String.fromCodePoint.apply(String,d)}function g(a){return(a&255)<<8|a>>8}function b(a,b){__p&&__p();if(a.byteLength%2!==0)throw new Error("Cannot decode as UTF-16 - data length mod 2 != 0");a=new Uint16Array(a);var c=0,d=[],e=!1;a[0]===65279?++c:a[0]==65534&&(++c,e=!0);while(c<a.length){var f=a[c];e&&(f=g(f));var h=f;if(f>55295&&f<57344){if((f&64512)!==55296)throw new Error("Cannot decode as UTF-16 - incorrect signature for high surrogate");if(c+1>=a.length)throw new Error("Cannot decode as UTF-16 - incomplete codepoint");++c;var i=a[c];e&&(i=g(i));if((i&64512)!==56320)throw new Error("Cannot decode as UTF-16 - incorrect signature for low surrogate");h=((f&1023)<<10|i&1023)+65536}if(!h)switch(b){case"error":throw new Error("Cannot decode as UTF-16 - contains a null and we're not allowing them");case"ignore":continue;case"truncate":return String.fromCodePoint.apply(String,d);case"include":break}d.push(h);++c}return String.fromCodePoint.apply(String,d)}function h(a){return(a&255)<<24|(a&255<<8)<<8|(a&255<<16)>>8|a>>>24}function c(a,b){__p&&__p();if(a.byteLength%4!==0)throw new Error("Cannot decode as UTF-32 - data length mod 4 != 0");a=new Uint32Array(a);var c=0,d=[],e=!1;a[0]===65279?++c:a[0]==4294836224&&(++c,e=!0);while(c<a.length){var f=a[c];e&&(f=h(f));if(f&2147483648)throw new Error("Cannot decode as UTF-32 - invalid codepoint");if(f>1114111)throw new Error("Cannot decode as UTF-32 - JavaScript doesn't support codepoints over 0x10FFFF");if(!f)switch(b){case"error":throw new Error("Cannot decode as UTF-32 - contains a null and we're not allowing them");case"ignore":continue;case"truncate":return String.fromCodePoint.apply(String,d);case"include":break}d.push(f);++c}return String.fromCodePoint.apply(String,d)}var i={"utf-8":a,"utf-16":b,"utf-32":c};d=function(){__p&&__p();function a(a,b){__p&&__p();a?this.$1=a:this.$1=["utf-8","utf-16","utf-32"];b||(b="error");this.$2=b;for(var a=this.$1,b=Array.isArray(a),c=0,a=b?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var d;if(b){if(c>=a.length)break;d=a[c++]}else{c=a.next();if(c.done)break;d=c.value}d=d;this.$3(d)}}var b=a.prototype;b.getPrecedence=function(){return this.$1};b.decode=function(a){__p&&__p();var b=[];for(var c=this.$1,d=Array.isArray(c),e=0,c=d?c:c[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var f;if(d){if(e>=c.length)break;f=c[e++]}else{e=c.next();if(e.done)break;f=e.value}f=f;f=this.$3(f);try{return f(a,this.$2)}catch(a){b.push(a)}}throw new Error(b.join(", "))};b.$3=function(a){var b=i[a];if(!b)throw new Error("Unknown encoding "+a);return b};return a}();e.exports.Decoder=d}),null);
__d("ImageMetadata",["regeneratorRuntime","Promise","ImageExif","StringEncoding","emptyFunction"],(function(a,b,c,d,e,f){"use strict";__p&&__p();c=function(){__p&&__p();function c(a){this.$4="",this.$6=a,this.$7=new Uint8Array(a),this.$8()}var d=c.prototype;d.$8=function(){__p&&__p();var a=0;while(a<this.$7.length){a=this.$9(a);if(a===-1)return;var b=this.$7[a+1];b=g[b];if(!b)return;var c=b.length;c===void 0&&(c=this.$7[a+2]*256+this.$7[a+3]);this.$10(a,c,b);if(b.name==="SOS")return;a+=2+c}};d.$10=function(a,b,c){switch(c.name){case"APP1":this.$11(a+4,h)?(this.$1||(this.$1=a,this.$2=b),this.$12(a+4+h.length,b-2-h.length)):this.$11(a+4,i)?(this.$1=a,this.$2=b,this.$13(a+4+i.length,b-2-i.length)):this.$11(a+4,j)&&this.$14(a+4+j.length,b-2-j.length);break;case"SOF0":case"SOF1":case"SOF2":case"SOF3":case"SOF5":case"SOF6":case"SOF7":case"JPG":case"SOF9":case"SOF10":case"SOF11":case"SOF13":case"SOF14":case"SOF15":this.$15(a+4,b-2);break}};d.$15=function(a,b){b=this.$7[a+3]*256+this.$7[a+4];a=this.$7[a+1]*256+this.$7[a+2];b>0&&a>0&&(this.$5={x:b,y:a})};d.$12=function(a,c){__p&&__p();a=emptyFunction;try{emptyFunction=b("emptyFunction");c=b("ImageExif").readFromArrayBuffer(this.$6)||{}}finally{emptyFunction=a}a={};for(var d in c){var e=c[d];typeof e==="string"&&(e=e.trim());a[d.trim()]=e}this.$3=a};d.$13=function(a,c){var d=new(b("StringEncoding").Decoder)(null,"truncate");try{d=d.decode(this.$6.slice(a,a+c));this.$4=d}catch(a){return}};d.$14=function(a){};d.$11=function(a,b){var c=this;return b.split("").every(function(b){return c.$7[a++]===b.charCodeAt(0)})};d.$9=function(a){for(var a=a;a+1<this.$7.length;++a)if(this.$7[a]===255&&this.$7[a+1]!==0&&this.$7[a+1]!==255)return a;return-1};d.hasAPP1=function(){return Boolean(this.$1)};d.hasExif=function(){return Boolean(this.$3)};d.hasXMP=function(){return Boolean(this.$4)};d.hasSize=function(){return Boolean(this.$5)};d.getAPP1Location=function(){return!this.hasAPP1()?null:this.$1};d.getAPP1Length=function(){return!this.hasAPP1()?null:this.$2};d.getExif=function(){if(!this.$3)throw new Error("Image has no Exif data");return this.$3};d.getXMPString=function(){return this.$4};d.getSize=function(){if(!this.$5)throw new Error("Could not find size data?!");return this.$5};d.getBufferLength=function(){if(!this.$6)throw new Error("Do not find buffer data!");return this.$6.byteLength};c.genMetadataFromBlob=function(a){return b("regeneratorRuntime").async(function(d){while(1)switch(d.prev=d.next){case 0:d.t0=c;d.next=3;return b("regeneratorRuntime").awrap(c.$16(a));case 3:d.t1=d.sent;return d.abrupt("return",new d.t0(d.t1));case 5:case"end":return d.stop()}},null,this)};c.$16=function(c){return new(b("Promise"))(function(b,d){var e=new a.FileReader();e.onabort=d;e.onerror=d;e.onload=b;e.readAsArrayBuffer(c)})};return c}();var g=[];g[216]={name:"SOI",length:0};g[192]={name:"SOF0"};g[193]={name:"SOF1"};g[194]={name:"SOF2"};g[195]={name:"SOF3"};g[197]={name:"SOF5"};g[198]={name:"SOF6"};g[199]={name:"SOF7"};g[200]={name:"JPG"};g[201]={name:"SOF9"};g[202]={name:"SOF10"};g[203]={name:"SOF11"};g[205]={name:"SOF13"};g[206]={name:"SOF14"};g[207]={name:"SOF15"};g[196]={name:"DHT"};g[219]={name:"DQT"};g[221]={name:"DRI",length:2};g[218]={name:"SOS"};g[208]={name:"RST0",length:0};g[209]={name:"RST1",length:0};g[210]={name:"RST2",length:0};g[211]={name:"RST3",length:0};g[212]={name:"RST4",length:0};g[213]={name:"RST5",length:0};g[214]={name:"RST6",length:0};g[215]={name:"RST7",length:0};g[224]={name:"APP0"};g[225]={name:"APP1"};g[226]={name:"APP2"};g[227]={name:"APP3"};g[228]={name:"APP4"};g[229]={name:"APP5"};g[230]={name:"APP6"};g[231]={name:"APP7"};g[232]={name:"APP8"};g[233]={name:"APP9"};g[234]={name:"APP10"};g[235]={name:"APP11"};g[236]={name:"APP12"};g[237]={name:"APP13"};g[238]={name:"APP14"};g[239]={name:"APP15"};g[254]={name:"COM"};g[217]={name:"EOI",length:0};var h="Exif\0\0",i="http://ns.adobe.com/xap/1.0/\0",j="http://ns.adobe.com/xmp/extension/\0";e.exports=c}),null);
__d("XSphericalPhotoSphereMetadataAsyncController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/spherical_media/photo/metadata/",{})}),null);
__d("SphericalImageUtils",["Promise","ImageMetadata","XAsyncRequest","XSphericalPhotoSphereMetadataAsyncController"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=2048;c={genArrayBufferFromBlob:function(c){__p&&__p();return new(b("Promise"))(function(b,d){if(a.FileReader){var e=new a.FileReader();e.onabort=d;e.onerror=d;e.onload=function(a){b(a.target.result)};e.readAsArrayBuffer(c)}else d(new Error("global.FileReader doesn't exit"))})},shouldCheckInServer:function(a){__p&&__p();if(!a.hasExif()&&!a.hasXMP()||!a.hasSize())return!1;var b=a.getXMPString();if(this.getMayContainSphericalMetadata(b))return!0;var c=a.getSize(),d=c.x;c=c.y;if(Math.max(d,c)<g||d/c<2&&c/d<2)return!1;c=a.hasExif()?a.getExif():{};return b===""&&(!c.Make||!c.Model)?!1:!0},genPhotosphereMetadata:function(a){var c=this;return new(b("Promise"))(function(d,e){c.genArrayBufferFromBlob(a).done(function(a){try{var f=new(b("ImageMetadata"))(a);c.shouldCheckInServer(f)?c.genPhotosphereMetadataFromServer(f.hasSize()?f.getSize():{x:0,y:0},f.getXMPString(),f.hasExif()?f.getExif():{}).done(function(a){a=a.payload;d({photoSphereMetadata:a,imageMetadata:f})},e):d({})}catch(a){a.__manual=!0,e(a)}},e)})},genPhotosphereMetadataFromServer:function(a,c,d){var e=this;return new(b("Promise"))(function(f,g){new(b("XAsyncRequest"))(b("XSphericalPhotoSphereMetadataAsyncController").getURIBuilder().getURI()).setMethod("POST").setData({exif_string:e.getExifString(d),height:a.y,width:a.x,xmp:c}).setHandler(f).setErrorHandler(g).send()})},getExifString:function(a){return JSON.stringify(a,function(a,b){return a==="FocalLength"&&b.numerator&&b.denominator?b.numerator+"/"+b.denominator:b})},getMayContainSphericalMetadata:function(a){return a!==""&&a.indexOf("GPano:")>-1}};e.exports=c}),null);
__d("SphericalImage",["regeneratorRuntime","SphericalImageUtils"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g="ProjectionType";a=function(){__p&&__p();function a(a){this.props=a}a.createFromBlob=function(a){var c;return b("regeneratorRuntime").async(function(d){while(1)switch(d.prev=d.next){case 0:d.next=2;return b("regeneratorRuntime").awrap(b("SphericalImageUtils").genPhotosphereMetadata(a));case 2:c=d.sent;return d.abrupt("return",new this(c));case 4:case"end":return d.stop()}},null,this)};var c=a.prototype;c.isSpherical=function(){return Boolean(this.props.photoSphereMetadata)};c.getImageMetadata=function(){return this.props.imageMetadata};c.getPhotoSphereMetadata=function(){return this.props.photoSphereMetadata};c.getSize=function(){return this.props.imageMetadata?this.props.imageMetadata.getSize():null};c.getBufferLength=function(){return this.props.imageMetadata?this.props.imageMetadata.getBufferLength():null};c.getProjectionType=function(){var a="";this.props.photoSphereMetadata&&this.props.photoSphereMetadata[g]&&(a=this.props.photoSphereMetadata[g]);return a};return a}();e.exports=a}),null);